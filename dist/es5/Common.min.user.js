!function i(r,l,d){function s(t,e){if(!l[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=l[t]={exports:{}};r[t][0].call(o.exports,function(e){return s(r[t][1][e]||e)},o,o.exports,i,r,l,d)}return l[t].exports}for(var c="function"==typeof require&&require,e=0;e<d.length;e++)s(d[e]);return s}({1:[function(n,e,t){"use strict";var a=_(n("./module/Info")),o=n("./module/Config"),i=y(n("./module/Util")),r=_(n("./module/Const")),l=(y(n("./module/Msg")),y(n("./module/Dialog")),y(n("./module/Log")),y(n("./module/TmpLog"))),d=(y(n("./module/LootLog")),y(n("./module/Script"))),s=y(n("./module/Public")),c=y(n("./module/Index")),u=y(n("./module/Read")),p=y(n("./module/Post")),f=y(n("./module/Other")),m=y(n("./module/Bank")),g=y(n("./module/Card")),h=y(n("./module/Item")),v=y(n("./module/Loot")),b=y(n("./module/SelfRate"));y(n("./module/ConfigDialog"));function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}"undefined"!=typeof jQuery&&$(document).ready(function(){var e=new Date;if(a.default.version="13.0.0",s.getUidAndUserName()){s.addPolyfill(),function(){try{a.default.w.Info=n("./module/Info").default,a.default.w.Util=n("./module/Util"),a.default.w.Const=n("./module/Const").default,a.default.w.Msg=n("./module/Msg"),a.default.w.Dialog=n("./module/Dialog"),a.default.w.Log=n("./module/Log"),a.default.w.TmpLog=n("./module/TmpLog"),a.default.w.LootLog=n("./module/LootLog"),a.default.w.Public=n("./module/Public"),a.default.w.Index=n("./module/Index"),a.default.w.Read=n("./module/Read"),a.default.w.Post=n("./module/Post"),a.default.w.Other=n("./module/Other"),a.default.w.Bank=n("./module/Bank"),a.default.w.Card=n("./module/Card"),a.default.w.Item=n("./module/Item"),a.default.w.Loot=n("./module/Loot"),a.default.w.SelfRate=n("./module/SelfRate"),a.default.w.Script=n("./module/Script");var e=n("./module/Config");a.default.w.readConfig=e.read,a.default.w.writeConfig=e.write}catch(e){console.log(e)}}(),(0,o.init)(),s.checkBrowserType(),s.appendCss(),s.addConfigAndLogDialogLink(),Config.animationEffectOffEnabled&&($.fx.off=!0),Config.customScriptEnabled&&d.runCustomScript("start"),s.repairBbsErrorCode(),window.addEventListener("beforeunload",s.preventCloseWindowWhenActioning),Config.showSearchLinkEnabled&&s.addSearchDialogLink(),s.bindSearchTypeSelectMenuClick(),s.makeSearchByBelowTwoKeyWordAvailable(),Config.addFastNavMenuEnabled&&s.addFastNavMenu(),a.default.$userMenu.find('a[href^="login.php?action=quit"]').click(function(){return confirm("是否退出账号？")}),Config.changeNewTipsColorEnabled&&s.changeNewTipsColor(),s.handleSideBarLink(),2===parseInt(i.getCookie(r.default.lootCompleteCookieName))&&$("#pdLoot").addClass("pd_rightbox1_gray"),Config.showChangePointsInfoEnabled&&s.addChangePointsInfoTips(),a.default.isInHomePage?(Config.smLevelUpAlertEnabled&&c.smLevelUpAlert(),Config.smRankChangeAlertEnabled&&c.smRankChangeAlert(),Config.homePageThreadFastGotoLinkEnabled&&c.addThreadFastGotoLink(),c.addPromoteHaloInterval()):"/read.php"===location.pathname?(Config.turnPageViaKeyboardEnabled&&s.turnPageViaKeyboard(),u.fastGotoFloor(),u.addFloorGotoLink(),u.adjustThreadContentFontSize(),u.showAttachImageOutsideSellBox(),Config.parseMediaTagEnabled&&u.parseMediaTag(),Config.modifyKfOtherDomainEnabled&&u.modifyKFOtherDomainLink(),Config.customMySmColor&&u.modifyMySmColor(),Config.blockUselessThreadButtonsEnabled&&u.blockUselessThreadButtons(),Config.multiQuoteEnabled&&u.addMultiQuoteButton(),u.addFastGotoFloorInput(),u.addStatAndBuyThreadBtn(),u.handleBuyThreadBtn(),u.addCopyBuyersListOption(),Config.userMemoEnabled&&u.addUserMemo(),u.addCopyCodeLink(),u.addMoreSmileLink(),p.addRedundantKeywordWarning(),0<$('a[href$="#install-script"]').length&&d.handleInstallScriptLink(),Config.preventCloseWindowWhenEditPostEnabled&&p.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&p.savePostContentWhenSubmit()):"/thread.php"===location.pathname?(Config.highlightNewPostEnabled&&f.highlightNewPost(),Config.showFastGotoThreadPageEnabled&&f.addFastGotoThreadPageLink()):"/post.php"===location.pathname?(p.addRedundantKeywordWarning(),/\bmultiquote=1/i.test(location.href)?Config.multiQuoteEnabled&&p.handleMultiQuote(2):/\baction=quote/i.test(location.href)&&p.removeUnpairedBBCodeInQuoteContent(),p.addFillTitleBtn(),p.addExtraPostEditorButton(),p.addExtraOptionInPostPage(),Config.preventCloseWindowWhenEditPostEnabled&&p.preventCloseWindowWhenEditPost(),Config.autoSavePostContentWhenSubmitEnabled&&p.savePostContentWhenSubmit(),a.default.isInSpecialDomain&&p.addAttachChangeAlert()):"/kf_fw_ig_mybp.php"===location.pathname?h.init():"/kf_fw_ig_shop.php"===location.pathname?(h.showMyInfoInItemShop(),h.showBuyItemTips()):"/kf_fw_ig_pklist.php"===location.pathname?v.addUserLinkInPkListPage():"/kf_fw_ig_halo.php"===location.pathname?($(".kf_fw_ig1:first").on("click",'a[href^="kf_fw_ig_halo.php?do=buy&id="]',function(){if(!confirm("是否提升战力光环？"))return!1;l.deleteValue(r.default.haloInfoTmpLogName)}),v.addUserLinkInHaloPage()):/\/hack\.php\?H_name=bank$/i.test(location.href)?m.handleBankPage():/\/kf_fw_card_my\.php$/.test(location.href)?g.addStartBatchModeButton():/\/message\.php\?action=read&mid=\d+/i.test(location.href)?(f.addFastDrawMoneyLink(),Config.modifyKfOtherDomainEnabled&&u.modifyKFOtherDomainLink()):/\/message\.php($|\?action=receivebox)/i.test(location.href)?f.addMsgSelectButton():/\/profile\.php\?action=show/i.test(location.href)?(f.handleProfilePage(),f.addFollowAndBlockAndMemoUserLink()):/\/personal\.php\?action=post/i.test(location.href)?10===Config.perPageFloorNum&&f.modifyMyPostLink():"/kf_growup.php"===location.pathname?f.addAutoChangeIdColorButton():"/guanjianci.php"===location.pathname?f.highlightUnReadAtTipsMsg():/\/profile\.php\?action=modify$/i.test(location.href)?(f.syncModifyPerPageFloorNum(),a.default.isInSpecialDomain&&f.addAvatarChangeAlert()):/\/job\.php\?action=preview$/i.test(location.href)?p.modifyPostPreviewPage():"/search.php"===location.pathname?Config.turnPageViaKeyboardEnabled&&s.turnPageViaKeyboard():"/kf_fw_1wkfb.php"===location.pathname?(/\/kf_fw_1wkfb\.php\?ping=(2|4|7)\b/.test(location.href)?(b.highlightRateErrorSize(),/\/kf_fw_1wkfb\.php\?ping=2\b/.test(location.href)&&b.refreshWaitCheckRatePage()):/\/kf_fw_1wkfb\.php\?do=1\b/.test(location.href)&&(b.addUnrecognizedSizeWarning(),b.showErrorSizeSubmitWarning()),b.addLinksInPage()):"/kf_no1.php"===location.pathname?f.addUserNameLinkInRankPage():"/kf_fw_ig_mycard.php"===location.pathname&&g.handleMyCardPage(),Config.blockUserEnabled&&s.blockUsers(),Config.blockThreadEnabled&&s.blockThread(),Config.followUserEnabled&&s.followUsers(),a.default.isMobile&&s.bindElementTitleClick(),a.default.isInSpecialDomain&&["/read.php","/post.php","/message.php"].includes(location.pathname)&&(Config.kfSmileEnhanceExtensionEnabled&&p.importKfSmileEnhanceExtension(),p.replaceSiteLink()),$(document).clearQueue("AutoAction"),Config.autoPromoteHaloEnabled&&!i.getCookie(r.default.promoteHaloCookieName)&&$(document).queue("AutoAction",function(){return v.getPromoteHaloInfo()}),"/kf_fw_ig_index.php"===location.pathname&&$(document).queue("AutoAction",function(){return v.init()}),i.getCookie(r.default.lootCompleteCookieName)||(Config.autoLootEnabled?"/kf_fw_ig_index.php"===location.pathname||i.getCookie(r.default.lootAttackingCookieName)||$.isNumeric(i.getCookie(r.default.changePointsInfoCookieName))||$(document).queue("AutoAction",function(){return v.checkLoot()}):Config.autoSaveLootLogInSpecialCaseEnabled),Config.autoGetDailyBonusEnabled&&!i.getCookie(r.default.getDailyBonusCookieName)&&$(document).queue("AutoAction",function(){return s.getDailyBonus()}),!a.default.isInHomePage&&"/kf_fw_ig_index.php"!==location.pathname||!Config.autoBuyItemEnabled||i.getCookie(r.default.buyItemCookieName)||i.getCookie(r.default.buyItemReadyCookieName)||$(document).queue("AutoAction",function(){return h.buyItems(Config.buyItemIdList)}),Config.autoOpenBoxesAfterLootEnabled&&l.getValue(r.default.autoOpenBoxesAfterLootTmpLogName)&&(/kf_fw_ig_mybp\.php\?openboxes=true/.test(location.href)?(l.deleteValue(r.default.autoOpenBoxesAfterLootTmpLogName),$(document).queue("AutoAction",function(){return h.autoOpenBoxes()})):($(document).clearQueue("AutoAction"),$(document).queue("AutoAction",function(){setTimeout(function(){return location.href="kf_fw_ig_mybp.php?openboxes=true"},r.default.minActionInterval)}))),$(document).dequeue("AutoAction"),Config.autoChangeIdColorEnabled&&!i.getCookie(r.default.autoChangeIdColorCookieName)&&s.changeIdColor(),Config.showDrawCardTipsEnabled&&g.showDrawCardTips(),Config.timingModeEnabled&&(a.default.isInHomePage||"/kf_fw_ig_index.php"===location.pathname||/kf_fw_ig_mybp\.php\?openboxes=true/.test(location.href))&&s.startTimingMode(),Config.customScriptEnabled&&d.runCustomScript("end");var t=new Date;console.log("【KF Online助手】初始化耗时："+(t-e)+"ms")}})},{"./module/Bank":2,"./module/Card":3,"./module/Config":4,"./module/ConfigDialog":5,"./module/Const":6,"./module/Dialog":7,"./module/Index":8,"./module/Info":9,"./module/Item":10,"./module/Log":11,"./module/Loot":13,"./module/LootLog":14,"./module/Msg":15,"./module/Other":16,"./module/Post":17,"./module/Public":18,"./module/Read":19,"./module/Script":20,"./module/SelfRate":21,"./module/TmpLog":22,"./module/Util":23}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setNodeValue=n.handleBankPage=void 0;var a,T=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},D=i(e("./Util")),E=i(e("./Msg")),o=e("./Const"),M=(a=o)&&a.__esModule?a:{default:a},P=i(e("./Log")),B=(i(e("./TmpLog")),i(e("./Public")));i(e("./Script"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var F=0,N=Number.MAX_SAFE_INTEGER,U=(n.handleBankPage=function(){var e=$('.bank1 > tbody > tr:nth-child(2) > td:contains("你所拥有的贡献：")');if(e.length){var t=e.html();e.html(t.replace(/你所拥有的贡献：(-?\d+(?:\.\d+)?)/,function(e,t){return'你所拥有的贡献：<b id="pdGongXian" data-num="'+t+'">'+parseFloat(t).toLocaleString()+"</b>"}));var n=/注意你转账的是贡献，最小\[(\d+(?:\.\d+)?)\]，最大\[(\d+(?:\.\d+)?)\]/.exec(t);n&&(F=parseFloat(n[1]),N=parseFloat(n[2])),$(document).on("change",'input[name="to_money"]',function(){var e=$(this),t=parseFloat(e.val());(isNaN(t)||t<F||N<t)&&alert("转账数额的最小值为["+F+"]，最大值为["+N+"]，超过最大值请分多次转账")}),r()}},n.setNodeValue=function(e,t){if(e.length){var n=0;if($.isNumeric(t))n=parseFloat(t);else{var a=/(\+|-)=(\d+(?:\.\d+)?)/.exec(t);if(!a)return;var o=parseFloat(a[2]),i=parseFloat(e.data("num"));i=i||0,n=t.startsWith("+")?i+o:i-o}e.text(n.toLocaleString()).data("num",n)}}),r=function(){var A=$('\n<tr id="pdBankTransferArea">\n  <td style="vertical-align: top;">\n    使用说明：<br>每行一名用户，<br>如需单独设定转账数额，<br>可写为“用户名:贡献”<br>（注意是<b>英文冒号</b>）<br>例子：<br>\n    <pre style="border: 1px solid #9999ff; padding: 5px;">张三\n李四:0.1\n王五:1.2\n信仰风</pre>\n  </td>\n  <td>\n  <form>\n    <div style="display: inline-block;">\n      <label>用户列表：<br>\n        <textarea class="pd_textarea" name="users" style="width: 270px; height: 250px;"></textarea>\n      </label>\n    </div>\n    <div style="display: inline-block; margin-left: 10px;">\n      <label>通用转帐数额（如所有用户都已设定单独数额则可留空）：<br>\n        <input class="pd_input" name="transfer_money" type="text" style="width: 217px;">\n      </label><br>\n      <label style="margin-top: 5px;">转帐附言（可留空）：<br>\n        <textarea class="pd_textarea" name="msg" style="width: 225px; height: 206px;"></textarea>\n      </label>\n    </div>\n    <div>\n      <button type="submit">批量转账</button>\n      <button type="reset">重置</button>\n      <button name="random" type="button" title="为用户列表上的每个用户设定指定范围内的随机数额">随机数额</button>\n      <br><span class="pd_highlight">（注意：你转给对方的是贡献，每名用户的转账数额可超过单次转账的最大值，助手会自动分多次转账）</span>\n      '+(D.isIE()||D.isEdge()?'<br><span class="pd_highlight">注：IE和Edge浏览器在批量转账给中文名用户时会出现乱码，请使用其它浏览器进行批量转账</span>':"")+"\n    </div>\n  </form>\n  </td>\n</tr>\n").insertAfter(".bank1 > tbody > tr:nth-child(2)");A.find("form").submit(function(e){if(e.preventDefault(),E.destroy(),function(e){var t=e.find('[name="users"]'),n=t.val();if(!/^\s*\S+\s*$/m.test(n)||/^\s*:/m.test(n)||/:/.test(n)&&/:(\D|$)/m.test(n))return alert("用户列表格式不正确"),t.select().focus(),!1;if(/^\s*\S+?:0*(\.0\d+)?\s*$/m.test(n))return alert("转帐数额不能小于["+F+"]贡献"),t.select().focus(),!1;var a=e.find('[name="transfer_money"]'),o=parseFloat(a.val());if(/^\s*[^:]+\s*$/m.test(n)){if(!$.isNumeric(o))return alert("通用转账数额格式不正确"),a.select().focus(),!1;if(o<F)return alert("转帐数额不能小于"+F+"贡献"),a.select().focus(),!1}return!0}(A)){var t=parseFloat(A.find('[name="transfer_money"]').val());t=t||0;var n=A.find('[name="msg"]').val(),a=[],o=!0,i=!1,r=void 0;try{for(var l,d=A.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;if(s=$.trim(s)){var c=s,u=0;if(s.includes(":")){var p=s.split(":"),f=T(p,2);if(c=f[0],u=f[1],c=$.trim(c),void 0===u)continue}else u=t;var m=parseFloat(u);if(m=Math.floor(10*m)/10,N<m){for(var g=Math.floor(10*m/(10*N)),h=10*m%(10*N)/10,v=1;v<=g;v++)a.push([c,N]);.1<=h&&a.push([c,h])}else a.push([c,m])}}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}if(a.length){var b=0,y=[],_=!0,x=!1,k=void 0;try{for(var C,w=a[Symbol.iterator]();!(_=(C=w.next()).done);_=!0){var I=T(C.value,2),L=I[0];b+=I[1],y.includes(L)||y.push(L)}}catch(e){x=!0,k=e}finally{try{!_&&w.return&&w.return()}finally{if(x)throw k}}var S=$("#pdGongXian");0<S.length&&Math.floor(10*b)>Math.floor(10*parseFloat(S.data("num")))?alert("你当前没有["+b.toLocaleString()+"]贡献可供转账"):confirm("共计["+y.length+"]名用户，总计["+b.toLocaleString()+"]贡献，是否转账？")&&(N<b&&!confirm("你真的要转账["+b.toLocaleString()+"]贡献？请注意你转给对方的是贡献，是否继续？")||(E.wait('<strong>正在批量转账中，请耐心等待&hellip;</strong><i>剩余：<em class="pd_countdown">'+a.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),A.find("> td:last-child").append('<ul class="pd_result pd_stat"><li><strong>转账结果：</strong></li></ul>'),function(i,r){var l=0,d=0,s=0;$.each(i,function(n,e){var t=T(e,2),a=t[0],o=t[1];$(document).queue("Bank",function(){$.ajax({type:"POST",url:"hack.php?H_name=bank",timeout:M.default.defAjaxTimeout,data:"&action=virement&pwuser="+D.getGBKEncodeString(a)+"&to_money="+o+"&memo="+D.getGBKEncodeString(r),success:function(e){B.showFormatLog("批量转账",e);var t=D.getResponseMsg(e).msg,n=a+" <em>+"+o.toLocaleString()+"</em>";/完成转帐!/.test(t)?(l++,s+=o):(d++,/用户<b>.+?<\/b>不存在/.test(t)&&(t="用户不存在"),n+=' <span class="pd_notice">(错误：'+t+")</span>"),$(".pd_result:last").append("<li>"+n+"</li>")},error:function(){d++,$(".pd_result:last").append("\n<li>\n  "+a+":"+o.toLocaleString()+'\n  <span class="pd_notice">(错误：连接超时，转账结果未知，请到<a target="_blank" href="hack.php?H_name=bank&action=log">银行日志</a>里进行确认)</span>\n</li>\n')},complete:function(){var e=$(".pd_countdown:last");e.text(parseInt(e.text())-1);var t=e.closest(".pd_msg").data("stop");t&&$(document).clearQueue("Bank"),t||n===i.length-1?(E.destroy(),0<l&&P.push("批量转账","共有`"+l+"`次转账成功",{pay:{"贡献":-s}}),U($("#pdGongXian"),"-="+s),console.log("共有"+l+"次转账成功，共有"+d+"次转账失败，贡献-"+s),$(".pd_result:last").append("<li><b>共有<em>"+l+"</em>次转账成功"+(0<d?"，共有<em>"+d+"</em>次转账失败":"")+"：</b>贡献 <ins>-"+s.toLocaleString()+"</ins></li>"),E.show("<strong>共有<em>"+l+"</em>次转账成功"+(0<d?"，共有<em>"+d+"</em>次转账失败":"")+"</strong><i>贡献<ins>-"+s.toLocaleString()+"</ins></i>",-1)):setTimeout(function(){return $(document).dequeue("Bank")},M.default.bankActionInterval)}})})}),$(document).dequeue("Bank")}(a,n)))}}}).find('[name="random"]').click(function(){var e=[],t=!0,n=!1,a=void 0;try{for(var o,i=A.find('[name="users"]').val().split("\n")[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;(r=$.trim(r))&&e.push($.trim(r.split(":")[0]))}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}if(e.length){var l=prompt("设定随机数额的范围（注：最低转账数额为0.1贡献）","0.1-1");if(null!==l)if(l=$.trim(l),/^\d+(?:\.\d+)?-\d+(?:\.\d+)?$/.test(l)){var d=l.split("-"),s=parseFloat(d[0]),c=parseFloat(d[1]);if(c<s)alert("最大值不能低于最小值");else{var u="",p=!0,f=!1,m=void 0;try{for(var g,h=e[Symbol.iterator]();!(p=(g=h.next()).done);p=!0){u+=g.value+":"+Math.floor(10*(Math.random()*(c-s+.1)+s))/10+"\n"}}catch(e){f=!0,m=e}finally{try{!p&&h.return&&h.return()}finally{if(f)throw m}}A.find('[name="users"]').val(u)}}else alert("随机数额范围格式不正确")}})}},{"./Const":6,"./Log":11,"./Msg":15,"./Public":18,"./Script":20,"./TmpLog":22,"./Util":23}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleMyCardPage=n.showDrawCardTips=n.addStartBatchModeButton=void 0;var a,f=i(e("./Util")),o=e("./Const"),d=(a=o)&&a.__esModule?a:{default:a},s=i(e("./Msg")),m=i(e("./Log")),g=i(e("./Public")),r=i(e("./Script"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.addStartBatchModeButton=function(){var t=g.getSafeId();t&&$('.kf_fw_ig2 a[href^="kf_fw_card_my.php?id="]').length&&$('<div class="pd_item_btns"><button>开启批量模式</button></div>').insertAfter(".kf_fw_ig2").find("button").click(function(){var e=$(this),c=$(".kf_fw_ig2 > tbody > tr:gt(2)");if("开启批量模式"===e.text()){e.text("关闭批量模式"),c.on("click","a",function(e){e.preventDefault(),$(this).next(".pd_card_chk").click()}).find("td").has("a").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&$(this).css("position","relative").append('<input class="pd_card_chk" type="checkbox" value="'+e[1]+'">')});var r=[];$(".kf_fw_ig2 > tbody > tr:nth-child(2) > td").each(function(){var e=/kf_fw_card_my\.php\?id=(\d+)/.exec($(this).find("a").attr("href"));e&&r.push(parseInt(e[1]))});var u=function(){var e=!0,t=!1,n=void 0;try{for(var a,o=r[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;c.find("td").has('a[href="kf_fw_card_my.php?id='+i+'"]').find('[type="checkbox"]').prop("checked",!1)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}},p=$('\n<label><input name="uncheckPlayedCard" type="checkbox" checked> 不选已出战的卡片</label>\n<button name="selectOnlyOne" type="button">每类只保留一张</button>\n<button name="selectAll" type="button">全选</button>\n<button name="selectInverse" type="button">反选</button><br>\n<button name="convertCardsToVipTime" type="button">转换为VIP时间</button>\n').insertBefore(e);p.filter('[name="selectOnlyOne"]').click(function(){f.selectAll(c.find('[type="checkbox"]')),p.find('[name="uncheckPlayedCard"]').prop("checked")&&u();var e=new Set;c.find("a > img").each(function(){e.add($(this).attr("src"))});var t=!0,n=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value,l=c.find("td").has('img[src="'+r+'"]'),d=l.length,s=l.has('[type="checkbox"]:checked').length;1<d?d===s&&l.eq(0).find('[type="checkbox"]:checked').prop("checked",!1):l.find('[type="checkbox"]:checked').prop("checked",!1)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}}).end().filter('[name="selectAll"]').click(function(){f.selectAll(c.find('[type="checkbox"]')),p.find('[name="uncheckPlayedCard"]').prop("checked")&&u()}).end().filter('[name="selectInverse"]').click(function(){f.selectInverse(c.find('[type="checkbox"]')),p.find('[name="uncheckPlayedCard"]').prop("checked")&&u()}).end().filter('[name="convertCardsToVipTime"]').click(function(){s.destroy();var e=[];c.find('[type="checkbox"]:checked').each(function(){e.push(parseInt($(this).val()))}),e.length&&confirm("共选择了"+e.length+"张卡片，是否将卡片批量转换为VIP时间？")&&(s.wait('<strong>正在批量转换中&hellip;</strong><i>剩余：<em class="pd_countdown">'+e.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),function(a,t){var o=0,i=0,r=0,l=0;$(document).clearQueue("ConvertCardsToVipTime"),$.each(a,function(n,e){$(document).queue("ConvertCardsToVipTime",function(){$.ajax({type:"GET",url:"kf_fw_card_doit.php?do=recard&id="+e+"&safeid="+t+"&t="+$.now(),timeout:d.default.defAjaxTimeout,success:function(e){g.showFormatLog("将卡片转换为VIP时间",e);var t=f.getResponseMsg(e).msg,n=/增加(\d+)小时VIP时间(?:.*?获得(\d+)点恢复能量)?/.exec(t);n?(o++,r+=parseInt(n[1]),void 0!==n[2]&&(l+=parseInt(n[2]))):i++},error:function(){i++},complete:function(){var e=$(".pd_countdown:last");e.text(parseInt(e.text())-1);var t=e.closest(".pd_msg").data("stop");t&&$(document).clearQueue("ConvertCardsToVipTime"),t||n===a.length-1?(0<o&&m.push("将卡片转换为VIP时间","共有`"+o+"`张卡片成功为VIP时间",{gain:{"VIP小时":r,"能量":l},pay:{"卡片":-o}}),s.destroy(),console.log("共有"+o+"张卡片转换成功，共有"+i+"张卡片转换失败，VIP小时+"+r+"，能量+"+l),s.show("<strong>共有<em>"+o+"</em>张卡片转换成功"+(0<i?"，共有<em>"+i+"</em>张卡片转换失败":"")+"</strong><i>VIP小时<em>+"+r+"</em></i><i>能量<em>+"+l+"</em></i>",-1),$(".kf_fw_ig2 .pd_card_chk:checked").closest("td").fadeOut("normal",function(){var e=$(this).parent();$(this).remove(),e.children().length||e.remove()})):setTimeout(function(){$(document).dequeue("ConvertCardsToVipTime")},d.default.defAjaxInterval)}})})}),$(document).dequeue("ConvertCardsToVipTime")}(e,t))})}else e.text("开启批量模式"),c.off("click").find(".pd_card_chk").remove(),e.prevAll().remove()})},n.showDrawCardTips=function(){function i(e){var t=e-$.now(),n=0,a=0;0<t&&(a=Math.ceil(t/60/1e3),a-=60*(n=Math.floor(a/60))),$('<span id="pdDrawCardInterval" style="'+(t<=0?"color: #ff0080;":"")+'"> (抽卡：'+(0<n?n+"时":"")+a+"分)</span>").appendTo("#pdLoot").click(function(){if(t<=0)return!(location.href="kf_fw_ig_mycard.php")})}var e=parseInt(f.getCookie(d.default.drawCardCookieName));0<e?i(new Date(e)):(console.log("获取抽卡剩余时间Start"),$.get("kf_fw_ig_mycard.php?t="+$.now(),function(e){var t=/点击抽卡\(请等待(\d+)分钟\)/.exec(e);if(t){var n=parseInt(t[1]),a=f.getDate("+"+n+"m"),o=a<=new Date?f.getDate("+"+d.default.drawCardRetryInterval+"m"):a;f.setCookie(d.default.drawCardCookieName,a.getTime(),o),0===n&&s.show('<strong>当前已可抽卡，是否抽卡？</strong><a href="/kf_fw_ig_mycard.php">点此抽卡</a>',-1),Info.isInHomePage&&i(new Date(a)),r.runFunc("Card.showDrawCardTips_complete_",{minutes:n})}}))},n.handleMyCardPage=function(){var e=$('a[href^="kf_fw_ig_mycard.php?card=new"]:first');e.click(function(){return f.deleteCookie(d.default.drawCardCookieName)});var t=/点击抽卡\(请等待(\d+)分钟\)/.exec(e.text());if(t){var n=parseInt(t[1]),a=f.getDate("+"+n+"m"),o=a<=new Date?f.getDate("+"+d.default.drawCardRetryInterval+"m"):a;f.setCookie(d.default.drawCardCookieName,a.getTime(),o)}}},{"./Const":6,"./Log":11,"./Msg":15,"./Public":18,"./Script":20,"./Util":23}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clearData=n.normalize=n.changeStorageType=n.clear=n.write=n.read=n.init=n.Config=void 0;var c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=i(e("./Info")),u=o(e("./Util")),a=i(e("./Const")),l=o(e("./Log")),d=o(e("./TmpLog")),s=o(e("./LootLog")),p=o(e("./Item")),f=o(e("./Read"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}var m=a.default.storagePrefix+"config",g=n.Config={timingModeEnabled:!1,showTimingModeTipsType:"auto",autoGetDailyBonusEnabled:!1,getBonusAfterLootCompleteEnabled:!1,getBonusAfterSpeakCompleteEnabled:!1,autoPromoteHaloEnabled:!1,promoteHaloCostType:1,promoteHaloInterval:8,promoteHaloAutoIntervalEnabled:!0,promoteHaloLimit:0,autoLootEnabled:!1,attackTargetLevel:0,autoLootServerStatusType:"Any",autoSaveLootLogInSpecialCaseEnabled:!1,checkLootAfterTime:"00:05:00",lootLogSaveMaxNum:7,autoOpenBoxesAfterLootEnabled:!1,showChangePointsInfoEnabled:!1,levelPointList:{},keyLevelList:[],autoChangeLevelPointsEnabled:!1,customPointsScriptEnabled:!1,unusedPointNumAlertEnabled:!0,slowAttackEnabled:!1,alwaysOpenPointAreaEnabled:!1,alertServerStatusChangeEnabled:!1,alertServerStatusChangeType:0,showLevelEnemyStatEnabled:!1,showLiteLootLogEnabled:!1,showDrawCardTipsEnabled:!1,autoBuyItemEnabled:!1,buyItemIdList:[],buyItemAfterTime:"00:40:00",smLevelUpAlertEnabled:!1,smRankChangeAlertEnabled:!1,homePageThreadFastGotoLinkEnabled:!0,showFastGotoThreadPageEnabled:!1,maxFastGotoThreadPageNum:5,perPageFloorNum:10,highlightNewPostEnabled:!0,threadContentFontSize:0,customMySmColor:"",modifyKfOtherDomainEnabled:!0,multiQuoteEnabled:!0,userMemoEnabled:!1,userMemoList:{},parseMediaTagEnabled:!0,turnPageViaKeyboardEnabled:!1,buyThreadNoJumpEnabled:!0,saveBuyThreadLogEnabled:!1,saveBuyThreadLogMaxNum:2e3,preventCloseWindowWhenEditPostEnabled:!0,autoSavePostContentWhenSubmitEnabled:!1,kfSmileEnhanceExtensionEnabled:!1,blockUselessThreadButtonsEnabled:!1,defShowMsgDuration:-1,animationEffectOffEnabled:!1,showSearchLinkEnabled:!0,addFastNavMenuEnabled:!0,changeNewTipsColorEnabled:!0,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptList:[],browseType:"auto",adminMemberEnabled:!1,followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[],logSaveDays:30,logSortType:"time",logStatType:"current",logStatDays:7,autoChangeIdColorEnabled:!1,autoChangeIdColorType:"random",autoChangeIdColorInterval:24,changeAllAvailableIdColorEnabled:!0,customAutoChangeIdColorList:[],slowActionEnabled:!1,autoSaveArmsInfoEnabled:!1,sortArmsByGroupEnabled:!1,armsMemo:{},smeltArmsAfterOpenBoxesEnabled:!1,useItemsAfterOpenBoxesEnabled:!1,sellItemsAfterOpenBoxesEnabled:!1,defOpenBoxTypeList:[],defSmeltArmTypeList:[],defUseItemTypeList:[],defSellItemTypeList:[],showArmsFinalAdditionAfterOpenBoxesEnabled:!1},h=(n.init=function(){r.default.w.Config=$.extend(!0,{},g),"undefined"!=typeof GM_getValue&&(r.default.storageType=GM_getValue("StorageType"),"ByUid"!==r.default.storageType&&"Global"!==r.default.storageType&&(r.default.storageType="Default")),h()},n.read=function(){var e=u.readData("ByUid"===r.default.storageType?m+"_"+r.default.uid:m);if(e){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=y(e),r.default.w.Config=$.extend(!0,{},g,e))}}),v=n.write=function(){var e=u.getDifferenceSetOfObject(g,r.default.w.Config);u.writeData("ByUid"===r.default.storageType?m+"_"+r.default.uid:m,JSON.stringify(e))},b=n.clear=function(){return u.deleteData("ByUid"===r.default.storageType?m+"_"+r.default.uid:m)},y=(n.changeStorageType=function(e){var t=l.read(),n=d.read(),a=s.read(),o=p.readArmsInfo(),i=f.readBuyThreadLog();r.default.storageType=e,"undefined"!=typeof GM_setValue&&GM_setValue("StorageType",r.default.storageType),u.deepEqual(g,r.default.w.Config)&&$.isEmptyObject(t)||confirm("是否将助手设置和日志转移到对应存储类型中？（对应存储类型中的数据将被覆盖）")&&(v(),l.write(t),d.write(n),s.write(a),p.writeArmsInfo(o),f.writeBuyThreadLog(i))},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;var n=!0,a=!1,o=void 0;try{for(var i,r=u.entries(e)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=c(i.value,2),d=l[0],s=l[1];d in g&&$.type(s)===$.type(g[d])&&(t[d]=s)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return t});n.clearData=function(e){if("cookies"===e)for(var t in a.default)/CookieName$/.test(t)&&u.deleteCookie(a.default[t]);else"tmpData"===e?(d.clear(),localStorage.removeItem(a.default.multiQuoteStorageName),localStorage.removeItem(a.default.tempPointsLogListStorageName)):"config"===e?b():"log"===e?l.clear():"lootLog"===e?s.clear():"armsInfo"===e?p.clearArmsInfo():"buyThreadLog"===e&&f.clearBuyThreadLog()}},{"./Const":6,"./Info":9,"./Item":10,"./Log":11,"./LootLog":14,"./Read":19,"./TmpLog":22,"./Util":23}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.show=void 0;var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Script=require("./Script"),Script=_interopRequireWildcard(_Script);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var show=exports.show=function(){var o="pdConfigDialog";if(!(0<$("#"+o).length)){(0,_Config.read)(),Script.runFunc("ConfigDialog.show_before_");var e='\n<div class="pd_cfg_main">\n  <div class="pd_cfg_nav">\n    <a class="pd_btn_link" data-name="openClearDataDialog" title="清除与助手有关的数据" href="#">清除数据</a>\n    <a class="pd_btn_link" data-name="openRumCommandDialog" href="#">运行命令</a>\n    <a class="pd_btn_link" data-name="openImportOrExportSettingDialog" href="#">导入/导出设置</a>\n  </div>\n\n  <div class="pd_cfg_panel" style="margin-bottom: 5px;">\n    <fieldset>\n      <legend>\n        <label>\n          <input name="timingModeEnabled" type="checkbox"> 定时模式\n          <span class="pd_cfg_tips" title="可按时进行自动操作（包括自动领取每日奖励、自动提升战力光环、自动争夺、自动购买物品，需开启相关功能）\n只在论坛首页和争夺首页生效（不开启此模式的话只能在刷新页面后才会进行操作）">[?]</span>\n        </label>\n      </legend>\n      <label>\n        标题提示方案\n        <select name="showTimingModeTipsType">\n          <option value="auto">停留一分钟后显示</option>\n          <option value="always">总是显示</option>\n          <option value="never">不显示</option>\n        </select>\n        <span class="pd_cfg_tips" title="在首页的网页标题上显示定时模式提示的方案">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoGetDailyBonusEnabled" type="checkbox"> 自动领取每日奖励</label>\n      </legend>\n      <label>\n        <input name="getBonusAfterLootCompleteEnabled" type="checkbox"> 完成争夺后才领取\n        <span class="pd_cfg_tips" title="在完成争夺奖励后才领取每日奖励">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="getBonusAfterSpeakCompleteEnabled" type="checkbox"> 完成发言后才领取\n        <span class="pd_cfg_tips" title="在完成发言奖励后才领取每日奖励">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoPromoteHaloEnabled" type="checkbox"> 自动提升战力光环</label>\n      </legend>\n      <label>\n        花费\n        <select name="promoteHaloCostType" required>\n          <option value="1">100KFB</option>\n          <option value="2">1000KFB</option>\n          <option value="11">0.2贡献</option>\n          <option value="12">2贡献</option>\n        </select>\n        <span class="pd_cfg_tips" title="提升战力光环的花费类型">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n         高于 <input name="promoteHaloLimit" type="number" min="0" step="0.1" style="width: 55px;" required>\n         <span data-id="promoteHaloLimitUnit">KFB</span>时\n         <span class="pd_cfg_tips" title="在操作后所剩余的KFB或贡献高于指定值时才自动提升战力光环，设为0表示不限制">[?]</span>\n      </label><br>\n      <label>\n        每隔 <input name="promoteHaloInterval" type="number" min="8" style="width: 40px;" required> 小时\n        <span class="pd_cfg_tips" title="自动提升战力光环的间隔时间，最低值：8小时">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="promoteHaloAutoIntervalEnabled" type="checkbox" data-mutex="[name=promoteHaloInterval]"> 自动判断\n        <span class="pd_cfg_tips" title="自动判断提升战力光环的间隔时间（在有剩余次数时尽可能使用）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>争夺相关</legend>\n      <label>\n        <input name="autoLootEnabled" type="checkbox" data-disabled="[name=autoLootServerStatusType]"\n          data-mutex="[name=autoSaveLootLogInSpecialCaseEnabled]"> 自动争夺\n        <span class="pd_cfg_tips" title="当发现可以进行争夺时，会跳转到争夺首页进行自动攻击（点数分配等相关功能请在争夺首页上设置）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        攻击到第 <input name="attackTargetLevel" type="number" min="0" style="width: 40px;" required> 层\n        <span class="pd_cfg_tips" title="自动争夺的目标攻击层数（设为0表示攻击到被击败为止）">[?]</span>\n      </label><br>\n      <label>\n        在服务器状态为\n        <select name="autoLootServerStatusType" required>\n          <option value="Any">任意</option>\n          <option value="IdleOrNormal">空闲或正常</option>\n          <option value="Idle">空闲</option>\n        </select>\n        时才自动争夺\n        <span class="pd_cfg_tips" title="在服务器状态为指定状态时才进行自动争夺（选择“空闲”状态有可能错过争夺，请慎重考虑）">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoSaveLootLogInSpecialCaseEnabled" type="checkbox"> 在不使用助手争夺的情况下自动保存争夺记录\n        <span class="pd_cfg_tips" title="在不使用助手争夺的情况下自动检查并保存争夺记录（使用助手进行争夺的用户请勿勾选此选项）">[?]</span>\n      </label><br>\n      <label>\n        在 <input name="checkLootAfterTime" type="text" maxlength="8" style="width: 55px;" required> 之后争夺\n        <span class="pd_cfg_tips" title="在当天的指定时间之后检查争夺情况（本地时间），例：00:05:00（注：请不要设置得太接近零点，以免因本地时间与服务器时间有差异导致失效）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        保存最近的 <input name="lootLogSaveMaxNum" type="number" min="1" max="20" style="width: 40px;" required> 次记录\n        <span class="pd_cfg_tips" title="争夺记录最大保存次数，默认值：'+_Config.Config.lootLogSaveMaxNum+'，最大值：20">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoOpenBoxesAfterLootEnabled" type="checkbox"> 在争夺后自动一键开盒\n        <span class="pd_cfg_tips" title="在争夺完后自动一键开盒（并执行后续操作），要打开的盒子种类和要执行的后续操作请在我的物品页面进行设定">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="showChangePointsInfoEnabled" type="checkbox"> 在首页显示改点剩余次数\n        <span class="pd_cfg_tips" title="在首页显示改点剩余次数，冷却时则显示倒计时">[?]</span>\n      </label><br>\n      <label>\n        <input name="showDrawCardTipsEnabled" type="checkbox"> 显示抽卡提醒\n        <span class="pd_cfg_tips" title="显示抽卡提醒">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="alwaysOpenPointAreaEnabled" type="checkbox"> 总是打开属性界面\n        <span class="pd_cfg_tips" title="在争夺首页总是打开个人属性/装备界面">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>\n        <label><input name="autoBuyItemEnabled" type="checkbox"> 自动购买物品</label>\n      </legend>\n      <label>\n        物品ID列表 <input name="buyItemIdList" type="text" maxlength="50" style="width: 150px;">\n      </label>\n      <a class="pd_cfg_ml" data-name="openBuyItemTipsDialog" href="#">详细说明&raquo;</a><br>\n      <label>\n        在 <input name="buyItemAfterTime" type="text" maxlength="8" style="width: 55px;" required> 之后购买物品\n        <span class="pd_cfg_tips" title="在当天的指定时间之后购买物品（本地时间），例：00:40:00（注：请不要设置为在00:25:00之前的时间）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>首页相关</legend>\n      <label>\n        <input name="smLevelUpAlertEnabled" type="checkbox"> 神秘等级升级提醒\n        <span class="pd_cfg_tips" title="在神秘等级升级后进行提醒，只在首页生效">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="smRankChangeAlertEnabled" type="checkbox"> 系数排名变化提醒\n        <span class="pd_cfg_tips" title="在神秘系数排名发生变化时进行提醒，只在首页生效">[?]</span>\n      </label><br>\n      <label>\n        <input name="homePageThreadFastGotoLinkEnabled" type="checkbox"> 为首页帖子加上跳转至页末链接\n        <span class="pd_cfg_tips" title="开启此功能后，点击首页帖子链接右侧的回复时间部分即可快速跳转至帖子页末">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>版块页面相关</legend>\n      <label>\n        <input name="showFastGotoThreadPageEnabled" type="checkbox" data-disabled="[name=maxFastGotoThreadPageNum]"> 显示帖子页数快捷链接\n        <span class="pd_cfg_tips" title="在版块页面中显示帖子页数快捷链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        页数链接最大数量 <input name="maxFastGotoThreadPageNum" type="number" min="1" max="10" style="width: 40px;" required>\n        <span class="pd_cfg_tips" title="在帖子页数快捷链接中显示页数链接的最大数量">[?]</span>\n      </label><br>\n      <label>\n        <input name="highlightNewPostEnabled" type="checkbox"> 高亮今日的新帖\n        <span class="pd_cfg_tips" title="在版块页面中高亮今日新发表帖子的发表时间">[?]</span>\n      </label>\n    </fieldset>\n  </div>\n\n  <div class="pd_cfg_panel">\n    <fieldset>\n      <legend>帖子页面相关</legend>\n      <label>\n        帖子每页楼层数量\n        <select name="perPageFloorNum">\n          <option value="10">10</option>\n          <option value="20">20</option>\n          <option value="30">30</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于电梯直达和帖子页数快捷链接等功能，如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        帖子内容字体大小 <input name="threadContentFontSize" type="number" min="7" max="72" style="width: 40px;"> px\n        <span class="pd_cfg_tips" title="帖子内容字体大小，留空表示使用默认大小，推荐值：14">[?]</span>\n      </label><br>\n      <label>\n        <input name="turnPageViaKeyboardEnabled" type="checkbox"> 通过左右键翻页\n        <span class="pd_cfg_tips" title="在帖子和搜索页面通过左右键进行翻页">[?]</span>\n      </label><br>\n      <label>\n        <input name="autoChangeIdColorEnabled" type="checkbox" data-disabled="[data-name=openAutoChangeSmColorPage]"> 自动更换ID颜色\n        <span class="pd_cfg_tips" title="可自动更换ID颜色，请点击详细设置前往相应页面进行自定义设置">[?]</span>\n      </label>\n      <a data-name="openAutoChangeSmColorPage" class="pd_cfg_ml" target="_blank" href="kf_growup.php">详细设置&raquo;</a><br>\n      <label>\n        自定义本人的神秘颜色 <input name="customMySmColor" maxlength="7" style="width: 50px;" type="text">\n        <input style="margin-left: 0;" type="color" data-name="customMySmColorSelect">\n        <span class="pd_cfg_tips" title="自定义本人的神秘颜色（包括帖子页面的ID显示颜色和楼层边框颜色，仅自己可见），例：#009cff，如无需求可留空">[?]</span>\n      </label><br>\n      <label>\n        <input name="userMemoEnabled" type="checkbox" data-disabled="[data-name=openUserMemoDialog]"> 显示用户备注\n        <span class="pd_cfg_tips" title="在楼层内的用户名旁显示该用户的自定义备注，请点击详细设置自定义用户备注">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openUserMemoDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="modifyKfOtherDomainEnabled" type="checkbox"> 将绯月其它域名的链接修改为当前域名\n        <span class="pd_cfg_tips" title="将帖子和短消息中的绯月其它域名的链接修改为当前域名">[?]</span>\n      </label><br>\n      <label>\n        <input name="multiQuoteEnabled" type="checkbox"> 开启多重引用功能\n        <span class="pd_cfg_tips" title="在帖子页面开启多重回复和多重引用功能">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="parseMediaTagEnabled" type="checkbox"> 解析多媒体标签\n        <span class="pd_cfg_tips" title="在帖子页面解析HTML5多媒体标签，详见【常见问题12】">[?]</span>\n      </label><br>\n      <label>\n        <input name="buyThreadNoJumpEnabled" type="checkbox" data-disabled="[name=saveBuyThreadLogEnabled]" data-mutex="true"> 购买帖子时不跳转\n        <span class="pd_cfg_tips" title="使用Ajax的方式购买帖子，购买时页面不会跳转">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="saveBuyThreadLogEnabled" type="checkbox"> 保存购买帖子记录\n        <span class="pd_cfg_tips" title="自动保存购买帖子的记录，可在助手日志或购买人名单里点击查看购买记录（需同时开启“购买帖子时不跳转”的功能）">[?]</span>\n      </label><br>\n      <label>\n        <input name="preventCloseWindowWhenEditPostEnabled" type="checkbox"> 写帖子时阻止关闭页面\n        <span class="pd_cfg_tips" title="在撰写发帖内容时，如不小心关闭了页面会进行提示">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="autoSavePostContentWhenSubmitEnabled" type="checkbox"> 提交时保存发帖内容\n        <span class="pd_cfg_tips" title="在提交时自动保存发帖内容，以便在出现意外情况时能够恢复发帖内容（需在不关闭当前标签页的情况下才能起效）">[?]</span>\n      </label><br>\n      <label>\n        <input name="kfSmileEnhanceExtensionEnabled" type="checkbox" '+(_Info2.default.isInSpecialDomain?"":"disabled")+'> 开启绯月表情增强插件\n        <span class="pd_cfg_tips" title="在发帖框上显示绯月表情增强插件（仅在miaola.info域名下生效），该插件由eddie32开发">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="blockUselessThreadButtonsEnabled" type="checkbox"> 屏蔽无用按钮\n        <span class="pd_cfg_tips" title="屏蔽帖子页面上无用的按钮（如：非自己楼层上的编辑按钮）">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>其它设置</legend>\n      <label class="pd_highlight">\n        存储类型\n        <select data-name="storageType">\n          <option value="Default">默认</option>\n          <option value="ByUid">按uid</option>\n          <option value="Global">全局</option>\n        </select>\n        <span class="pd_cfg_tips" title="助手设置和日志的存储方式，详情参见【常见问题1】">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        浏览器类型\n        <select name="browseType">\n          <option value="auto">自动检测</option>\n          <option value="desktop">桌面版</option>\n          <option value="mobile">移动版</option>\n        </select>\n        <span class="pd_cfg_tips" title="用于在KFOL助手上判断浏览器的类型，一般使用自动检测即可；\n如果当前浏览器与自动检测的类型不相符（移动版会在设置界面标题上显示“For Mobile”的字样），请手动设置为正确的类型">[?]</span>\n      </label><br>\n      <label>\n        消息显示时间 <input name="defShowMsgDuration" type="number" min="-1" style="width: 46px;" required> 秒\n        <span class="pd_cfg_tips" title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15（默认值：-1）">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        日志保存天数 <input name="logSaveDays" type="number" min="1" max="270" style="width: 46px;" required>\n        <span class="pd_cfg_tips" title="日志保存天数，默认值：'+_Config.Config.logSaveDays+'，最大值：270">[?]</span>\n      </label><br>\n      <label>\n        <input name="showSearchLinkEnabled" type="checkbox"> 显示搜索链接\n        <span class="pd_cfg_tips" title="在用户菜单上显示搜索对话框的链接">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="animationEffectOffEnabled" type="checkbox"> 禁用动画效果\n        <span class="pd_cfg_tips" title="禁用jQuery的动画效果（推荐在配置较差的机器上使用）">[?]</span>\n      </label><br>\n      <label>\n        <input name="addFastNavMenuEnabled" type="checkbox"> 添加快捷导航菜单\n        <span class="pd_cfg_tips" title="为顶部导航栏添加快捷导航菜单">[?]</span>\n      </label>\n      <label class="pd_cfg_ml">\n        <input name="changeNewTipsColorEnabled" type="checkbox"> 修改新提醒颜色\n        <span class="pd_cfg_tips" title="修改顶部用户菜单的新提醒的颜色，可根据不同的消息提醒（新短信、新回复、新评分），分别设定不同的颜色">[?]</span>\n      </label><br>\n      <label>\n        <input name="customCssEnabled" type="checkbox" data-disabled="[data-name=openCustomCssDialog]"> 添加自定义CSS\n        <span class="pd_cfg_tips" title="为页面添加自定义的CSS内容，请点击详细设置填入自定义的CSS内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomCssDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="customScriptEnabled" type="checkbox" data-disabled="[data-name=openCustomScriptDialog]"> 执行自定义脚本\n        <span class="pd_cfg_tips" title="执行自定义的javascript脚本，请点击详细设置填入自定义的脚本内容">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openCustomScriptDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="adminMemberEnabled" type="checkbox"> 我是管理成员\n        <span class="pd_cfg_tips" title="管理成员可开启此功能，助手会开启部分只有管理成员才能使用的功能，非管理成员开启此功能无效">[?]</span>\n      </label>\n    </fieldset>\n    <fieldset>\n      <legend>关注和屏蔽</legend>\n      <label>\n        <input name="followUserEnabled" type="checkbox" data-disabled="[data-name=openFollowUserDialog]"> 关注用户\n        <span class="pd_cfg_tips" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openFollowUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockUserEnabled" type="checkbox" data-disabled="[data-name=openBlockUserDialog]"> 屏蔽用户\n        <span class="pd_cfg_tips" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockUserDialog" href="#">详细设置&raquo;</a><br>\n      <label>\n        <input name="blockThreadEnabled" type="checkbox" data-disabled="[data-name=openBlockThreadDialog]"> 屏蔽帖子\n        <span class="pd_cfg_tips" title="开启屏蔽标题中包含指定关键字的帖子的功能，请点击详细设置管理屏蔽关键字">[?]</span>\n      </label>\n      <a class="pd_cfg_ml" data-name="openBlockThreadDialog" href="#">详细设置&raquo;</a><br>\n    </fieldset>\n  </div>\n</div>\n\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a target="_blank" href="read.php?tid=508450">By 喵拉布丁</a>\n    <i style="color: #666; font-style: normal;">(V'+_Info2.default.version+')</i>\n    <a target="_blank" href="https://gitee.com/miaolapd/KF_Online_Assistant/wikis/pages?title=%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">[常见问题]</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button name="default" type="button">默认值</button>\n</div>',i=Dialog.create(o,"KFOL助手设置"+(_Info2.default.isMobile?" (For Mobile)":""),e);i.submit(function(e){if(e.preventDefault(),verifyMainConfig(i)){var t=Config.timingModeEnabled;(0,_Config.read)();var n=getMainConfigValue(i);n=(0,_Config.normalize)(n),$.extend(Config,n),(0,_Config.write)();var a=i.find('[data-name="storageType"]').val();if(a!==_Info2.default.storageType){if(!confirm("是否修改存储类型？"))return;return(0,_Config.changeStorageType)(a),alert("存储类型已修改"),void location.reload()}Dialog.close(o),t!==n.timingModeEnabled&&confirm("你已修改了定时模式的设置，需要刷新页面才能生效，是否立即刷新？")&&location.reload()}}).find('[name="default"]').click(function(){confirm("是否重置所有设置？")&&((0,_Config.clear)(),alert("设置已重置"),location.reload())}),i.on("click",'a[data-name^="open"][href="#"]',function(e){e.preventDefault();var t=$(this);if(!t.hasClass("pd_disabled_link")){var n=t.data("name");"openClearDataDialog"===n?showClearDataDialog():"openRumCommandDialog"===n?showRunCommandDialog():"openImportOrExportSettingDialog"===n?showImportOrExportSettingDialog():"openBuyItemTipsDialog"===n?showBuyItemTipsDialog():"openCustomSmColorDialog"===n?showCustomSmColorDialog():"openUserMemoDialog"===n?showUserMemoDialog():"openCustomCssDialog"===n?showCustomCssDialog():"openCustomScriptDialog"===n?Script.showDialog():"openFollowUserDialog"===n?showFollowUserDialog():"openBlockUserDialog"===n?showBlockUserDialog():"openBlockThreadDialog"===n&&showBlockThreadDialog()}}).find('[name="promoteHaloCostType"]').change(function(){var e=parseInt($(this).val());i.find('[data-id="promoteHaloLimitUnit"]').text(11<=e?"贡献":"KFB")}).end().find('[data-name="customMySmColorSelect"]').change(function(){i.find('[name="customMySmColor"]').val($(this).val().toString().toLowerCase())}).end().find('[name="customMySmColor"]').change(function(){var e=$.trim($(this).val());/^#[0-9a-fA-F]{6}$/.test(e)&&i.find('[data-name="customMySmColorSelect"]').val(e.toLowerCase())}),setMainConfigValue(i),Dialog.show(o),Script.runFunc("ConfigDialog.show_after_")}},setMainConfigValue=function(e){e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?e.prop("checked",!0===Config[t]):e.val(Config[t]))}),e.find('[name="promoteHaloCostType"]').trigger("change"),e.find('[name="buyItemIdList"]').val(Config.buyItemIdList.join(",")),e.find('[name="threadContentFontSize"]').val(0<Config.threadContentFontSize?Config.threadContentFontSize:""),e.find('[data-name="customMySmColorSelect"]').val(Config.customMySmColor),e.find('[data-name="storageType"]').val(_Info2.default.storageType),"undefined"==typeof GM_getValue&&e.find('[data-name="storageType"] > option:gt(0)').prop("disabled",!0)},getMainConfigValue=function(e){var a={};return e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");if(t in Config)if(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t])a[t]=Boolean(e.prop("checked"));else if("number"==typeof Config[t]){var n=$.trim(e.val());/\d+\.\d+/.test(n)?a[t]=parseFloat(n):a[t]=parseInt(n),"threadContentFontSize"===t&&isNaN(a[t])&&(a[t]=0)}else a[t]=$.trim(e.val())}),a.buyItemIdList?a.buyItemIdList=a.buyItemIdList.split(","):a.buyItemIdList=[],a},verifyMainConfig=function(e){var t=e.find('[name="checkLootAfterTime"]'),n=$.trim(t.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(n))return alert("在指定时间之后争夺格式不正确"),t.select().focus(),!1;if(n<"00:01:00")return alert("在指定时间之后争夺不得小于00:01:00"),t.select().focus(),!1;var a=e.find('[name="buyItemIdList"]'),o=$.trim(a.val());if(e.find('[name="autoBuyItemEnabled"]').prop("checked")){if(!/^(\d+)(\|\d+)*(,(\d+)(\|\d+)*)?$/.test(o))return alert("购买物品ID列表格式不正确"),a.select().focus(),!1;if(o.includes("901"))return alert("不支持自动购买重生之药"),a.select().focus(),!1}var i=e.find('[name="buyItemAfterTime"]'),r=$.trim(i.val());if(!/^(2[0-3]|[0-1][0-9]):[0-5][0-9]:[0-5][0-9]$/.test(r))return alert("在指定时间之后购买物品格式不正确"),i.select().focus(),!1;if(r<"00:25:00")return alert("在指定时间之后购买物品不得小于00:25:00"),i.select().focus(),!1;var l=e.find('[name="customMySmColor"]'),d=$.trim(l.val());return!(d&&!/^#[0-9a-fA-F]{6}$/.test(d))||(alert("自定义本人的神秘颜色格式不正确，例：#009cff"),l.select().focus(),!1)},showClearDataDialog=function(){var e="pdClearDataDialog";if(!(0<$("#"+e).length)){var g=Dialog.create(e,"清除数据",'\n<div class="pd_cfg_main">\n  <fieldset style="margin-top: 5px;">\n    <legend>请选择想清除的临时缓存数据（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</legend>\n    <select name="caches" size="2" style="width: 340px;" multiple>\n      <option value="cookies">助手Cookies</option><option value="tmpData">助手临时数据</option>\n    </select>\n  </fieldset>\n  <fieldset style="margin-top: 5px;">\n    <legend>请选择想清除的设置或日志（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</legend>\n    <select name="settingsAndLogs" size="5" style="width: 340px;" multiple>\n      <option value="config">助手设置</option><option value="log">助手日志</option><option value="lootLog">争夺记录</option>\n      <option value="armsInfo">装备信息</option><option value="buyThreadLog">购买帖子记录</option>\n    </select>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit" style="color: #f00;">清除数据</button>\n  <button data-action="close" type="button">取消</button>\n</div>');g.on("keydown","select",function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).submit(function(e){e.preventDefault();var t=g.find('[name="caches"]').val(),n=g.find('[name="settingsAndLogs"]').val();if((t||n)&&confirm("是否清除选定的数据？")){t=t||[],n=n||[];var a=!0,o=!1,i=void 0;try{for(var r,l=t[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value;(0,_Config.clearData)(d)}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}var s=!0,c=!1,u=void 0;try{for(var p,f=n[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=p.value;(0,_Config.clearData)(m)}}catch(e){c=!0,u=e}finally{try{!s&&f.return&&f.return()}finally{if(c)throw u}}alert("选定的数据已清除"),location.reload()}}),Dialog.show(e),Script.runFunc("ConfigDialog.showClearDataDialog_after_")}},showRunCommandDialog=function(){var e="pdRunCommandDialog";if(!(0<$("#"+e).length)){Dialog.close("pdConfigDialog");var t=Dialog.create(e,"运行命令",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    运行命令快捷键：<b>Ctrl+Enter</b>；清除命令快捷键：<b>Ctrl+退格键</b><br>\n    按<b>F12键</b>可打开浏览器控制台查看消息（需切换至控制台或Console标签）\n  </div>\n  <textarea name="cmd" wrap="off" style="width: 750px; height: 300px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">运行</button>\n  <button name="clear" type="button">清除</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),n=t.find('[name="cmd"]');t.submit(function(e){e.preventDefault();var t=n.val();t&&Script.runCmd(t,!0)}).end().find('[name="clear"]').click(function(){n.val("").focus()}),n.keydown(function(e){e.ctrlKey&&13===e.keyCode?t.submit():e.ctrlKey&&8===e.keyCode&&t.find('[name="clear"]').click()}),Dialog.show(e),n.focus()}},showImportOrExportSettingDialog=function(){var e="pdImOrExSettingDialog";if(!(0<$("#"+e).length)){(0,_Config.read)();var t=Dialog.create(e,"导入或导出设置",'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=t.find('[name="setting"]');t.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(n.val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}t&&"object"===$.type(t)?(t=(0,_Config.normalize)(t),_Info2.default.w.Config=$.extend(!0,{},_Config.Config,t),(0,_Config.write)(),alert("设置已导入"),location.reload()):alert("设置有错误")}}}),Dialog.show(e),n.val(JSON.stringify(Util.getDifferenceSetOfObject(_Config.Config,Config))).select().focus()}},showCustomCssDialog=function(){var t="pdCustomCssDialog";if(!(0<$("#"+t).length)){var e=Dialog.create(t,"自定义CSS",'\n<div class="pd_cfg_main">\n  <strong>自定义CSS内容：</strong><br>\n  <textarea name="customCssContent" wrap="off" style="width: 750px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a target="_blank" href="read.php?tid=500969">CSS规则收集贴</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=e.find('[name="customCssContent"]');e.submit(function(e){e.preventDefault(),Config.customCssContent=$.trim(n.val()),(0,_Config.write)(),Dialog.close(t),alert("自定义CSS修改成功（需刷新页面后才可生效）")}),n.val(Config.customCssContent),Dialog.show(t),n.focus()}},showUserMemoDialog=function(){var f="pdUserMemoDialog";if(!(0<$("#"+f).length)){var e=Dialog.create(f,"用户备注",'\n<div class="pd_cfg_main">\n  按照“用户名:备注”的格式（注意是英文冒号），每行一个<br>\n  <textarea name="userMemoList" wrap="off" style="width: 320px; height: 400px; white-space: pre;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),m=e.find('[name="userMemoList"]');e.submit(function(e){e.preventDefault();var t=$.trim(m.val()),n=!0,a=!(Config.userMemoList={}),o=void 0;try{for(var i,r=t.split("\n")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(l=$.trim(l)){if(!/.+?:.+/.test(l))return alert("用户备注格式不正确"),void m.focus();var d=l.split(":"),s=_slicedToArray(d,2),c=s[0],u=s[1],p=void 0===u?"":u;p&&(Config.userMemoList[c.trim()]=p.trim())}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}(0,_Config.write)(),Dialog.close(f)});var t="",n=!0,a=!1,o=void 0;try{for(var i,r=Util.entries(Config.userMemoList)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=_slicedToArray(i.value,2);t+=l[0]+":"+l[1]+"\n"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}m.val(t),Dialog.show(f),m.focus()}},showFollowUserDialog=function(){var l="pdFollowUserDialog";if(!(0<$("#"+l).length)){var d=Dialog.create(l,"关注用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label>\n      <input name="highlightFollowUserThreadInHpEnabled" type="checkbox"> 高亮所关注用户的首页帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在首页下的帖子链接">[?]</span>\n    </label><br>\n    <label>\n      <input name="highlightFollowUserThreadLinkEnabled" type="checkbox"> 高亮所关注用户的帖子链接\n      <span class="pd_cfg_tips" title="高亮所关注用户在版块页面下的帖子链接">[?]</span>\n    </label><br>\n  </div>\n  <ul id="pdFollowUserList" style="margin-top: 5px; min-width: 274px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addFollowUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExFollowUserListDialog" href="#">导入/导出关注用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),n=d.find("#pdFollowUserList"),s=function(e){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 178px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>\n').appendTo(n)};d.submit(function(e){e.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=d.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked"),Config.highlightFollowUserThreadLinkEnabled=d.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked"),Config.followUserList=[],n.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());""!==t&&-1===Util.inFollowOrBlockUserList(t,Config.followUserList)&&Config.followUserList.push({name:t})}),(0,_Config.write)(),Dialog.close(l)}),n.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),d.find('[data-name="selectAll"]').click(function(){return Util.selectAll(n.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(n.find('[type="checkbox"]'))}).end().find('[data-name="deleteSelect"]').click(function(e){e.preventDefault();var t=n.find('li:has([type="checkbox"]:checked)');t.length&&confirm("是否删除所选用户？")&&(t.remove(),Dialog.resize(l))}),d.find('[name="addFollowUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(e){e.preventDefault();var t=!0,n=!1,a=void 0;try{for(var o,i=$.trim(d.find('[name="addFollowUser"]').val()).split(",")[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;(r=$.trim(r))&&-1===Util.inFollowOrBlockUserList(r,Config.followUserList)&&s(r)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}d.find('[name="addFollowUser"]').val(""),Dialog.resize(l)}).end().find('[data-name="openImOrExFollowUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("关注用户","followUserList")}),d.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked",Config.highlightFollowUserThreadInHPEnabled),d.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked",Config.highlightFollowUserThreadLinkEnabled);var e=!0,t=!1,a=void 0;try{for(var o,i=Config.followUserList[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var r=o.value;s(r.name)}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}Dialog.show(l)}},showBlockUserDialog=function(){var d="pdBlockUserDialog";if(!(0<$("#"+d).length)){var s=Dialog.create(d,"屏蔽用户",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px; line-height: 24px;">\n    <label>\n      默认屏蔽类型\n      <select name="blockUserDefaultType">\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n    </label>\n    <label class="pd_cfg_ml">\n      <input name="blockUserAtTipsEnabled" type="checkbox"> 屏蔽@提醒 <span class="pd_cfg_tips" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n    </label><br>\n    <label>版块屏蔽范围\n      <select name="blockUserForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label><br>\n    <label>版块ID列表\n      <input name="blockUserFidList" type="text" style="width: 220px;"> \n      <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n    </label>\n  </div>\n  <ul id="pdBlockUserList" style="margin-top: 5px; min-width: 362px; line-height: 24px;"></ul>\n  <div style="margin-top: 5px;">\n    <div style="display: inline-block;">\n      <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n      <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    </div>\n    <div style="float: right;">\n      <a class="pd_btn_link" data-name="modify" href="#">修改为</a>\n      <select>\n        <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n      </select>\n      <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n    </div>\n  </div>\n  <div style="margin-top: 5px;" title="添加多个用户请用英文逗号分隔">\n    <input name="addBlockUser" style="width: 200px;" type="text">\n    <a class="pd_btn_link" data-name="add" href="#">添加</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockUserListDialog" href="#">导入/导出屏蔽用户</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),c=s.find("#pdBlockUserList"),u=function(e,t){$('\n<li>\n  <input type="checkbox">\n  <input name="username" type="text" style="width: 150px; margin-left: 5px;" maxlength="15" value="'+e+'">\n  <select name="blockType" style="margin-left: 5px;">\n    <option value="0">屏蔽主题和回帖</option><option value="1">仅屏蔽主题</option><option value="2">仅屏蔽回帖</option>\n  </select>\n  <a class="pd_btn_link" data-name="delete" href="#">删除</a>\n</li>').appendTo(c).find('[name="blockType"]').val(t)};s.submit(function(e){e.preventDefault(),Config.blockUserDefaultType=parseInt(s.find('[name="blockUserDefaultType"]').val()),Config.blockUserAtTipsEnabled=s.find('[name="blockUserAtTipsEnabled"]').prop("checked"),Config.blockUserForumType=parseInt(s.find('[name="blockUserForumType"]').val());var t=new Set,n=!0,a=!1,o=void 0;try{for(var i,r=$.trim(s.find('[name="blockUserFidList"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=parseInt(l),!isNaN(l)&&0<l&&t.add(l)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Config.blockUserFidList=[].concat(_toConsumableArray(t)),Config.blockUserList=[],c.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="username"]').val());if(""!==t&&-1===Util.inFollowOrBlockUserList(t,Config.blockUserList)){var n=parseInt(e.find('[name="blockType"]').val());Config.blockUserList.push({name:t,type:n})}}),(0,_Config.write)(),Dialog.close(d)}),c.on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).parent().remove()}),s.find('[data-name="selectAll"]').click(function(){return Util.selectAll(c.find('input[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return Util.selectInverse(c.find('input[type="checkbox"]'))}).end().find('[data-name="modify"]').click(function(e){e.preventDefault();var t=$(this).next("select").val();c.find('li:has([type="checkbox"]:checked) > select').val(t)}).end().find('[data-name="deleteSelect"]').click(function(e){e.preventDefault();var t=c.find('li:has([type="checkbox"]:checked)');t.length&&confirm("是否删除所选用户？")&&(t.remove(),Dialog.resize(d))}),s.find('[name="addBlockUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next("a").click())}).end().find('[data-name="add"]').click(function(e){e.preventDefault();var t=parseInt(s.find('[name="blockUserDefaultType"]').val()),n=!0,a=!1,o=void 0;try{for(var i,r=$.trim(s.find('[name="addBlockUser"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;(l=$.trim(l))&&-1===Util.inFollowOrBlockUserList(l,Config.blockUserList)&&u(l,t)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}s.find('[name="addBlockUser"]').val(""),Dialog.resize(d)}).end().find('[name="blockUserForumType"]').change(function(){s.find('[name="blockUserFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockUserListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽用户","blockUserList")}),s.find('[name="blockUserDefaultType"]').val(Config.blockUserDefaultType),s.find('[name="blockUserAtTipsEnabled"]').prop("checked",Config.blockUserAtTipsEnabled),s.find('[name="blockUserForumType"]').val(Config.blockUserForumType).triggerHandler("change"),s.find('[name="blockUserFidList"]').val(Config.blockUserFidList.join(","));var e=!0,t=!1,n=void 0;try{for(var a,o=Config.blockUserList[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;u(i.name,i.type)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}Dialog.show(d)}},showBlockThreadDialog=function showBlockThreadDialog(){var dialogName="pdBlockThreadDialog";if(!(0<$("#"+dialogName).length)){var html='\n<div class="pd_cfg_main">\n  <div style="border-bottom: 1px solid #9191ff; margin-bottom: 7px; padding-bottom: 5px;">\n    标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n    用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n    <label>\n      默认版块屏蔽范围\n      <select name="blockThreadDefForumType">\n        <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n      </select>\n    </label>\n    <label style="margin-left: 5px;">默认版块ID列表 <input name="blockThreadDefFidList" type="text" style="width: 150px;"></label>\n  </div>\n  <table id="pdBlockThreadList" style="line-height: 22px; text-align: center;">\n    <tbody>\n      <tr>\n        <th style="width: 220px;">标题关键字(必填)</th>\n        <th style="width: 62px;">屏蔽用户</th>\n        <th style="width: 200px;">用户名 <span class="pd_cfg_tips" title="多个用户名请用英文逗号分隔">[?]</span></th>\n        <th style="width: 62px;">屏蔽范围</th>\n        <th style="width: 132px;">版块ID <span class="pd_cfg_tips" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span></th>\n        <th style="width: 35px;"></th>\n      </tr>\n    </tbody>\n  </table>\n  <div data-name="blockThreadAddBtns" style="margin-top: 5px;">\n    <a class="pd_btn_link" data-name="addOne" href="#">增加1个</a>\n    <a class="pd_btn_link" data-name="addFive" href="#">增加5个</a>\n    <a class="pd_btn_link pd_highlight" data-name="clear" href="#">清除所有</a>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBlockThreadListDialog" href="#">导入/导出屏蔽帖子</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',$dialog=Dialog.create(dialogName,"屏蔽帖子",html,"width: 768px;"),$blockThreadList=$dialog.find("#pdBlockThreadList"),addBlockThread=function(e,t,n,a,o){$('\n<tr>\n  <td><input name="keyWord" type="text" style="width: 208px;" value="'+e+'"></td>\n  <td><select name="userType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="userList" type="text" style="width: 188px;" value="'+n.join(",")+'" '+(0===t?"disabled":"")+'></td>\n  <td><select name="fidType"><option value="0">所有</option><option value="1">包括</option><option value="2">排除</option></select></td>\n  <td><input name="fidList" type="text" style="width: 120px;" value="'+o.join(",")+'" '+(0===a?"disabled":"")+'></td>\n  <td><a href="#" data-name="delete">删除</a></td>\n</tr>\n').appendTo($blockThreadList).find('[name="userType"]').val(t).end().find('[name="fidType"]').val(a)},verify=function verify(){var flag=!0;return $blockThreadList.find("tr:gt(0)").each(function(){var $this=$(this),$txtKeyWord=$this.find('[name="keyWord"]'),keyWord=$txtKeyWord.val();if(""!==$.trim(keyWord)&&/^\/.+\/[gimuy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select().focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($dialog.find('[name="blockThreadDefForumType"]').val());var t=new Set,n=!0,a=!1,o=void 0;try{for(var i,r=$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=parseInt(l),!isNaN(l)&&0<l&&t.add(l)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Config.blockThreadDefFidList=[].concat(_toConsumableArray(t)),Config.blockThreadList=[],$blockThreadList.find("tr:gt(0)").each(function(){var e=$(this),t=e.find('[name="keyWord"]').val();if(""!==$.trim(t)){var n={keyWord:t},a=parseInt(e.find('[name="userType"]').val());if(0<a){var o=new Set,i=!0,r=!1,l=void 0;try{for(var d,s=$.trim(e.find('[name="userList"]').val()).split(",")[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;(c=$.trim(c))&&o.add(c)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}0<o.size&&(n[2===a?"excludeUser":"includeUser"]=[].concat(_toConsumableArray(o)))}var u=parseInt(e.find('[name="fidType"]').val());if(0<u){var p=new Set,f=!0,m=!1,g=void 0;try{for(var h,v=$.trim(e.find('[name="fidList"]').val()).split(",")[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=h.value;b=parseInt(b),!isNaN(b)&&0<b&&p.add(b)}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}0<p.size&&(n[2===u?"excludeFid":"includeFid"]=[].concat(_toConsumableArray(p)))}Config.blockThreadList.push(n)}}),(0,_Config.write)(),Dialog.close(dialogName)}}),$blockThreadList.on("change","select",function(){var e=$(this);e.parent("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").remove()}),$dialog.find('[data-name="addOne"], [data-name="addFive"]').click(function(e){e.preventDefault();var t=1;$(this).is('[data-name="addFive"]')&&(t=5);for(var n=1;n<=t;n++)addBlockThread("",0,[],parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(","));Dialog.resize(dialogName)}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有屏蔽关键字？")&&($blockThreadList.find("tbody > tr:gt(0)").remove(),Dialog.resize(dialogName))}).end().find('[name="blockThreadDefForumType"]').change(function(){$dialog.find('[name="blockThreadDefFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[data-name="openImOrExBlockThreadListDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("屏蔽帖子","blockThreadList")}),$dialog.find('[name="blockThreadDefForumType"]').val(Config.blockThreadDefForumType).triggerHandler("change"),$dialog.find('[name="blockThreadDefFidList"]').val(Config.blockThreadDefFidList.join(","));var _iteratorNormalCompletion13=!0,_didIteratorError13=!1,_iteratorError13=void 0;try{for(var _iterator13=Config.blockThreadList[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=!0){var data=_step13.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];void 0!==includeUser?(userType=1,userList=includeUser):void 0!==excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];void 0!==includeFid?(fidType=1,fidList=includeFid):void 0!==excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError13=!0,_iteratorError13=e}finally{try{!_iteratorNormalCompletion13&&_iterator13.return&&_iterator13.return()}finally{if(_didIteratorError13)throw _iteratorError13}}Dialog.show(dialogName)}},showBuyItemTipsDialog=function(){var e="pdBuyItemTipsDialog";if(!(0<$("#"+e).length)){Dialog.create(e,"自动购买物品详细说明",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">\n    <strong>设置说明：</strong><br>\n    在物品ID列表填入相应的物品ID，可自动购买所需的物品，每天最多可购买两次。<br>\n    （即：只购买1种物品的话最多可购买2次；购买2种物品的话每种物品只能购买1次，合计2次）<br>\n    <strong>各物品ID：</strong><br>\n    <b>等级经验药丸</b>：101；<b>等级经验药丸（蛋）</b>：102；<b>修炼手册</b>：103。<span class="pd_notice">（注：重生之药请手动购买）</span><br>\n    <strong>格式：</strong><br>\n    两次购买之间的物品ID请用<b>英文逗号</b>分隔；同一次购买的物品ID如用<b>竖线</b>分隔，表示前一种物品如费用不足，可自动更换为购买另一种物品。<br>\n    <strong>例子：</strong><br>\n    <b>102</b>：表示只购买一次[102]物品。<br>\n    <b>102,101</b>：表示第1次购买[102]物品，第2次购买[101]物品。<br>\n    <b>102|101,103|102|101</b>：表示第1次先尝试购买[102]物品，如费用不足则购买[101]物品；第2次先尝试购买[103]物品，如费用不足则购买[102]物品，依然不足则购买[101]物品。<br>\n  </div>\n</div>',"max-width: 600px;"),Dialog.show(e)}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Public":18,"./Script":20,"./TmpLog":22,"./Util":23}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a="pd_",o={debug:!1,forumTimezoneOffset:-8,getDailyBonusAfterTime:"00:35:00",enemyStatLatestLevelNum:10,lootAttackPerCheckLevel:function(){return Config.alertServerStatusChangeEnabled?10:20},newArmMarkDuration:1,getCustomPoints:null,actionFinishRetryInterval:60,errorRefreshInterval:1,showRefreshModeTipsInterval:1,getDailyBonusSpecialInterval:30,minPromoteHaloInterval:480,promoteHaloLimitNextActionInterval:480,promoteHaloActionInterval:1e3,tmpHaloInfoExpires:420,lootAttackingExpires:10,changePointsInfoExpires:30,checkLootInterval:30,hideMarkReadAtTipsExpires:3,smLevelUpAlertInterval:3,smRankChangeAlertInterval:22,drawCardRetryInterval:30,defAjaxTimeout:3e4,defAjaxInterval:300,specialAjaxInterval:function(){return Config.slowActionEnabled?Math.floor(4e3*Math.random())+3e3:Math.floor(200*Math.random())+1e3},minActionInterval:1e3,lootAttackInterval:function(){return Config.slowAttackEnabled?Math.floor(3e3*Math.random())+4e3:Math.floor(200*Math.random())+1e3},bankActionInterval:5e3,minBuyThreadWarningSell:6,statFloorMaxPage:300,selfRateFidList:[41,67,92,127,68,163],ratingErrorSizePercent:3,customFastNavMenuContent:"",storagePrefix:a,multiQuoteStorageName:"pd_multiQuote",postContentStorageName:"pd_postContent",tempPointsLogListStorageName:"pd_tempPointsLogList",smLevelUpTmpLogName:"SmLevelUp",smRankChangeTmpLogName:"SmRankChange",prevAutoChangeIdColorTmpLogName:"PrevAutoChangeIdColor",haloInfoTmpLogName:"HaloInfo",autoOpenBoxesAfterLootTmpLogName:"AutoOpenBoxesAfterLoot",getDailyBonusCookieName:"getDailyBonus",promoteHaloCookieName:"promoteHalo",lootCheckingCookieName:"lootChecking",lootAttackingCookieName:"lootAttacking",changePointsInfoCookieName:"changePointsInfo",lootCompleteCookieName:"lootComplete",buyItemReadyCookieName:"buyItemReady",buyItemCookieName:"buyItem",drawCardCookieName:"drawCard",hideReadAtTipsCookieName:"hideReadAtTips",prevReadAtTipsCookieName:"prevReadAtTips",autoChangeIdColorCookieName:"autoChangeIdColor"};n.default=o},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.resize=n.show=n.create=void 0;var a,o=e("./Info"),i=(a=o)&&a.__esModule?a:{default:a},r=d(e("./Util")),l=d(e("./Public"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.create=function(t,e,n,a){var o=$('\n<form>\n<div class="pd_cfg_box" id="'+t+'" style="'+(3<arguments.length&&void 0!==a?a:"")+'">\n  <h1>'+e+'<span data-action="close">&times;</span></h1>\n  '+n+"\n</div>\n</form>").appendTo("body");return o.on("click",".pd_cfg_tips",function(e){return i.default.isMobile&&l.showElementTitleTips(e,this.title),!1}).on("click","a.pd_disabled_link",function(){return!1}).on("click",'[data-action="close"]',function(){return c(t)}).keydown(function(e){if(27===e.keyCode)return c(t)}).find('legend [type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");r.isOpera()||r.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("pd_disabled_link"):e.addClass("pd_disabled_link"):e.prop("disabled",!t)})}).end().find("input[data-mutex]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("mutex")).each(function(){var e=$(this);e.is("a")?t?e.addClass("pd_disabled_link"):e.removeClass("pd_disabled_link"):e.prop("disabled",t)})}),i.default.isMobile||$(window).on("resize."+t,function(){return s(t)}),o},n.show=function(e){var t=$("#"+e);t.length&&(t.find('legend [type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled], input[data-mutex]").each(function(){$(this).triggerHandler("click")}),t.fadeIn("fast"),s(e),t.find("input:first, select:first, a:first, textarea:first, button:first").eq(0).focus())};var s=n.resize=function(e){var t=$("#"+e),n=$(window).height();t.find(".pd_cfg_main").css("max-height",n-80);var a=t.outerWidth(),o=$(window).width(),i=o/2-a/2;o<i+a&&(i=o-a-20),i<0&&(i=0);var r=n/2-t.outerHeight()/2;r<0&&(r=0),t.css({top:r,left:i})},c=n.close=function(e){return $("#"+e).fadeOut("fast",function(){$(this).parent("form").remove()}),i.default.isMobile||$(window).off("resize."+e),!1}},{"./Info":9,"./Public":18,"./Util":23}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addPromoteHaloInterval=n.addThreadFastGotoLink=n.smRankChangeAlert=n.smLevelUpAlert=void 0;o(e("./Info"));var r=a(e("./Util")),l=a(e("./Msg")),d=o(e("./Const")),s=a(e("./Log")),c=a(e("./TmpLog"));a(e("./Loot"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}n.smLevelUpAlert=function(){var e=parseInt($("#pdSmLevel").data("sm-level"));if(e){var t=function(e){c.setValue(d.default.smLevelUpTmpLogName,{time:$.now(),smLevel:e})},n=c.getValue(d.default.smLevelUpTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smLevel))if(e>n.smLevel){var a=Math.floor(($.now()-n.time)/60/60/1e3);if(a>=d.default.smLevelUpAlertInterval){var o=new Date(n.time);t(e),s.push("神秘等级升级","自`"+r.getDateString(o)+"`以来，你的神秘等级共上升了`"+(e-n.smLevel)+"`级 (Lv.`"+n.smLevel+"`->Lv.`"+e+"`)"),l.show("自<em>"+r.getDateString(o)+"</em>以来，你的神秘等级共上升了<em>"+(e-n.smLevel)+"</em>级")}else a<0&&t(e)}else e<n.smLevel&&t(e);else t(e)}},n.smRankChangeAlert=function(){var e=$("#pdSmLevel").data("sm-rank");if(e&&!e.toString().endsWith("+")){e=parseInt(e);var t=function(e){return c.setValue(d.default.smRankChangeTmpLogName,{time:$.now(),smRank:e})},n=c.getValue(d.default.smRankChangeTmpLogName);if(n&&"number"===$.type(n.time)&&"number"===$.type(n.smRank)){if(e!==n.smRank){var a=Math.floor(($.now()-n.time)/60/60/1e3);if(a>=d.default.smRankChangeAlertInterval){var o=new Date(n.time),i=e<n.smRank;t(e),s.push("神秘系数排名变化","自`"+r.getDateString(o)+"`以来，你的神秘系数排名共`"+(i?"上升":"下降")+"`了`"+Math.abs(e-n.smRank)+"`名 (No.`"+n.smRank+"`->No.`"+e+"`)"),l.show("自<em>"+r.getDateString(o)+'</em>以来，你的神秘系数排名共<b style="color: '+(i?"#F00":"#393")+'">'+(i?"上升":"下降")+"</b>了<em>"+Math.abs(e-n.smRank)+"</em>名")}else a<0&&t(e)}}else t(e)}},n.addThreadFastGotoLink=function(){$("#alldiv > .drow:last-child").on("mouseenter","li.indexlbtit2 > a, li.rightlbtit > a",function(){var e=$(this);e.css("position","relative").prepend('<a class="pd_thread_goto" href="'+e.attr("href")+'&page=e#a"></a>')}).on("mouseleave","li.indexlbtit2 > a, li.rightlbtit > a",function(){$(this).css("position","static").find(".pd_thread_goto").remove()})},n.addPromoteHaloInterval=function(){var e=parseInt(r.getCookie(d.default.promoteHaloCookieName));if(e){var t=e-$.now();if(0<t){var n=Math.ceil(t/60/1e3),a=Math.floor(n/60);n-=60*a,$("#pdLoot").append('<span id="pdHaloInterval"> (光环：'+(0<a?a+"时":"")+n+"分)</span>")}}}},{"./Const":6,"./Info":9,"./Log":11,"./Loot":13,"./Msg":15,"./TmpLog":22,"./Util":23}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={uid:0,userName:"",isInHomePage:"/"===location.pathname||"/index.php"===location.pathname,isMobile:!1,isInSpecialDomain:location.host.endsWith(".miaola.info")||location.host.endsWith(".koyuki.cc"),version:"",w:"undefined"!=typeof unsafeWindow?unsafeWindow:window,storageType:"Default",$userMenu:$("#kf_information > ul"),ajaxStat:{}};n.default=a},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showBuyItemTips=n.showMyInfoInItemShop=n.buyItems=n.sellItems=n.useItems=n.getItemsUsedNumInfo=n.getLevelByName=n.getArmsLevelInfo=n.getArmInfo=n.getArmClassNameByGroupName=n.smeltArms=n.showArmsFinalAddition=n.addCommonArmsButton=n.handleUselessSubProperties=n.getArmParameterSetting=n.bindArmLinkClickEvent=n.sortArmsById=n.sortArmsByGroup=n.handleArmArea=n.addSavedArmsInfo=n.getMergeArmsInfo=n.clearArmsInfo=n.writeArmsInfo=n.readArmsInfo=n.openBoxes=n.autoOpenBoxes=n.getNextObjects=n.init=n.itemTypeList=n.armTypeList=n.armGroupList=n.armClassList=n.boxTypeList=void 0;var W=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(e("./Info")),K=o(e("./Util")),z=o(e("./Msg")),E=o(e("./Dialog")),G=r(e("./Const")),M=e("./Config"),V=o(e("./Log")),Q=o(e("./Script")),a=o(e("./Public")),s=o(e("./Loot"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var n=h();delete n["装备列表"][e],v(n),t.find('tr[data-id="'+e+'"]').replaceWith('<tr><td colspan="3" style="color: #777;">该装备不存在</td></tr>')}var J=void 0,T=void 0,I=void 0,P=void 0,B=n.boxTypeList=["普通盒子","幸运盒子","稀有盒子","传奇盒子","神秘盒子"],D=n.armClassList=["武器","护甲","项链"],F=n.armGroupList=["长剑","短弓","法杖","铠甲","皮甲","布甲"],X=n.armTypeList=["普通的装备","幸运的装备","稀有的装备","传奇的装备","神秘的装备"],Y=n.itemTypeList=["零时迷子的碎片","被遗弃的告白信","学校天台的钥匙","TMA最新作压缩包","LOLI的钱包","棒棒糖","蕾米莉亚同人漫画","十六夜同人漫画","档案室钥匙","傲娇LOLI娇蛮音CD","整形优惠卷","消逝之药"],Z=(n.init=function(){(P=a.getSafeId())&&((J=$(".kf_fw_ig1:eq(0)")).attr("id","pdBoxArea"),(T=$(".kf_fw_ig4:eq(0)")).attr("id","pdArmArea"),(I=$(".kf_fw_ig1:eq(1)")).attr("id","pdItemArea"),l(),d(),Config.autoSaveArmsInfoEnabled&&g(T),b(T),x(T,P),L(),H())},n.getNextObjects=function e(t,n){var m=0<arguments.length&&void 0!==t?t:1,g=1<arguments.length&&void 0!==n?n:null;console.log("获取下一批物品Start"),$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:G.default.defAjaxTimeout,async:!Config.autoSaveArmsInfoEnabled}).done(function(e){for(var t=1;t<=2;t++){var n=null;if(n=1===t?/<tr><td width="\d+%">装备.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(e):/<tr><td width="\d+%">使用.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(e)){var a=n[1].match(/<tr(.+?)<\/tr>/g),o=1===t?T:I,i="",r={"已装备武器":0,"已装备护甲":0,"上次记录的最新装备":0,"上次记录的时间":0,"装备列表":{}};for(var l in a){var d=/"wp_(\d+)"/.exec(a[l]);if(d){var s=parseInt(d[1]);if(o.has('[id="wp_'+s+'"]').length||(i+=a[l]),1===t){r["装备列表"][s]=a[l];var c=/<tr id="wp_(\d+)">.+?（装备中）<span[^<>]*>[^<>]+的([^<>]+)<\/span>/.exec(a[l]);if(c){var u=parseInt(c[1]),p=j(c[2]);p&&(r["已装备"+p]=u)}}}}if(1===t&&Config.autoSaveArmsInfoEnabled){var f=h();0<r["已装备武器"]&&(f["已装备武器"]=r["已装备武器"]),0<r["已装备护甲"]&&(f["已装备护甲"]=r["已装备护甲"]),$.extend(f["装备列表"],r["装备列表"]),v(f)}i&&(2===m?o.find("> tbody > tr:last-child").before(i):o.find("> tbody > tr:nth-child(2)").after(i),1===t&&b(T))}}"function"==typeof g&&g()}).fail(function(){setTimeout(function(){return e(m,g)},G.default.defAjaxInterval)})}),l=function(){(J=$(".kf_fw_ig1:first")).find('> tbody > tr:nth-child(3) > td > a[onclick^="dkhz"]').each(function(){var e=$(this),t=/dkhz\('(\d+)'\)/.exec(e.attr("onclick"));t&&e.after('<a class="pd_highlight" href="#" data-name="openBoxes" data-id="'+t[1]+'" style="margin-left: 10px;">批量打开</a>')}),J.on("click",'a[data-name="openBoxes"]',function(e){e.preventDefault();var t=$(this),n=parseInt(t.data("id")),a=J.find("> tbody > tr:nth-child(2) > td:nth-child("+n+")"),o=a.find("span:first").text().trim()+"盒子";if(B.includes(o)){var i=parseInt(a.find("span:last").text()),r=parseInt(prompt("你要打开多少个【"+o+"】？",i));!r||r<0||(z.destroy(),Config.autoSaveArmsInfoEnabled&&Z(1),N({id:n,boxType:o,num:r,safeId:P}))}})},d=function(){$('\n<div class="pd_item_btns" data-name="openBoxesBtns">\n  <label>\n    <input name="autoSaveArmsInfoEnabled" type="checkbox" '+(Config.autoSaveArmsInfoEnabled?"checked":"")+'> 保存装备信息</input>\n    <span class="pd_cfg_tips" title="在批量打开盒子时自动保存装备信息，可突破装备背包最多显示10件的限制">[?]</span>\n  </label>\n  <button name="clearMsg" type="button" title="清除页面上所有的消息和操作结果">清除消息</button>\n  <button name="openAllBoxes" type="button" style="color: #f00;" title="打开全部盒子">一键开盒</button>\n</div>\n').insertAfter(J).find('[name="autoSaveArmsInfoEnabled"]').click(function(){var e=$(this).prop("checked");Config.autoSaveArmsInfoEnabled!==e&&((0,M.read)(),Config.autoSaveArmsInfoEnabled=e,(0,M.write)())}).end().find('[name="clearMsg"]').click(function(){z.destroy(),$(".pd_result").remove()}).end().find('[name="openAllBoxes"]').click(c),a.addSlowActionChecked($('.pd_item_btns[data-name="openBoxesBtns"]'))},c=function(){var e="pdOpenAllBoxesDialog";if(!(0<$("#"+e).length)){z.destroy(),(0,M.read)();var t="",n=!0,a=!1,o=void 0;try{for(var i,r=B.slice(0,4)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){t+="<option>"+i.value+"</option>"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}var l="",d=!0,s=!1,c=void 0;try{for(var u,p=F[Symbol.iterator]();!(d=(u=p.next()).done);d=!0){var f=u.value;l+="<li><b>"+f+"：</b>";var m=!0,g=!1,h=void 0;try{for(var v,b=X[Symbol.iterator]();!(m=(v=b.next()).done);m=!0){var y=v.value.split("的")[0];if("神秘"!==y){var _=y+"的"+f;l+='\n<label style="margin-right: 5px;">\n  <input type="checkbox" name="smeltArmsType" value="'+_+'" '+(Config.defSmeltArmTypeList.includes(_)?"checked":"")+"> "+y+"\n</label>"}}}catch(e){g=!0,h=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw h}}l+="</li>"}}catch(e){s=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(s)throw c}}var x="",k=!0,C=!1,w=void 0;try{for(var I,L=Y.slice(6)[Symbol.iterator]();!(k=(I=L.next()).done);k=!0){x+="<option>"+I.value+"</option>"}}catch(e){C=!0,w=e}finally{try{!k&&L.return&&L.return()}finally{if(C)throw w}}var S='\n<div class="pd_cfg_main">\n  <fieldset style="margin-top: 5px;">\n    <legend>请选择想批量打开的盒子种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</legend>\n    <select name="openBoxesTypes" size="4" style="width: 320px;" multiple>'+t+'</select>\n  </fieldset>\n  <div style="margin-top: 5px;"><b>请选择批量打开盒子后想要进行的操作（如无需操作可不用勾选）：</b></div>\n  <fieldset>\n    <legend>\n      <label><input name="smeltArmsAfterOpenBoxesEnabled" type="checkbox"> 熔炼装备</label>\n    </legend>\n    <div>请选择想批量熔炼的装备种类：</div>\n    <ul data-name="smeltArmTypeList">'+l+'</ul>\n    <div>\n      <a class="pd_btn_link" href="#" data-name="selectAll">全选</a>\n      <a class="pd_btn_link" href="#" data-name="selectInverse">反选</a>\n    </div>\n  </fieldset>\n  <fieldset>\n    <legend>\n      <label><input name="useItemsAfterOpenBoxesEnabled" type="checkbox"> 使用道具</label>\n    </legend>\n    <div>请选择想批量使用的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n    <select name="useItemTypes" size="6" style="width: 320px;" multiple>'+x+'</select>\n  </fieldset>\n  <fieldset>\n    <legend>\n      <label><input name="sellItemsAfterOpenBoxesEnabled" type="checkbox"> 出售道具</label>\n    </legend>\n    <div>请选择想批量出售的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n    <select name="sellItemTypes" size="6" style="width: 320px;" multiple>'+x+'</select>\n  </fieldset>\n  <div style="margin-top: 5px;">\n    <label>\n      <input name="showArmsFinalAdditionAfterOpenBoxesEnabled" type="checkbox"> 在一键开盒后显示装备最终加成\n      <span class="pd_cfg_tips" title="在一键开盒（并执行后续操作）后显示当前页面上装备的最终加成信息">[?]</span>\n    </label>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="open" type="button" style="color: #f00;">一键开盒</button>\n  <button name="save" type="button">保存设置</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',A=E.create(e,"一键开盒",S),T=A.find('ul[data-name="smeltArmTypeList"]'),D=function(){(0,M.read)();var e=A.find('select[name="openBoxesTypes"]').val();if(Array.isArray(e)||(e=[]),Config.defOpenBoxTypeList=e,A.find('[type="checkbox"]').each(function(){var e=$(this),t=e.attr("name");t in Config&&(Config[t]=Boolean(e.prop("checked")))}),Config.smeltArmsAfterOpenBoxesEnabled){var t=[];T.find('input[name="smeltArmsType"]:checked').each(function(){t.push($(this).val())}),0<t.length?Config.defSmeltArmTypeList=t:Config.smeltArmsAfterOpenBoxesEnabled=!1}if(Config.useItemsAfterOpenBoxesEnabled){var n=A.find('select[name="useItemTypes"]').val();Array.isArray(n)?Config.defUseItemTypeList=n:Config.useItemsAfterOpenBoxesEnabled=!1}if(Config.sellItemsAfterOpenBoxesEnabled){var a=A.find('select[name="sellItemTypes"]').val();Array.isArray(a)?Config.defSellItemTypeList=a:Config.sellItemsAfterOpenBoxesEnabled=!1}(0,M.write)()};A.find('[name="open"]').click(function(){A.find('select[name="openBoxesTypes"]').val()?confirm("是否一键开盒（并执行所选操作）？")&&(D(),E.close(e),Config.autoSaveArmsInfoEnabled&&Z(1),$(document).clearQueue("OpenAllBoxes"),J.find("> tbody > tr:nth-child(2) > td").each(function(e){var t=$(this),n=t.find("span:first").text().trim()+"盒子";if(Config.defOpenBoxTypeList.includes(n)){var a=parseInt(t.find("span:last").text());if(a&&!(a<0)){var o=parseInt(J.find("> tbody > tr:nth-child(3) > td:nth-child("+(e+1)+') > a[data-name="openBoxes"]').data("id"));o&&$(document).queue("OpenAllBoxes",function(){return N({id:o,boxType:n,num:a,safeId:P,nextActionEnabled:!0})})}}}),$(document).dequeue("OpenAllBoxes")):alert("未选择盒子种类")}).end().find('[name="save"]').click(function(){D(),alert("设置已保存")}).end().find('a[data-name="selectAll"]').click(function(){return K.selectAll(T.find('input[name="smeltArmsType"]'))}).end().find('a[data-name="selectInverse"]').click(function(){return K.selectInverse(T.find('input[name="smeltArmsType"]'))}),A.on("keydown",'select[name$="Types"]',function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).find('[type="checkbox"]').each(function(){var e=$(this),t=e.attr("name");t in Config&&e.prop("checked",!0===Config[t])}),A.find('select[name$="Types"]').each(function(e){var t=$(this),n=Config.defOpenBoxTypeList;1===e?n=Config.defUseItemTypeList:2===e&&(n=Config.defSellItemTypeList),t.find("option").each(function(){var e=$(this);n.includes(e.val())&&e.prop("selected",!0)})}),E.show(e),Q.runFunc("Item.showOpenAllBoxes_after_")}},N=(n.autoOpenBoxes=function(){var i=a.getSafeId();i&&($(document).clearQueue("OpenAllBoxes"),J.find("> tbody > tr:nth-child(2) > td").each(function(e){var t=$(this),n=t.find("span:first").text().trim()+"盒子";if(Config.defOpenBoxTypeList.includes(n)){var a=parseInt(t.find("span:last").text());if(a&&!(a<0)){var o=parseInt(J.find("> tbody > tr:nth-child(3) > td:nth-child("+(e+1)+') > a[data-name="openBoxes"]').data("id"));o&&$(document).queue("OpenAllBoxes",function(){return N({id:o,boxType:n,num:a,safeId:i,nextActionEnabled:!0})})}}}),$(document).dequeue("OpenAllBoxes")),$(document).dequeue("AutoAction")},n.openBoxes=function(e){function i(){$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=3&id="+E+"&safeid="+P,timeout:G.default.defAjaxTimeout}).done(function(e){U++;var t=K.removeHtmlTag(e);if(t.includes("获得")){F++;var n=/获得\[(\d+)]KFB/.exec(t);if(n&&(R.KFB+=parseInt(n[1])),(n=/获得\[(\d+)]经验值/.exec(t))&&(R["经验值"]+=parseInt(n[1])),n=/打开盒子获得了道具\[\s*(.+?)\s*]/.exec(t)){R["道具"]++;var a=n[1];a in R.item||(R.item[a]=0),R.item[a]++}if(n=/获得一件\[(.+?)]的?装备/.exec(t)){R["装备"]++;var o=n[1]+"装备";o in R.arm||(R.arm[o]=0),R.arm[o]++}(n=/随机值(\d+)/.exec(t))&&(j++,O+=parseInt(n[1]))}else t.includes("操作过快")?$(document).queue("OpenBoxes",i):t.includes("盒子不足")||t.includes("错误的安全码")?($(document).clearQueue("OpenBoxes"),q=!0):N++;console.log("第"+U+"次："+t),$('.pd_result[data-name="boxResult"]:last').append("<li><b>第"+U+"次：</b>"+t+"</li>"),Q.runFunc("Item.openBoxes_success_",t)}).fail(function(){N++}).always(function(){var e=$(document).queue("OpenBoxes").length,t=$(".pd_countdown:last");t.text(e);var n=t.closest(".pd_msg").data("stop");if(q=q||n,n&&($(document).clearQueue("OpenAllBoxes"),B=!1),q||!e){z.remove(H);var a=0<j?K.getFixedNumLocStr(O/j,2):0,o=!0,i=!1,r=void 0;try{for(var l,d=K.entries(R)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=W(l.value,2),c=s[0];(!(x=s[1])||"object"===$.type(x)&&$.isEmptyObject(x))&&delete R[c]}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}$.isEmptyObject(R)||V.push("打开盒子","共有`"+F+"`个【`"+M+"`】打开成功 (平均随机值【`"+a+"`】)",{gain:R,pay:{"盒子":-F}});var u=J.find("> tbody > tr:nth-child(2) > td:nth-child("+E+") > span:last"),p=parseInt(u.text());0<p&&u.text(p-F);var f="",m="",g=!0,h=!1,v=void 0;try{for(var b,y=K.entries(R)[Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var _=W(b.value,2),x=(c=_[0],_[1]),k="";if("object"===$.type(x)){f+=f?"<br>":"",m+=m?"<br>":"",f+=("item"===c?"道具":"装备")+"：";var C="item"===c?Y:X,w=!0,I=!1,L=void 0;try{for(var S,A=K.getSortedObjectKeyList(C,x)[Symbol.iterator]();!(w=(S=A.next()).done);w=!0){var T=S.value;k+="<i>"+T+"<em>+"+x[T].toLocaleString()+"</em></i> "}}catch(e){I=!0,L=e}finally{try{!w&&A.return&&A.return()}finally{if(I)throw L}}}else k+="<i>"+c+"<em>+"+x.toLocaleString()+"</em></i> ";f+=k,m+=k.trim()}}catch(e){h=!0,v=e}finally{try{!g&&y.return&&y.return()}finally{if(h)throw v}}if(m.length<200&&(m=m.replace(/(.*)<br>/,"$1")),$('.pd_result[data-name="boxResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（平均随机值【<em>'+a+"</em>】）：</b><br>\n  "+(f||"无")+"\n</li>\n"),console.log("共有"+F+"个【"+M+"】打开成功（平均随机值【"+a+"】）"+(0<N?"，共有"+N+"个盒子无法获取结果":"")),z.show("<strong>共有<em>"+F+"</em>个【"+M+"】打开成功（平均随机值【<em>"+a+"</em>】）"+(0<N?"，共有<em>"+N+"</em>个盒子无法获取结果":"")+"</strong>"+(25<m.length?"<br>"+m:m),-1),Q.runFunc("Item.openBoxes_after_",R),setTimeout(function(){return Z(1)},G.default.defAjaxInterval),0<$(document).queue("OpenAllBoxes").length)setTimeout(function(){return $(document).dequeue("OpenAllBoxes")},"function"==typeof G.default.specialAjaxInterval?G.default.specialAjaxInterval():G.default.specialAjaxInterval);else if(B){var D=null;Config.smeltArmsAfterOpenBoxesEnabled?D=function(){return te({typeList:Config.defSmeltArmTypeList,safeId:P,nextActionEnabled:B})}:Config.useItemsAfterOpenBoxesEnabled?D=function(){return ae({typeList:Config.defUseItemTypeList,safeId:P,nextActionEnabled:B})}:Config.sellItemsAfterOpenBoxesEnabled&&(D=function(){return oe({typeList:Config.defSellItemTypeList,safeId:P,nextActionEnabled:B})}),D?setTimeout(D,G.default.minActionInterval):Config.showArmsFinalAdditionAfterOpenBoxesEnabled&&ee()}}else U%10==0&&setTimeout(function(){return Z(1)},G.default.defAjaxInterval),setTimeout(function(){return $(document).dequeue("OpenBoxes")},"function"==typeof G.default.specialAjaxInterval?G.default.specialAjaxInterval():G.default.specialAjaxInterval)})}var E=e.id,M=e.boxType,t=e.num,P=e.safeId,n=e.nextActionEnabled,B=void 0!==n&&n,F=0,N=0,U=0,O=0,j=0,q=!1,R={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}};J.parent().append('<ul class="pd_result" data-name="boxResult"><li><strong>【'+M+"】打开结果：</strong></li></ul>");var H=z.wait('<strong>正在打开盒子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+t+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');$(document).clearQueue("OpenBoxes"),$.each(new Array(t),function(){$(document).queue("OpenBoxes",i)}),$(document).dequeue("OpenBoxes")}),ee=function(){if(!i.default.w.isShowArmsFinalAddition){i.default.w.isShowArmsFinalAddition=!0;var a=[],o=[];T.find("tr[data-id]").each(function(){var e=$(this),t=parseInt(e.data("id")),n=e.data("class");t&&n&&o.push({armId:t,armClass:n}),e.hasClass("pd_arm_equipped")&&a.push({armId:t,armClass:n})}),a.length<2&&!confirm("未在当前页面上存在已装备的该类别装备，在操作后将装备为该页面上其类别的最后一件装备，是否继续？")||0<o.length&&(console.log("在一键开盒后自动显示装备最终加成信息Start"),G.default.debug&&console.log(a),A(o,a,P))}},u=G.default.storagePrefix+"myArmsInfo2",h=n.readArmsInfo=function(){var t={"已装备武器":0,"已装备护甲":0,"上次记录的最新装备":0,"上次记录的时间":0,"装备列表":{}},e=K.readData(u+"_"+i.default.uid);if(!e)return t;try{e=JSON.parse(e)}catch(e){return t}return e&&"object"===$.type(e)&&"object"===$.type(e["装备列表"])?t=e:t},v=n.writeArmsInfo=function(e){return K.writeData(u+"_"+i.default.uid,JSON.stringify(e))},p=n.clearArmsInfo=function(){return K.deleteData(u+"_"+i.default.uid)},f=n.getMergeArmsInfo=function(e,t){for(var n in t)if("装备列表"===n)for(var a in t["装备列表"])!(a=parseInt(a))||a<0||(e["装备列表"][a]=t["装备列表"][a]);else e[n]=t[n];return e},g=n.addSavedArmsInfo=function(e){var t=h(),n="",a=!0,o=!1,i=void 0;try{for(var r,l=Object.keys(t["装备列表"]).reverse()[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value;e.find('[id="wp_'+d+'"]').length||(n+=t["装备列表"][d].replace(/(<tr(?: id="wp_\d+")?)>/,'$1 data-saved="true">'))}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}e.find("> tbody > tr:last-child").before(n)},b=n.handleArmArea=function(e,t){var u=1<arguments.length&&void 0!==t?t:0;e.find('a[onclick^="cdzb"]').removeAttr("onclick").attr("data-name","equip"),e.find('a[onclick^="rlzb"]').removeAttr("onclick").attr("data-name","smelt"),e.find('tr[id^="wp_"]').each(function(){var e=$(this),t=e.attr("id"),n=e.find("td");n.removeAttr("colspan").removeAttr("style").css({"text-align":"left","padding-left":"5px"}),n.html(n.html().replace("（装备中）","")),e.removeAttr("id").prepend('<td id="'+t+'"><a data-name="equip" href="javascript:;">装备</a></td><td><a data-name="smelt" href="javascript:;">熔炼</a></td>').addClass("pd_arm_equipped")});var p=!1,f=Config.autoSaveArmsInfoEnabled?h():{};if(e.find('tr:not([data-id]) > td[id^="wp_"]').each(function(e){var t=$(this),n=/wp_(\d+)/.exec(t.attr("id"));if(n){var a=parseInt(n[1]),o=t.parent("tr"),i=o.find("> td:nth-child(3)"),r=i.html(),l=q(r);o.attr("data-id",a).attr("data-class",l["类别"]).attr("data-group",l["组别"]);var d=!1;if(Config.autoSaveArmsInfoEnabled){if(0===e){var s=K.getMidnightHourDate(0),c=f["上次记录的时间"]&&f["上次记录的最新装备"]?new Date(f["上次记录的时间"]):new Date(0);c.setHours(0,0,0,0),Math.abs(s-c)>=24*G.default.newArmMarkDuration*60*60*1e3&&(console.log("更新最新装备记录"),p=!0,f["上次记录的最新装备"]=a,f["上次记录的时间"]=$.now())}a>f["上次记录的最新装备"]&&(d=!0)}i.html((d?'<i class="pd_new_arm_mark">[新]</i> ':"")+'<i class="pd_arm_id">[ID: '+a+"]</i> "+w(r)),Config.armsMemo[a]&&i.attr("data-memo",Config.armsMemo[a].replace(/"/g,"")),0===u&&t.prepend('<input name="armCheck" type="checkbox" value="'+a+'">')}}),Config.sortArmsByGroupEnabled&&y(e),Config.autoSaveArmsInfoEnabled){Config.sortArmsByGroupEnabled||_(e);var n=parseInt(e.find('.pd_arm_equipped[data-class="武器"]:not([data-saved="true"])').data("id")),a=parseInt(e.find('.pd_arm_equipped[data-class="护甲"]:not([data-saved="true"])').data("id"));0<n&&f["已装备武器"]!==n&&(p=!0,f["已装备武器"]=n),0<a&&f["已装备护甲"]!==a&&(p=!0,f["已装备护甲"]=a),p&&v(f),e.find('.pd_arm_equipped[data-saved="true"][data-class="武器"]:not([data-id="'+f["已装备武器"]+'"])').removeClass("pd_arm_equipped"),e.find('.pd_arm_equipped[data-saved="true"][data-class="护甲"]:not([data-id="'+f["已装备护甲"]+'"])').removeClass("pd_arm_equipped"),e.find('.pd_arm_equipped[data-class="武器"]').length||e.find('tr[data-id="'+f["已装备武器"]+'"]').addClass("pd_arm_equipped"),e.find('.pd_arm_equipped[data-class="护甲"]').length||e.find('tr[data-id="'+f["已装备护甲"]+'"]').addClass("pd_arm_equipped")}1===u&&e.find('a[data-name="equip"]').attr("data-name","add").text("加入"),Q.runFunc("Item.handleArmArea_after_",{$armArea:e,type:u})},y=n.sortArmsByGroup=function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=F[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;e.find('tr[data-group="'+r+'"]').insertAfter(e.find("tr:nth-child(2)"))}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}},_=n.sortArmsById=function(e){var t=[];e.find("tr[data-id]").each(function(){t.push(parseInt($(this).data("id")))}),t.sort(function(e,t){return e-t});var n=!0,a=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;e.find('tr[data-id="'+l+'"]').insertAfter(e.find("tr:nth-child(2)"))}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}},x=n.bindArmLinkClickEvent=function(l,t,e){var d=2<arguments.length&&void 0!==e?e:0;l.on("click",'a[data-name="equip"]',function(){var o=$(this),e=o.closest("tr"),i=parseInt(e.data("id")),r=e.data("class");$.post("kf_fw_ig_mybpdt.php","do=4&id="+i+"&safeid="+t,function(e){var t=K.removeHtmlTag(e);if(/装备完毕/.test(t)){if(l.find('.pd_arm_equipped[data-class="'+r+'"]').removeClass("pd_arm_equipped"),o.closest("tr").addClass("pd_arm_equipped"),Config.autoSaveArmsInfoEnabled){var n=h();n["已装备"+r]=i,v(n)}if(1===d){var a=z.wait("<strong>正在获取争夺首页信息&hellip;</strong>");s.updateLootInfo(function(){z.remove(a);var e=$('input[name="armId"]:first'),t=$('input[name="armMemo"]:first');e.val(i),t.val($("#pdArmArea > span:first").text().trim()),$(".pd_arm_input").each(function(){$(this).val(""),this.defaultValue=""}),Q.runFunc("Item.bindArmLinkClickEvent_equip_after_",{$armArea:l,type:d})})}}else!Config.autoSaveArmsInfoEnabled||"错误的编号"!==t&&"不是你的东西"!==t||m(i,l),alert(t)})}).on("click",'a[data-name="smelt"]',function(){if(confirm("确定熔炼此装备吗？")){var i=$(this).closest("tr"),r=parseInt(i.data("id"));$.post("kf_fw_ig_mybpdt.php","do=5&id="+r+"&safeid="+t,function(e){var t=K.removeHtmlTag(e);if(/装备消失/.test(t)){r in Config.armsMemo&&((0,M.read)(),delete Config.armsMemo[r],(0,M.write)());var n=/获得对应装备经验\[\+(\d+)]/.exec(t);if(n){var a=i.data("class"),o={};o[a+"经验"]=parseInt(n[1]),V.push("熔炼装备","共有`1`个【`"+a+"`】装备熔炼成功",{gain:o,pay:{"装备":-1}})}i.replaceWith('<tr><td colspan="3">'+t+"</td></tr>"),Config.autoSaveArmsInfoEnabled&&m(r,l)}else!Config.autoSaveArmsInfoEnabled||"错误的编号"!==t&&"不是你的东西"!==t||m(r,l),alert(t)})}}).on("click",'a[data-name="add"]',function(){var e=$(this).closest("tr"),t=parseInt(e.data("id")),n=e.data("class"),a=q(e.find("> td:nth-child(3)").html());$("#pdAddArmDialog").parent().hide(),"武器"===n?($("#pdAddWeaponMemo").val(a["名称"]),$("#pdAddWeaponId").val(t).focus()):"护甲"===n&&($("#pdAddArmorMemo").val(a["名称"]),$("#pdAddArmorId").val(t).focus())}).on("mouseenter","tr[data-id]",function(){$(this).find("> td:nth-child(3)").append('<a class="show_arm_info" data-name="showArmInfo" href="#" title="查看装备信息">查</a>')}).on("mouseleave","tr[data-id]",function(){$(this).find("> td:nth-child(3) .show_arm_info").remove()}).on("click",".show_arm_info",function(e){e.preventDefault();var t=$(this),n=$(this).parent("td"),a=t.closest("tr"),o=parseInt(a.data("id"));t.remove();var i=n.html(),r=q(i);k(o,r,l)})},k=function(a,e,o){var i="pdArmInfoDialog";if(!(0<$("#"+i).length)){z.destroy();var t='\n<div class="pd_cfg_main">\n  <div style="width: 550px; margin-top: 5px; padding-bottom: 5px; border-bottom: 1px solid #99f;">\n    <span style="color: '+e["颜色"]+'">'+e["名称"]+"</span> - "+e["描述"]+'\n  </div>\n  <div style="margin-top: 5px;">\n    <label>装备ID：<input name="armId" type="text" value="'+a+'" style="width: 100px;" readonly></label>\n    <a class="pd_btn_link" data-name="copy" data-target="[name=armId]" href="#">复制</a>\n  </div>\n  <div style="margin-top: 5px;">\n    <label>装备参数设置：</label>\n    <a class="pd_btn_link" data-name="copy" data-target="[name=armParameterSetting]" href="#">复制</a><br>\n    <textarea name="armParameterSetting" rows="6" style="width: 550px;" wrap="off" style="white-space: pre;" readonly></textarea>\n  </div>\n  <div style="margin-top: 5px;">\n    <label>\n      装备备注：<input name="armMemo" type="text" maxlength="100" style="width: 200px;">\n    </label>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="saveMemo" type="submit">保存备注</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',r=E.create(i,"装备信息",t,"z-index: 1003;");r.on("click",'a[data-name="copy"]',function(e){e.preventDefault();var t=r.find($(this).data("target"));K.copyText(t)||t.select().focus(),Q.runFunc("Item.showArmInfoDialog_copy_")}).submit(function(e){e.preventDefault(),(0,M.read)();var t=$.trim(r.find('input[name="armMemo"]').val()),n=o.find('tr[data-id="'+a+'"] > td:nth-child(3)');t?(Config.armsMemo[a]=t,n.attr("data-memo",t.replace(/"/g,""))):(delete Config.armsMemo[a],n.removeAttr("data-memo")),(0,M.write)(),E.close(i)}),r.find('textarea[name="armParameterSetting"]').val(C(a,e)),Config.armsMemo[a]&&r.find('input[name="armMemo"]').val(Config.armsMemo[a]),E.show(i),Q.runFunc("Item.showArmInfoDialog_after_")}},U=new Map([["增加攻击力","ATK"],["增加暴击伤害","CRT"],["增加技能伤害","SKL"],["穿透对方意志","BRC"],["生命夺取","LCH"],["增加速度","SPD"],["攻击","ATK"],["暴击","CRT"],["技能","SKL"],["穿透","BRC"],["吸血","LCH"],["速度","SPD"],["被攻击回血100+","HEL"],["获得无护甲魔法盾500+","SLD"],["每减少5%生命值获得额外意志","AMR"],["反弹对方实际伤害15%+","RFL"],["减少来自暴击的伤害10%+","CRD"],["减少来自技能的伤害10%+","SRD"],["回血","HEL"],["护盾","SLD"],["加防","AMR"],["反伤","RFL"],["暴减","CRD"],["技减","SRD"]]),C=n.getArmParameterSetting=function(e,t){var n={"组别":"","装备ID":"","神秘属性数量":0,"所有的神秘属性":"","主属性数量":0,"所有的主属性":"","从属性数量":0,"所有的从属性":""},a=new Map([["长剑","Sword"],["短弓","Bow"],["法杖","Staff"],["铠甲","Plate"],["皮甲","Leather"],["布甲","Cloth"]]);n["组别"]=a.get(t["组别"]),n["装备ID"]="#"+e;var o=new Map([["火神秘","FMT"],["雷神秘","LMT"],["风神秘","AMT"],["冰霜神秘","IMT"],["尖刺神秘","TMT"],["仇恨神秘","HMT"]]),i=!0,r=!1,l=void 0;try{for(var d,s=o[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=W(d.value,2),u=c[0],p=c[1];u in t&&(n["神秘属性数量"]++,n["所有的神秘属性"]+=p+" ")}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}var f=!0,m=!1,g=void 0;try{for(var h,v=t["主属性"][Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=(p=h.value).split("(",1),y=W(b,1)[0],_=void 0===y?"":y;(_=_.trim())&&(n["主属性数量"]++,n["所有的主属性"]+=U.get(_)+" ")}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}var x=new Map([["系数(x3)","COF"],["力量","STR"],["敏捷","AGI"],["智力","INT"],["体质","VIT"],["灵活","DEX"],["意志","RES"]]),k=!0,C=!1,w=void 0;try{for(var I,L=t["从属性"][Symbol.iterator]();!(k=(I=L.next()).done);k=!0){var S=I.value;if(S=$.trim(S)){var A=/(?:\[.])?(\S+?)\((\S+?)x([\d\.]+)%\)/.exec(S);A&&(n["从属性数量"]++,n["所有的从属性"]+=U.get(A[1])+" "+x.get(A[2])+" "+Math.floor(10*parseFloat(A[3]))+" ")}}}catch(e){C=!0,w=e}finally{try{!k&&L.return&&L.return()}finally{if(C)throw w}}var T="\n[组别] [装备ID]\n[神秘属性数量] [所有的神秘属性]\n[主属性数量] [所有的主属性]\n[从属性数量] [所有的从属性]\n".trim(),D=!0,E=!1,M=void 0;try{for(var P,B=K.entries(n)[Symbol.iterator]();!(D=(P=B.next()).done);D=!0){var F=W(P.value,2),N=(u=F[0],F[1]);T=T.replace("["+u+"]",$.trim(N))}}catch(e){E=!0,M=e}finally{try{!D&&B.return&&B.return()}finally{if(E)throw M}}return T},w=n.handleUselessSubProperties=function(e){var t=q(e),n=[],a=!0,o=!1,i=void 0;try{for(var r,l=t["主属性"][Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value.split("(",1),s=W(d,1)[0],c=void 0===s?"":s;c&&n.push(U.get(c))}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}var u=/从属性：(.+?)(<br(?:\s*\/)?>|$)/.exec(e);if(u){var p="",f=!0,m=!1,g=void 0;try{for(var h,v=u[1].split("。")[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=h.value;if(b){var y=/(?:^|>)([^<>]+?)\(/.exec(b);if(y){var _=y[1];n.includes(U.get(_))||(b='<span class="pd_useless_sub_property">'+b+"</span>")}p+=b+"。"}}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}e=e.replace(u[0],"从属性："+p+u[2])}return e},L=function(){$('\n<div class="pd_item_btns" data-name="handleArmBtns">\n  <button name="openImOrExOrClearArmsLogDialog" type="button" title="导入/导出/清除已保存的装备信息">导入/导出/清除</button>\n  <button name="showArmsFinalAddition" type="button" title="显示当前页面上所有装备的最终加成信息">显示最终加成</button>\n  <button name="smeltSelectArms" type="button" style="color: #00f;" title="批量熔炼当前页面上所选的装备">熔炼所选</button>\n  <button name="smeltArms" type="button" style="color: #f00;" title="批量熔炼指定种类的装备">批量熔炼</button>\n</div>\n').insertAfter(T).find('[name="openImOrExOrClearArmsLogDialog"]').click(function(){a.showCommonImportOrExportLogDialog({name:"装备信息",read:h,write:v,merge:f,callback:function(e){$('<button name="clearArmsMemo" type="button" style="color: #00f;">清除备注</button> <button name="clear" type="button" style="color: #f00;">清除记录</button>').prependTo(e.find(".pd_cfg_btns")).filter('[name="clearArmsMemo"]').click(function(){confirm("是否清除所有装备的备注？")&&((0,M.read)(),Config.armsMemo={},(0,M.write)(),alert("所有装备的备注已被清除"),location.reload())}).end().filter('[name="clear"]').click(function(){confirm("是否清除所有已保存的装备信息？")&&(p(),alert("在本地保存的装备信息已被清除"),location.reload())})}})}).end().find('[name="showArmsFinalAddition"]').click(function(){var e=T.find('tr[data-id]:has([name="armCheck"]:checked)');if(confirm("是否显示当前页面上【"+(0<e.length?"所选":"全部")+"】装备的最终加成信息？\n（警告：请不要在争夺攻击途中使用此功能！）")){e.length||(e=T.find("tr[data-id]")),z.destroy();var a=[];if(e.each(function(){var e=$(this),t=parseInt(e.data("id")),n=e.data("class");t&&n&&a.push({armId:t,armClass:n})}),a.length){var o=[];T.find(".pd_arm_equipped").each(function(){var e=$(this),t=parseInt(e.data("id")),n=e.data("class");o.push({armId:t,armClass:n})}),o.length<2&&!confirm("未在当前页面上存在已装备的该类别装备，在操作后将装备为该页面上其类别的最后一件装备，是否继续？")||A(a,o,P)}}}).end().find('[name="smeltSelectArms"]').click(function(){var e=[];T.find('input[name="armCheck"]:checked').each(function(){e.push(parseInt($(this).val()))}),e.length&&confirm("是否熔炼所选的 "+e.length+" 件装备？")&&te({idList:e,safeId:P})}).end().find('[name="smeltArms"]').click(function(){return O(P)}),S($('.pd_item_btns[data-name="handleArmBtns"]'),T)},S=n.addCommonArmsButton=function(e,u){$('\n<label>\n  <input name="sortArmsByGroupEnabled" type="checkbox" '+(Config.sortArmsByGroupEnabled?"checked":"")+'> 分组排列</input>\n  <span class="pd_cfg_tips" title="分组排列装备">[?]</span>\n</label>\n<select name="select" style="width: 92px; vertical-align: middle; margin-bottom: 2px;">\n  <option>选择装备</option>\n  <option value="selectAll">全选</option>\n  <option value="selectInverse">反选</option>\n  <option value="selectCancel">取消</option>\n  <option value="selectWeapon">选择武器</option>\n  <option value="selectArmor">选择护甲</option>\n  <option value="selectNewArm">选择新装备</option>\n  <option value="selectNoMemo">选择无备注的装备</option>\n  <option value="selectArmId">选择指定ID的装备</option>\n</select>\n<button name="copyArmParameterSetting" type="button" title="复制所选装备的计算器参数设置">复制装备参数</button>\n').prependTo(e).find('[name="sortArmsByGroupEnabled"]').click(function(){var e=$(this).prop("checked");Config.sortArmsByGroupEnabled!==e&&((0,M.read)(),Config.sortArmsByGroupEnabled=e,(0,M.write)()),e?y(u):_(u)}).end().filter('[name="select"]').change(function(){var e=u.find("#pdSelectedArmsNum");e.text(0).parent().hide();var t=$(this).val(),n=u.find('input[name="armCheck"]');if("selectAll"===t)K.selectAll(n);else if("selectInverse"===t)K.selectInverse(n);else if("selectCancel"===t)n.prop("checked",!1);else if("selectWeapon"===t)n.prop("checked",!1),u.find('tr[data-class="武器"] input[name="armCheck"]').prop("checked",!0);else if("selectArmor"===t)n.prop("checked",!1),u.find('tr[data-class="护甲"] input[name="armCheck"]').prop("checked",!0);else if("selectNewArm"===t)n.prop("checked",!1),u.find('tr:has(.pd_new_arm_mark) input[name="armCheck"]').prop("checked",!0);else if("selectNoMemo"===t){if(n.prop("checked",!1),!u.find("tr:has(td[data-memo])").length&&!confirm("在当前页面上未发现包含备注的装备，建议检查一下你是否清空了装备备注，是否继续选择？"))return;var a=u.find('tr[data-id]:has(span:contains("传奇的"))').not(":has(td[data-memo])");if(0<a.length&&!confirm("你一共选择了 "+a.length+" 件传奇装备，是否继续选择？"))return;u.find('tr:not(:has(td[data-memo])) input[name="armCheck"]').prop("checked",!0)}else if("selectArmId"===t){var o=$.trim(prompt("请输入要选择的装备ID（多个装备ID用空格分隔）："));o&&(n.prop("checked",!1),u.find(o.split(" ").map(function(e){return'tr[data-id="'+e+'"] input[name="armCheck"]'}).join(",")).prop("checked",!0))}var i=n.filter(":checked").length;0<i&&e.text(i).parent().show(),Q.runFunc("Item.addCommonArmsButton_select_change_",{name:t,$armArea:u}),this.selectedIndex=0}).end().filter('[name="copyArmParameterSetting"]').click(function(){var e=$(this),a=[];if(u.find('input[name="armCheck"]:checked').each(function(){var e=$(this),t=parseInt(e.val()),n=e.closest("tr").find("> td:nth-child(3)").html();n&&a.push({id:t,info:q(n)})}),a.length){var t="",n=!0,o=!1,i=void 0;try{for(var r,l=a[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var d=r.value,s=d.id,c=d.info;t+=C(s,c)+"\n\n"}}catch(e){o=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw i}}e.data("copy-text",t.trim()),console.log("所选的 "+a.length+" 件装备的计算器装备参数设置：\n\n"+t.trim()),K.copyText(e,"所选的 "+a.length+" 件装备的计算器装备参数设置已复制")||alert("你的浏览器不支持复制，请打开Web控制台查看")}}),u.find("> tbody > tr:last-child > td:first-child").append('<div class="pd_highlight" style="position: absolute; left: 7px; top: 0; display: none;">(已选 <span id="pdSelectedArmsNum">0</span> 件)</div>'),Q.runFunc("Item.addCommonArmsButton_after_",{$area:e,$armArea:u})},A=n.showArmsFinalAddition=function(l,t,d){function s(e,t){if(T.find('.pd_arm_equipped[data-class="'+t+'"]').removeClass("pd_arm_equipped").end().find('tr[data-id="'+e+'"]').addClass("pd_arm_equipped"),Config.autoSaveArmsInfoEnabled){var n=h();n["已装备"+t]=e,v(n)}}function c(e,t,n){var a=e.armId,o=e.armClass,i=1<arguments.length&&void 0!==t&&t,r=2<arguments.length&&void 0!==n?n:null;$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=4&id="+a+"&safeid="+d,timeout:G.default.defAjaxTimeout}).done(function(e){var t=K.removeHtmlTag(e);console.log("【装备ID["+a+"]，装备类别["+o+"]】："+t.replace("\n"," ")),i?/装备完毕/.test(t)?(s(a,o),"function"==typeof r&&r()):setTimeout(function(){return c({armId:a,armClass:o},i,r)},G.default.minActionInterval):(/装备完毕|操作过快/.test(t)||(u++,!Config.autoSaveArmsInfoEnabled||"错误的编号"!==t&&"不是你的东西"!==t||m(a,T)),u>=l.length?f():/装备完毕/.test(t)?(s(a,o),setTimeout(function(){return p({armId:a,armClass:o})},G.default.defAjaxInterval)):setTimeout(function(){return c(l[u])},G.default.minActionInterval))}).fail(function(){return setTimeout(function(){return c({armId:a,armClass:o},i,r)},G.default.minActionInterval)})}var u=0,p=function e(t){var o=t.armId,i=t.armClass;$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:G.default.defAjaxTimeout}).done(function(e){if(r.find(".pd_countdown").text(l.length-(u+1)),r.data("stop"))f();else{var t="武器"===i?/>(攻击伤害\+[^<>]+)</.exec(e):/>(受伤回血\+[^<>]+)</.exec(e);if(t){var n=t[1];console.log("【装备ID["+o+"]，装备类别["+i+"]】："+n);var a=T.find('tr[data-id="'+o+'"]').find("td:nth-child(3)");a.find(".pd_final_addition_info").remove(),a.append('<span class="pd_final_addition_info" title="最终加成：'+n+'"><br>最终加成：'+n+"</span>")}++u>=l.length?f():(setTimeout(function(){return c(l[u])},G.default.minActionInterval),Q.runFunc("Item.showArmsFinalAddition_show_",{armId:o,armClass:i}))}}).fail(function(){return setTimeout(function(){return e({armId:o,armClass:i})},G.default.minActionInterval)})},f=function(){if(z.remove(r),0<t.length){var e=z.wait("<strong>正在还原为之前的装备&hellip;</strong>");setTimeout(function(){return c(t[0],!0,function(){t[1]?setTimeout(function(){return c(t[1],!0,function(){z.remove(e)})},G.default.minActionInterval):z.remove(e)})},G.default.minActionInterval)}Q.runFunc("Item.showArmsFinalAddition_complete_")},r=z.wait('<strong>正在获取装备最终加成信息&hellip;</strong><i>剩余：<em class="pd_countdown">'+l.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');c(l[0])},O=function(){var t="pdBatchSmeltArmsDialog";if(!(0<$("#"+t).length)){z.destroy(),(0,M.read)();var e="",n=!0,a=!1,o=void 0;try{for(var i,r=F[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;e+="<li><b>"+l+"：</b>";var d=!0,s=!1,c=void 0;try{for(var u,p=X[Symbol.iterator]();!(d=(u=p.next()).done);d=!0){var f=u.value.split("的")[0];if("神秘"!==f){var m=f+"的"+l;e+='\n<label style="margin-right: 5px;">\n  <input type="checkbox" name="smeltArmsType" value="'+m+'" '+(Config.defSmeltArmTypeList.includes(m)?"checked":"")+"> "+f+"\n</label>"}}}catch(e){s=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(s)throw c}}e+="</li>"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}var g='\n<div class="pd_cfg_main">\n  <div>请选择想批量熔炼的装备种类：</div>\n  <ul data-name="smeltArmTypeList">'+e+'</ul>\n</div>\n<div class="pd_cfg_btns">\n  <button name="selectAll" type="button">全选</button>\n  <button name="selectInverse" type="button">反选</button>\n  <button name="smelt" type="button" style="color: #f00;">熔炼</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',h=E.create(t,"批量熔炼装备",g),v=h.find('ul[data-name="smeltArmTypeList"]');h.find('[name="smelt"]').click(function(){var e=[];v.find('input[name="smeltArmsType"]:checked').each(function(){e.push($(this).val())}),e.length&&((0,M.read)(),Config.defSmeltArmTypeList=e,(0,M.write)(),confirm("是否熔炼所选装备种类？")&&(E.close(t),te({typeList:e,safeId:P})))}).end().find('[name="selectAll"]').click(function(){return K.selectAll(v.find('input[name="smeltArmsType"]'))}).end().find('[name="selectInverse"]').click(function(){return K.selectInverse(v.find('input[name="smeltArmsType"]'))}),E.show(t),Q.runFunc("Item.showBatchSmeltArmsDialog_after_")}},te=n.smeltArms=function(e){function t(){var r=[];T.find('td[id^="wp_"]').each(function(){var e=$(this).parent("tr");if(!e.hasClass("pd_arm_equipped")){var t=parseInt(e.data("id")),n=e.find("> td:nth-child(3) > span:first").text().trim(),a=n.split("的"),o=W(a,2)[1],i=j(o);n&&o&&(0<l.length&&l.includes(n)?r.push({armId:t,armClass:i,armGroup:o,armName:n}):0<d.length&&d.includes(t)&&r.push({armId:t,armClass:i,armGroup:o,armName:n}))}}),r.length?(c=0,$(document).clearQueue("SmeltArms"),$.each(r,function(e,t){var n=t.armId,a=t.armClass,o=t.armGroup,i=t.armName;$(document).queue("SmeltArms",function(){return function(a,o,i,r,e){c++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=5&id="+a+"&safeid="+s,timeout:G.default.defAjaxTimeout}).done(function(e){if(e){var t=K.removeHtmlTag(e);console.log("【"+r+"】 "+t),t.includes("错误的安全码")&&(u=!0),$('.pd_result[data-name="armResult"]:last').append("<li>【"+r+"】 "+t+"</li>"),T.find('td[id="wp_'+a+'"]').parent("tr").fadeOut("normal",function(){$(this).remove()}),Config.autoSaveArmsInfoEnabled&&/装备消失|错误的编号|不是你的东西/.test(t)&&f.push(a);var n=/获得对应装备经验\[\+(\d+)]/.exec(t);n&&(L++,a in Config.armsMemo&&(p=!0,delete Config.armsMemo[a]),o in S||(S[o]={}),i in S[o]||(S[o][i]={num:0,exp:0}),S[o][i].num++,S[o][i].exp+=parseInt(n[1]),A.find(".pd_countdown").text(L)),Q.runFunc("Item.smeltArms_after_",t)}}).fail(function(){$('.pd_result[data-name="armResult"]:last').append("<li>【"+r+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){u||A.data("stop")?g():c===e?setTimeout(m,G.default.minActionInterval):setTimeout(function(){return $(document).dequeue("SmeltArms")},G.default.minActionInterval)})}(n,a,o,i,r.length)})}),$(document).dequeue("SmeltArms")):g()}function C(){var e=null;Config.useItemsAfterOpenBoxesEnabled?e=function(){return ae({typeList:Config.defUseItemTypeList,safeId:s,nextActionEnabled:I})}:Config.sellItemsAfterOpenBoxesEnabled&&(e=function(){return oe({typeList:Config.defSellItemTypeList,safeId:s,nextActionEnabled:I})}),e?setTimeout(e,G.default.minActionInterval):Config.showArmsFinalAdditionAfterOpenBoxesEnabled&&ee()}function w(){if(p&&(0,M.write)(),Config.autoSaveArmsInfoEnabled){var e=h(),t=!0,n=!1,a=void 0;try{for(var o,i=f[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;delete e["装备列表"][r]}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}v(e)}}var n=e.typeList,l=void 0===n?[]:n,a=e.idList,d=void 0===a?[]:a,s=e.safeId,o=e.nextActionEnabled,I=void 0!==o&&o,L=0,c=0,S={},u=!1,p=!1,f=[],m=function(){Z(2,function(){A.data("stop")?g():setTimeout(t,G.default.defAjaxInterval)})},g=function(){if($(document).clearQueue("SmeltArms"),z.remove(A),$.isEmptyObject(S))return console.log("没有装备被熔炼！"),w(),I&&C(),void Q.runFunc("Item.smeltArms_complete_",{nextActionEnabled:I,$armArea:T});var e=0,t="",n="",a="",o="",i=!0,r=!1,l=void 0;try{for(var d,s=K.getSortedObjectKeyList(D,S)[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;n+="<b>【"+c+"】：</b><br>";var u=0,p={},f=!(p[c+"经验"]=0),m=!1,g=void 0;try{for(var h,v=K.getSortedObjectKeyList(F,S[c])[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=h.value;e++;var y=S[c][b],_=y.exp,x=y.num;u+=x,p[c+"经验"]+=_,n+="&nbsp;&nbsp;【"+b+"】 <i>装备<ins>-"+x+"</ins></i> <i>"+c+"经验<em>+"+_.toLocaleString()+"</em></i><br>"}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}var k="<i>"+c+"经验<em>+"+p[c+"经验"].toLocaleString()+"</em></i> ";t+=k,a+=k.trim(),o+=K.removeHtmlTag(k),V.push("熔炼装备","共有`"+u+"`个【`"+c+"`】装备熔炼成功",{gain:p,pay:{"装备":-u}})}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}$('.pd_result[data-name="armResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+e+"</em>个组别中的<em>"+L+"</em>个装备熔炼成功）：</b><br>\n  "+t+"<br>\n  "+n+"\n</li>"),console.log("共有"+e+"个组别中的"+L+"个装备熔炼成功，"+o),z.show("<strong>共有<em>"+e+"</em>个组别中的<em>"+L+"</em>个装备熔炼成功</strong>"+a,-1),w(),setTimeout(function(){return Z(2)},G.default.defAjaxInterval),I&&C(),Q.runFunc("Item.smeltArms_complete_",{nextActionEnabled:I,$armArea:T})};$.isEmptyObject(Config.armsMemo)||(0,M.read)(),T.parent().append('<ul class="pd_result" data-name="armResult"><li><strong>熔炼结果：</strong></li></ul>');var A=z.wait('<strong>正在熔炼装备中&hellip;</strong><i>已熔炼：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');t()},j=n.getArmClassNameByGroupName=function(e){switch(e){case"长剑":case"短弓":case"法杖":return"武器";case"铠甲":case"皮甲":case"布甲":return"护甲";default:return""}},q=n.getArmInfo=function(e){var t={"名称":"","颜色":"#000","类别":"","组别":"","描述":"","作用":"","主属性":[],"从属性":[]},n=/<span style="color:([^<>]+);">([^<>]+)<\/span>/.exec(e);if(!n)return t;t["颜色"]=n[1],t["名称"]=n[2];var a=n[2].split("的"),o=W(a,2)[1];t["组别"]=void 0===o?"":o,t["类别"]=j(t["组别"]);var i=e.split("</span> - ",2),r=W(i,2)[1];t["描述"]=void 0===r?"":r;var l=K.removeHtmlTag(t["描述"]),d=l.split("\n",1),s=W(d,1)[0];t["作用"]=void 0===s?"":s,(n=/主属性：(.+?)\n/.exec(l))&&(t["主属性"]=n[1].split("。")),(n=/从属性：(.+?)(\n|$)/.exec(l))&&(t["从属性"]=n[1].split("。"));var c=l.match(/([^。\s]+神秘)：(.+?)。/g);for(var u in c){var p=/([^。\s]+神秘)：(.+?)。/.exec(c[u]);c&&(t[p[1]]=p[2])}return t},R=(n.getArmsLevelInfo=function(e){var t=new Map([["武器",0],["护甲",0],["项链",0]]),n=e.match(/value="(\S+?)等级\[\s*(\d+)\s*] 经验:(\d+)"/g);for(var a in n){var o=/value="(\S+?)等级\[\s*(\d+)\s*] 经验:(\d+)"/.exec(n[a]);t.set(o[1],{"等级":parseInt(o[2]),"经验":parseInt(o[3])})}return t},n.getLevelByName=function(e){switch(e){case"零时迷子的碎片":case"被遗弃的告白信":case"学校天台的钥匙":case"TMA最新作压缩包":return 1;case"LOLI的钱包":case"棒棒糖":return 2;case"蕾米莉亚同人漫画":case"十六夜同人漫画":return 3;case"档案室钥匙":case"傲娇LOLI娇蛮音CD":return 4;case"整形优惠卷":case"消逝之药":return 5;default:return 0}}),H=(n.getItemsUsedNumInfo=function(e){var t=new Map([["蕾米莉亚同人漫画",0],["十六夜同人漫画",0],["档案室钥匙",0],["傲娇LOLI娇蛮音CD",0],["消逝之药",0],["整形优惠卷",0]]),n=e.match(/value="\[\s*(\d+)\s*](\S+?)"/g);for(var a in n){var o=/value="\[\s*(\d+)\s*](\S+?)"/.exec(n[a]);t.has(o[2])&&t.set(o[2],parseInt(o[1]))}return t},function(){$('\n<div class="pd_item_btns" data-name="handleItemsBtns">\n  <button name="useItems" type="button" style="color: #00f;" title="批量使用指定道具">批量使用</button>\n  <button name="sellItems" type="button" style="color: #f00;" title="批量出售指定道具">批量出售</button>\n</div>\n').insertAfter(I).find('[name="useItems"]').click(function(){return ne(1,P)}).end().find('[name="sellItems"]').click(function(){return ne(2,P)}),a.addSlowActionChecked($('.pd_item_btns[data-name="handleItemsBtns"]'))}),ne=function(t){var n="pdBatchUseAndSellItemsDialog";if(!(0<$("#"+n).length)){z.destroy();var a=1===t?"使用":"出售";(0,M.read)();var e="",o=!0,i=!1,r=void 0;try{for(var l,d=Y.slice(6)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){e+="<option>"+l.value+"</option>"}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}var s='\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0;">请选择想批量'+a+'的道具种类（按<b>Ctrl键</b>或<b>Shift键</b>可多选）：</div>\n  <select name="itemTypes" size="6" style="width: 320px;" multiple>'+e+'</select>\n</div>\n<div class="pd_cfg_btns">\n  <button name="sell" type="button">'+a+'</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',c=E.create(n,"批量"+a+"道具",s);c.find('[name="itemTypes"]').keydown(function(e){e.ctrlKey&&65===e.keyCode&&(e.preventDefault(),$(this).children().prop("selected",!0))}).end().find('[name="sell"]').click(function(){var e=c.find('[name="itemTypes"]').val();Array.isArray(e)&&((0,M.read)(),1===t?Config.defUseItemTypeList=e:Config.defSellItemTypeList=e,(0,M.write)(),confirm("是否"+a+"所选道具种类？")&&(E.close(n),1===t?ae({typeList:e,safeId:P}):oe({typeList:e,safeId:P})))}),c.find('[name="itemTypes"] > option').each(function(){var e=$(this);(1===t?Config.defUseItemTypeList:Config.defSellItemTypeList).includes(e.val())&&e.prop("selected",!0)}),E.show(n),Q.runFunc("Item.showBatchUseAndSellItemsDialog_after_",t)}},ae=n.useItems=function(e){function t(){var o=[];I.find('tr[id^="wp_"]').each(function(){var e=$(this),t=/wp_(\d+)/.exec(e.attr("id"));if(t){var n=parseInt(t[1]),a=e.find("> td:nth-child(3)").text().trim();s.includes(a)&&o.push({itemId:n,itemName:a})}}),o.length?(d=0,$(document).clearQueue("UseItems"),$.each(o,function(e,t){var n=t.itemId,a=t.itemName;$(document).queue("UseItems",function(){return function(o,i,r){d++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=1&id="+o+"&safeid="+l,timeout:G.default.defAjaxTimeout}).done(function(e){if(e){var t=K.removeHtmlTag(e),n=!1;if(/(成功|失败)！/.test(t))_++,i in C||(C[i]={"道具":0,"有效道具":0,"无效道具":0}),C[i]["道具"]++,/成功！/.test(t)?(C[i]["有效道具"]++,x++):(C[i]["无效道具"]++,k++),w.find(".pd_countdown").text(_),n=!0;else if(t.includes("无法再使用")){d=r;var a=s.indexOf(i);-1<a&&s.splice(a,1)}else t.includes("错误的安全码")?c=!0:n=!0;n&&I.find('[id="wp_'+o+'"]').fadeOut("normal",function(){$(this).remove()}),console.log("【Lv."+R(i)+"："+i+"】 "+t),$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+R(i)+"："+i+"】 "+t+"</li>"),Q.runFunc("Item.useItems_after_",t)}}).fail(function(){$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+R(i)+"："+i+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){c||w.data("stop")?p():d===r?setTimeout(u,"function"==typeof G.default.specialAjaxInterval?G.default.specialAjaxInterval():G.default.specialAjaxInterval):setTimeout(function(){return $(document).dequeue("UseItems")},"function"==typeof G.default.specialAjaxInterval?G.default.specialAjaxInterval():G.default.specialAjaxInterval)})}(n,a,o.length)})}),$(document).dequeue("UseItems")):p()}function v(){var e=null;Config.sellItemsAfterOpenBoxesEnabled&&(e=function(){return oe({typeList:Config.defSellItemTypeList,safeId:l,nextActionEnabled:y})}),e?setTimeout(e,G.default.minActionInterval):Config.showArmsFinalAdditionAfterOpenBoxesEnabled&&ee()}var b=e.typeList,l=e.safeId,n=e.nextActionEnabled,y=void 0!==n&&n,_=0,x=0,k=0,d=0,C={},s=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(b)),c=!1,u=function(){Z(2,function(){w.data("stop")?p():setTimeout(t,G.default.defAjaxInterval)})},p=function(){if($(document).clearQueue("UseItems"),z.remove(w),$.isEmptyObject(C))return console.log("没有道具被使用！"),y&&v(),void Q.runFunc("Item.useItems_complete_",{nextActionEnabled:y,$armArea:T});var e=0,t="",n=!0,a=!1,o=void 0;try{for(var i,r=K.getSortedObjectKeyList(b,C)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;e++;var d=R(l),s=C[l],c=s["道具"];if(delete s["道具"],0===s["有效道具"]&&delete s["有效道具"],0===s["无效道具"]&&delete s["无效道具"],!$.isEmptyObject(s)){t+="【Lv."+d+"："+l+"】 <i>道具<ins>-"+c+"</ins></i> ";var u=!0,p=!1,f=void 0;try{for(var m,g=K.entries(s)[Symbol.iterator]();!(u=(m=g.next()).done);u=!0){var h=W(m.value,2);t+="<i>"+h[0]+"<em>+"+h[1]+"</em></i> "}}catch(e){p=!0,f=e}finally{try{!u&&g.return&&g.return()}finally{if(p)throw f}}t+="<br>",V.push("使用道具","共有`"+c+"`个【`Lv."+d+"："+l+"`】道具被使用",{gain:s,pay:{"道具":-c}})}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}$('.pd_result[data-name="itemResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+e+"</em>个种类中的<em>"+_+"</em>个道具被使用，\n<i>有效道具<em>+"+x+"</em></i><i>无效道具<em>+"+k+"</em></i>）：</b><br>\n  "+t+"\n</li>"),console.log("共有"+e+"个种类中的"+_+"个道具被使用，有效道具+"+x+"，无效道具+"+k),z.show("<strong>共有<em>"+e+"</em>个种类中的<em>"+_+"</em>个道具被使用</strong><i>有效道具<em>+"+x+"</em></i><i>无效道具<em>+"+k+"</em></i>",-1),setTimeout(function(){return Z(2)},G.default.defAjaxInterval),y&&v(),Q.runFunc("Item.useItems_complete_",{nextActionEnabled:y,$armArea:T})};I.parent().append('<ul class="pd_result" data-name="itemResult"><li><strong>使用结果：</strong></li></ul>');var w=z.wait('<strong>正在使用道具中&hellip;</strong><i>已使用：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');t()},oe=n.sellItems=function(e){function t(){var o=[];I.find('tr[id^="wp_"]').each(function(){var e=$(this),t=/wp_(\d+)/.exec(e.attr("id"));if(t){var n=parseInt(t[1]),a=e.find("> td:nth-child(3)").text().trim();f.includes(a)&&o.push({itemId:n,itemName:a})}}),o.length?(r=0,$(document).clearQueue("SellItems"),$.each(o,function(e,t){var n=t.itemId,a=t.itemName;$(document).queue("SellItems",function(){return function(a,o,e){r++,$.ajax({type:"POST",url:"kf_fw_ig_mybpdt.php",data:"do=2&id="+a+"&safeid="+i,timeout:G.default.defAjaxTimeout}).done(function(e){if(e){var t=K.removeHtmlTag(e);t.includes("错误的安全码")&&(l=!0),console.log("【Lv."+R(o)+"："+o+"】 "+t),$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+R(o)+"："+o+"】 "+t+"</li>"),I.find('[id="wp_'+a+'"]').fadeOut("normal",function(){$(this).remove()});var n=/出售该物品获得了\[\s*(\d+)\s*]KFB/.exec(t);n&&(g++,o in h||(h[o]={num:0,sell:0}),h[o].num++,h[o].sell+=parseInt(n[1]),v.find(".pd_countdown").text(g)),Q.runFunc("Item.sellItems_after_",t)}}).fail(function(){$('.pd_result[data-name="itemResult"]:last').append("<li>【Lv."+R(o)+"："+o+'】 <span class="pd_notice">连接超时</span></li>')}).always(function(){l||v.data("stop")?s():r===e?setTimeout(d,G.default.minActionInterval):setTimeout(function(){return $(document).dequeue("SellItems")},G.default.minActionInterval)})}(n,a,o.length)})}),$(document).dequeue("SellItems")):s()}var f=e.typeList,i=e.safeId,n=e.nextActionEnabled,m=void 0!==n&&n,g=0,r=0,h={},l=!1,d=function(){Z(2,function(){v.data("stop")?s():setTimeout(t,G.default.defAjaxInterval)})},s=function(){if($(document).clearQueue("SellItems"),z.remove(v),$.isEmptyObject(h))return console.log("没有道具被出售！"),Config.showArmsFinalAdditionAfterOpenBoxesEnabled&&ee(),void Q.runFunc("Item.sellItems_complete_",{nextActionEnabled:m,$armArea:T});var e=0,t=0,n="",a=!0,o=!1,i=void 0;try{for(var r,l=K.getSortedObjectKeyList(f,h)[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=r.value;e++;var s=R(d),c=h[d],u=c.sell,p=c.num;t+=u,n+="【Lv."+s+"："+d+"】 <i>道具<ins>-"+p+"</ins></i> <i>KFB<em>+"+u.toLocaleString()+"</em></i><br>",V.push("出售道具","共有`"+p+"`个【`Lv."+s+"："+d+"`】道具出售成功",{gain:{KFB:u},pay:{"道具":-p}})}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}$('.pd_result[data-name="itemResult"]:last').append('\n<li class="pd_stat">\n  <b>统计结果（共有<em>'+e+"</em>个种类中的<em>"+g+"</em>个道具出售成功）：</b> <i>KFB<em>+"+t.toLocaleString()+"</em></i><br>\n  "+n+"\n</li>"),console.log("共有"+e+"个种类中的"+g+"个道具出售成功，KFB+"+t),z.show("<strong>共有<em>"+e+"</em>个种类中的<em>"+g+"</em>个道具出售成功</strong><i>KFB<em>+"+t.toLocaleString()+"</em></i>",-1),setTimeout(function(){return Z(2)},G.default.defAjaxInterval),Config.showArmsFinalAdditionAfterOpenBoxesEnabled&&ee(),Q.runFunc("Item.sellItems_complete_",{nextActionEnabled:m,$armArea:T})};I.parent().append('<ul class="pd_result" data-name="itemResult"><li><strong>出售结果：</strong></li></ul>');var v=z.wait('<strong>正在出售道具中&hellip;</strong><i>已出售：<em class="pd_countdown">0</em></i><a class="pd_stop_action" href="#">停止操作</a>');t()};n.buyItems=function(e){if(new Date<K.getDateByTime(Config.buyItemAfterTime))$(document).dequeue("AutoAction");else{var C=0,w=0,I=!1,L=[],S=function(e){switch(parseInt(e)){case 101:return"等级经验药丸";case 102:return"等级经验药丸（蛋）";case 103:return"修炼手册";default:return"未知"}},A=function(){var e=new Date,t=K.getTimezoneDateByTime("00:25:00");return t<e&&t.setDate(t.getDate()+1),t},a=function e(k,t){$.ajax({type:"POST",url:"kf_fw_ig_shop.php",data:"buy="+k+"&safeid="+t,timeout:G.default.defAjaxTimeout}).done(function(e){var t=K.removeHtmlTag(e),n=S(k);console.log("【购买物品】【"+n+"】："+t);var a=!1;if(t.includes("购买成功")){C++,w=0;var o=/\+(\d+)(武器\/护甲经验|经验)/.exec(t);if(o){var i=parseInt(o[1]),r=o[2],l={},d=function(e){switch(parseInt(e)){case 101:return{KFB:-5e3};case 102:return{KFB:-1e4};case 103:return{"普通盒子":-100};default:return null}}(k);"经验"===r?l["经验值"]=i:(l["武器经验"]=i,l["护甲经验"]=i),d&&V.push("购买物品","共有`1`个【`"+n+"`】购买成功",{gain:l,pay:d});var s="",c=!0,u=!1,p=void 0;try{for(var f,m=K.entries(l)[Symbol.iterator]();!(c=(f=m.next()).done);c=!0){var g=W(f.value,2);s+="<i>"+g[0]+"<em>+"+g[1].toLocaleString()+"</em></i>"}}catch(e){u=!0,p=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw p}}var h=!0,v=!1,b=void 0;try{for(var y,_=K.entries(d)[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=W(y.value,2);s+="<i>"+x[0]+"<ins>"+x[1].toLocaleString()+"</ins></i>"}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}a=!0,z.show("<strong>购买物品【"+n+"】"+s),Q.runFunc("Item.buyItems_success_",t)}}else t.includes("不足")?++w>=L[C].length&&(C++,w=0):(t.includes("操作过快")||(C++,w=0),t.includes("本日购买次数已用完")&&(1===C&&(a=!0),I=!0,K.setCookie(G.default.buyItemCookieName,1,A())));a||z.show("<strong>购买物品【"+n+"】："+t+"</strong>")}).fail(function(){C++,w=0,z.show("<strong>购买物品【"+S(k)+"】：连接超时</strong>")}).always(function(){(I=I||s.data("stop"))||C>=L.length?(z.remove(s),K.deleteCookie(G.default.buyItemReadyCookieName),K.setCookie(G.default.buyItemCookieName,1,A()),setTimeout(function(){return $(document).dequeue("AutoAction")},G.default.minActionInterval),Q.runFunc("Item.buyItems_complete_")):setTimeout(function(){return e(parseInt(L[C][w]),t)},G.default.minActionInterval)})},t=!0,n=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var l=i.value;if(/^\d+(\|\d+)*$/.test(l)){var d=l.split("|").filter(function(e){return e&&"未知"!==S(parseInt(e))});0<d.length&&L.push(d)}}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}if(!L.length)return K.setCookie(G.default.buyItemCookieName,1,A()),void $(document).dequeue("AutoAction");var s=z.wait('<strong>正在购买物品中&hellip;</strong><i>剩余：<em class="pd_countdown">'+L.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');!function e(){console.log("读取购买页面信息Start"),$.ajax({type:"GET",url:"kf_fw_ig_shop.php?t="+$.now(),timeout:G.default.defAjaxTimeout}).done(function(e){if(K.getCookie(G.default.buyItemReadyCookieName))return z.remove(s),void $(document).dequeue("AutoAction");var t=/safeid=(\w+)/.exec(e);if(t){K.setCookie(G.default.buyItemReadyCookieName,1,K.getDate("+5m"));var n=t[1];setTimeout(function(){return a(parseInt(L[C][w]),n)},G.default.defAjaxInterval)}else z.remove(s),K.setCookie(G.default.buyItemCookieName,1,K.getDate("+15m")),$(document).dequeue("AutoAction")}).fail(function(){setTimeout(e,G.default.defAjaxInterval)})}()}},n.showMyInfoInItemShop=function(){$.get("profile.php?action=show&uid="+i.default.uid+"&t="+$.now(),function(e){var t=/论坛货币：(\d+)\s*KFB/.exec(e),n=/贡献数值：(\d+(?:\.\d+)?)/.exec(e);if(t||n){var a=parseInt(t[1]),o=parseFloat(n[1]);$(".kf_fw_ig_title1:eq(1)").append('\n<span style="margin-left: 7px;">(当前持有 <b style="font-size: 14px;">'+a.toLocaleString()+'</b> KFB 和 <b style="font-size: 14px;">'+o+"</b> 贡献)</span>\n")}})},n.showBuyItemTips=function(){$(".kf_fw_ig1:first > tbody > tr:gt(0)").each(function(e){e<=1&&$(this).find("td:last-child").append('<span class="pd_cfg_tips pd_highlight" title="特别提示：\n神秘系数非神秘等级，购买【等级经验药丸'+(1===e?"（蛋）":"")+'】可能导致神秘等级下降，请知悉！\n神秘等级公式：神秘系数*((神秘系数*0.5)+(贡献*5)+(KFB*0.001)+(发帖*0.01))">[?]</span>')})}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Log":11,"./Loot":13,"./Msg":15,"./Public":18,"./Script":20,"./Util":23}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.push=n.clear=n.write=n.read=void 0;var a=o(e("./Info")),_=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./Util"));function o(e){return e&&e.__esModule?e:{default:e}}var i=o(e("./Const")).default.storagePrefix+"log",x=n.read=function(){var t={},e=_.readData(i+"_"+a.default.uid);if(!e)return t;try{e=JSON.parse(e)}catch(e){return t}return e&&"object"===$.type(e)?t=e:t},k=n.write=function(e){return _.writeData(i+"_"+a.default.uid,JSON.stringify(e))};n.clear=function(){return _.deleteData(i+"_"+a.default.uid)},n.push=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:{},o=a.gain,i=void 0===o?null:o,r=a.pay,l=void 0===r?null:r,d=x(),s=_.getDateString(_.getDate("-"+Config.logSaveDays+"d")),c=!0,u=!1,p=void 0;try{for(var f,m=_.getObjectKeyList(d,1)[Symbol.iterator]();!(c=(f=m.next()).done);c=!0){var g=f.value;if(!(g<=s))break;delete d[g]}}catch(e){u=!0,p=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw p}}var h=new Date,v=h.getTime(),b=_.getDateString(h),y={time:v,type:e,action:t};i&&(y.gain=i),l&&(y.pay=l),Array.isArray(d[b])||(d[b]=[]),d[b].push(y),k(d)},n.getMergeLog=function(n,e){for(var a in e)if(Array.isArray(n[a])){var t=!0,o=!1,i=void 0;try{for(var r,l=function(){var t=r.value;if("number"!=typeof t.time||"string"!=typeof t.type)return"continue";var e=n[a].findIndex(function(e){return t.time===e.time&&t.type===e.type});-1<e?n[a][e]=t:n[a].push(t)},d=e[a][Symbol.iterator]();!(t=(r=d.next()).done);t=!0)l()}catch(e){o=!0,i=e}finally{try{!t&&d.return&&d.return()}finally{if(o)throw i}}n[a].sort(function(e,t){return e.time>t.time?1:-1})}else n[a]=e[a];return n}},{"./Const":6,"./Info":9,"./Util":23}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.show=void 0;var Ot=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},jt=a(e("./Util")),d=a(e("./Dialog")),s=e("./Config"),c=a(e("./Log")),qt=a(e("./Item")),u=a(e("./Read")),p=a(e("./Script"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.show=function(){var e="pdLogDialog";if(!(0<$("#"+e).length)){(0,s.read)(),p.runFunc("LogDialog.show_before_");var a=d.create(e,"KFOL助手日志",'\n<div class="pd_cfg_main">\n  <div class="pd_log_nav">\n    <a class="pd_disabled_link" data-name="start" href="#">&lt;&lt;</a>\n    <a class="pd_disabled_link" data-name="prev" href="#" style="padding: 0 7px;">&lt;</a>\n    <h2 class="pd_log_date pd_custom_tips">暂无日志</h2>\n    <a class="pd_disabled_link" data-name="next" href="#" style="padding: 0 7px;">&gt;</a>\n    <a class="pd_disabled_link" data-name="end" href="#">&gt;&gt;</a>\n  </div>\n  <fieldset>\n    <legend>日志内容</legend>\n    <div>\n      <strong>排序方式：</strong>\n      <label title="按时间顺序排序"><input type="radio" name="sortType" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType" value="type"> 按类别</label>\n    </div>\n    <div class="pd_stat pd_log_content">暂无日志</div>\n  </fieldset>\n  <fieldset>\n    <legend>统计结果</legend>\n    <div>\n      <strong>统计范围：</strong>\n      <label title="显示当天的统计结果"><input type="radio" name="statType" value="current" checked> 当天</label>\n      <label title="显示距该日N天内的统计结果"><input type="radio" name="statType" value="custom"></label>\n      <label title="显示距该日N天内的统计结果"><input name="statDays" type="text" style="width: 22px;" maxlength="3"> 天内</label>\n      <label title="显示全部统计结果"><input type="radio" name="statType" value="all"> 全部</label>\n    </div>\n    <div class="pd_stat" data-name="stat">暂无日志</div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a class="pd_btn_link" data-name="openImOrExLogDialog" href="#">导入/导出日志</a>\n    <a class="pd_btn_link" data-name="openBuyThreadLogDialog" href="#">查看购买帖子记录</a>\n  </span>\n  <button data-action="close" type="button">关闭</button>\n  <button name="clear" type="button">清除日志</button>\n</div>',"width: 880px;"),o=a.find(".pd_log_nav"),i=c.read(),r=[],l=0;$.isEmptyObject(i)||(r=jt.getObjectKeyList(i,1),l=r.length-1,o.find(".pd_log_date").attr("title","总共记录了"+r.length+"天的日志").text(r[l]),1<r.length&&(o.find('[data-name="start"]').attr("title",r[0]).removeClass("pd_disabled_link"),o.find('[data-name="prev"]').attr("title",r[l-1]).removeClass("pd_disabled_link"))),o.on("click","a[data-name]",function(e){e.preventDefault();var t=$(this);if(!t.hasClass("pd_disabled_link")){var n=t.data("name");if("start"===n)l=0;else if("prev"===n){if(!(0<l))return;l--}else if("next"===n){if(!(l<r.length-1))return;l++}else"end"===n&&(l=r.length-1);o.find(".pd_log_date").text(r[l]),f(i,r[l],a),g(i,r[l],a),0<l?(o.find('[data-name="start"]').attr("title",r[0]).removeClass("pd_disabled_link"),o.find('[data-name="prev"]').attr("title",r[l-1]).removeClass("pd_disabled_link")):o.find('[data-name="start"], [data-name="prev"]').removeAttr("title").addClass("pd_disabled_link"),l<r.length-1?(o.find('[data-name="next"]').attr("title",r[l+1]).removeClass("pd_disabled_link"),o.find('[data-name="end"]').attr("title",r[r.length-1]).removeClass("pd_disabled_link")):o.find('[data-name="next"], [data-name="end"]').removeAttr("title").addClass("pd_disabled_link")}}),a.find('[name="sortType"]').click(function(){var e=$(this).val();Config.logSortType!==e&&(Config.logSortType=e,(0,s.write)(),f(i,r[l],a))}).end().find('[name="statType"]').click(function(){var e=$(this).val();Config.logStatType!==e&&(Config.logStatType=e,(0,s.write)(),g(i,r[l],a))}).end().find('[name="statDays"]').keyup(function(){var e=parseInt($(this).val());0<e&&Config.logStatDays!==e&&(Config.logStatDays=e,(0,s.write)(),a.find('[name="statType"][value="custom"]:not(:checked)').click(),g(i,r[l],a))}).end().find('[name="sortType"][value="'+Config.logSortType+'"]').click().end().find('[name="statType"][value="'+Config.logStatType+'"]').click().end().find('[name="statDays"]').val(Config.logStatDays),a.find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清除所有日志？")&&(c.clear(),alert("日志已清除"),location.reload())}).end().find('[data-name="openImOrExLogDialog"]').click(function(e){e.preventDefault(),v()}).end().find('[data-name="openBuyThreadLogDialog"]').click(function(e){e.preventDefault(),u.showBuyThreadLogDialog()}),f(i,r[l],a),g(i,r[l],a),$(window).height()<=750&&a.find(".pd_log_content").css("height","192px"),d.show(e),p.runFunc("LogDialog.show_after_")}};var f=function(e,t,n){Array.isArray(e[t])&&n.find(".pd_log_content").html(m(e,t,Config.logSortType)).parent().find("legend:first-child").text("日志内容 (共"+e[t].length+"项)")},m=function(e,t,n){var a=e[t];if("type"===n){var o=["领取每日奖励","提升战力光环","争夺攻击","捐款","领取争夺奖励","批量攻击","试探攻击","抽取神秘盒子","抽取道具或卡片","打开盒子","购买物品","使用道具","恢复道具","循环使用道具","将道具转换为能量","将卡片转换为VIP时间","购买道具","统计道具购买价格","出售道具","熔炼装备","神秘抽奖","统计神秘抽奖结果","神秘等级升级","神秘系数排名变化","批量转账","购买帖子","自动存款"];a.sort(function(e,t){return o.indexOf(e.type)>o.indexOf(t.type)?1:-1})}else a.sort(function(e,t){return e.time>t.time?1:-1});var i="",r="",l=!0,d=!1,s=void 0;try{for(var c,u=a[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var p=c.value,f=p.time,m=p.type,g=p.action,h=p.gain,v=p.pay;if(void 0!==f&&void 0!==m&&void 0!==g){var b=new Date(f);"type"===n?(r!==m&&(i+="<h3>【"+m+"】</h3>",r=m),i+="<p><b>"+jt.getTimeString(b)+"：</b>"+g.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>')):i+="<p><b>"+jt.getTimeString(b)+" ("+m+")：</b>"+g.replace(/`([^`]+?)`/g,'<b style="color: #f00;">$1</b>');var y="";if("object"===$.type(h)&&!$.isEmptyObject(h)){y+="，";var _=!0,x=!1,k=void 0;try{for(var C,w=Object.keys(h)[Symbol.iterator]();!(_=(C=w.next()).done);_=!0){var I=C.value;if("item"===I){var L=!0,S=!1,A=void 0;try{for(var T,D=jt.getSortedObjectKeyList(qt.itemTypeList,h[I])[Symbol.iterator]();!(L=(T=D.next()).done);L=!0){var E=T.value;y+="<i>"+E+"<em>+"+h[I][E].toLocaleString()+"</em></i> "}}catch(e){S=!0,A=e}finally{try{!L&&D.return&&D.return()}finally{if(S)throw A}}}else if("arm"===I){var M=!0,P=!1,B=void 0;try{for(var F,N=jt.getSortedObjectKeyList(qt.armTypeList,h[I])[Symbol.iterator]();!(M=(F=N.next()).done);M=!0){var U=F.value;y+="<i>"+U+"<em>+"+h[I][U].toLocaleString()+"</em></i> "}}catch(e){P=!0,B=e}finally{try{!M&&N.return&&N.return()}finally{if(P)throw B}}}else if("box"===I){var O=!0,j=!1,q=void 0;try{for(var R,H=jt.getSortedObjectKeyList(qt.boxTypeList,h[I])[Symbol.iterator]();!(O=(R=H.next()).done);O=!0){var W=R.value;y+="<i>"+W+"<em>+"+h[I][W].toLocaleString()+"</em></i> "}}catch(e){j=!0,q=e}finally{try{!O&&H.return&&H.return()}finally{if(j)throw q}}}else y+="<i>"+I+"<em>+"+h[I].toLocaleString()+"</em></i> "}}catch(e){x=!0,k=e}finally{try{!_&&w.return&&w.return()}finally{if(x)throw k}}}if("object"===$.type(v)&&!$.isEmptyObject(v)){y||(y+="，");var K=!0,z=!1,G=void 0;try{for(var V,Q=Object.keys(v)[Symbol.iterator]();!(K=(V=Q.next()).done);K=!0){var J=V.value;if("item"===J){var X=!0,Y=!1,Z=void 0;try{for(var ee,te=Object.keys(v[J])[Symbol.iterator]();!(X=(ee=te.next()).done);X=!0){var ne=ee.value;y+="<i>"+ne+"<ins>"+v[J][ne].toLocaleString()+"</ins></i> "}}catch(e){Y=!0,Z=e}finally{try{!X&&te.return&&te.return()}finally{if(Y)throw Z}}}else y+="<i>"+J+"<ins>"+v[J].toLocaleString()+"</ins></i> "}}catch(e){z=!0,G=e}finally{try{!K&&Q.return&&Q.return()}finally{if(z)throw G}}}i+=y+"</p>"}}}catch(e){d=!0,s=e}finally{try{!l&&u.return&&u.return()}finally{if(d)throw s}}return i},g=function(e,t,n){Array.isArray(e[t])&&n.find('[data-name="stat"]').html(h(e,t,Config.logStatType))},h=function(e,t,n){var a={};if("custom"===n){var o=new Date(t);o.setDate(o.getDate()-Config.logStatDays+1),o=jt.getDateString(o);var i=!0,r=!1,l=void 0;try{for(var d,s=jt.getObjectKeyList(e,1)[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;o<=c&&c<=t&&(a[c]=e[c])}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}}else"all"===n?a=e:a[t]=e[t];var u={},p={},f={},m=0,g={total:0,min:0,max:0},h=0,v={},b=0,y={},_={KFB:0,"经验值":0,"道具":0,"装备":0,item:{},arm:{}},x=0,k=0,C=0,w={},I=0,L={},S=["item","arm","box","夺取KFB","VIP小时","神秘","燃烧伤害","命中","闪避","暴击比例","暴击几率","防御","有效道具","无效道具","长剑经验","短弓经验","法杖经验"];for(var A in a){var T=!0,D=!1,E=void 0;try{for(var M,P=a[A][Symbol.iterator]();!(T=(M=P.next()).done);T=!0){var B=M.value,F=B.type,N=B.action,U=B.gain,O=B.pay,j=B.notStat;if(void 0!==F&&void 0===j){if("object"===$.type(U)){var q=!0,R=!1,H=void 0;try{for(var W,K=Object.keys(U)[Symbol.iterator]();!(q=(W=K.next()).done);q=!0){var z=W.value;S.includes(z)||(void 0===u[z]?u[z]=U[z]:u[z]+=U[z])}}catch(e){R=!0,H=e}finally{try{!q&&K.return&&K.return()}finally{if(R)throw H}}}if("object"===$.type(O)){var G=!0,V=!1,Q=void 0;try{for(var J,X=Object.keys(O)[Symbol.iterator]();!(G=(J=X.next()).done);G=!0){var Y=J.value;S.includes(Y)||(void 0===p[Y]?p[Y]=O[Y]:p[Y]+=O[Y])}}catch(e){V=!0,Q=e}finally{try{!G&&X.return&&X.return()}finally{if(V)throw Q}}}if("争夺攻击"===F&&"object"===$.type(U)){var Z=/第`(\d+)`层/.exec(N);if(Z){m++;var ee=parseInt(Z[1]);if(g.total+=ee,g.max<ee&&(g.max=ee),(!g.min||g.min>ee)&&(g.min=ee),"object"===$.type(U.box)){var te=!0,ne=!1,ae=void 0;try{for(var oe,ie=jt.entries(U.box)[Symbol.iterator]();!(te=(oe=ie.next()).done);te=!0){var re=Ot(oe.value,2),le=re[0];h+=Ee=re[1],le in v||(v[le]={total:0,min:-1,max:-1}),v[le].total+=Ee,v[le].max<Ee&&(v[le].max=Ee),(v[le].min<0||v[le].min>Ee)&&(v[le].min=Ee)}}catch(e){ne=!0,ae=e}finally{try{!te&&ie.return&&ie.return()}finally{if(ne)throw ae}}var de=!0,se=!1,ce=void 0;try{for(var ue,pe=qt.boxTypeList[Symbol.iterator]();!(de=(ue=pe.next()).done);de=!0){!((le=ue.value)in U.box)&&le in v&&(v[le].min=0)}}catch(e){se=!0,ce=e}finally{try{!de&&pe.return&&pe.return()}finally{if(se)throw ce}}}}}else if("打开盒子"===F&&"object"===$.type(U)&&"object"===$.type(O)){var fe=/【`(.+?)`】打开成功/.exec(N);if(!fe)continue;var me=fe[1],ge=Math.abs(O["盒子"]);b+=ge,me in y||(y[me]=0),y[me]+=Math.abs(O["盒子"]);var he=/平均随机值【`([\d\.]+)`】/.exec(N);he&&(k+=ge,x+=parseFloat(he[1])*ge);var ve=!0,be=!1,ye=void 0;try{for(var _e,xe=jt.entries(U)[Symbol.iterator]();!(ve=(_e=xe.next()).done);ve=!0){var ke=Ot(_e.value,2),Ce=ke[0],we=ke[1];if(Ce in _)if("object"===$.type(we)){var Ie=!0,$e=!1,Le=void 0;try{for(var Se,Ae=jt.entries(we)[Symbol.iterator]();!(Ie=(Se=Ae.next()).done);Ie=!0){var Te=Ot(Se.value,2),De=Te[0],Ee=Te[1];De in _[Ce]||(_[Ce][De]=0),_[Ce][De]+=Ee}}catch(e){$e=!0,Le=e}finally{try{!Ie&&Ae.return&&Ae.return()}finally{if($e)throw Le}}}else _[Ce]+=we}}catch(e){be=!0,ye=e}finally{try{!ve&&xe.return&&xe.return()}finally{if(be)throw ye}}}else if(("使用道具"===F||"循环使用道具"===F)&&"object"===$.type(U)){var Me=/【`Lv.(\d+)：(.+?)`】/.exec(N);if(Me){if(parseInt(Me[1])<3)continue;var Pe=Me[2];0<U["有效道具"]&&(C+=U["有效道具"],void 0===w[Pe]&&(w[Pe]=0),w[Pe]+=U["有效道具"]),0<U["无效道具"]&&(I+=U["无效道具"],void 0===L[Pe]&&(L[Pe]=0),L[Pe]+=U["无效道具"])}}}}}catch(e){D=!0,E=e}finally{try{!T&&P.return&&P.return()}finally{if(D)throw E}}}var Be="",Fe=["KFB","经验值","贡献","转账额度","盒子","道具","已使用道具","装备","武器经验","护甲经验","项链经验","能量","卡片"];Be+="<strong>收获：</strong>";var Ne=!0,Ue=!1,Oe=void 0;try{for(var je,qe=jt.getSortedObjectKeyList(Fe,u)[Symbol.iterator]();!(Ne=(je=qe.next()).done);Ne=!0){var Re=je.value;f[Re]=u[Re],Be+="<i>"+Re+"<em>+"+u[Re].toLocaleString()+"</em></i> "}}catch(e){Ue=!0,Oe=e}finally{try{!Ne&&qe.return&&qe.return()}finally{if(Ue)throw Oe}}Be+="<br><strong>付出：</strong>";var He=!0,We=!1,Ke=void 0;try{for(var ze,Ge=jt.getSortedObjectKeyList(Fe,p)[Symbol.iterator]();!(He=(ze=Ge.next()).done);He=!0){var Ve=ze.value;void 0===f[Ve]?f[Ve]=p[Ve]:f[Ve]+=p[Ve],Be+="<i>"+Ve+"<ins>"+p[Ve].toLocaleString()+"</ins></i> "}}catch(e){We=!0,Ke=e}finally{try{!He&&Ge.return&&Ge.return()}finally{if(We)throw Ke}}Be+="<br><strong>结余：</strong>";var Qe=!0,Je=!1,Xe=void 0;try{for(var Ye,Ze=jt.getSortedObjectKeyList(Fe,f)[Symbol.iterator]();!(Qe=(Ye=Ze.next()).done);Qe=!0){var et=Ye.value;Be+="<i>"+et+jt.getStatFormatNumber(f[et])+"</i> "}}catch(e){Je=!0,Xe=e}finally{try{!Qe&&Ze.return&&Ze.return()}finally{if(Je)throw Xe}}if(Be+='<div style="margin: 5px 0; border-bottom: 1px dashed #ccccff;"></div>',Be+="\n<strong>争夺攻击统计：</strong><i>次数<em>+"+m+"</em></i> ",0<m){Be+='<i>层数<span class="pd_stat_extra">(<em title="平均值">+'+(g.total/m).toFixed(2)+'</em>|<em title="最小值">+'+g.min+'</em>|<em title="最大值">+'+g.max+"</em>)</span></i> ",Be+="<i>盒子<em>+"+h.toLocaleString()+"</em></i> ";var tt=!0,nt=!1,at=void 0;try{for(var ot,it=jt.getSortedObjectKeyList(qt.boxTypeList,v)[Symbol.iterator]();!(tt=(ot=it.next()).done);tt=!0){var rt=ot.value;v[rt].total&&(Be+="<i>"+rt+"<em>+"+v[rt].total.toLocaleString()+'</em><span class="pd_stat_extra">(<em title="平均值">+'+(v[rt].total/m).toFixed(2)+'</em>|<em title="最小值">+'+v[rt].min+'</em>|<em title="最大值">+'+v[rt].max+"</em>)</span></i> ")}}catch(e){nt=!0,at=e}finally{try{!tt&&it.return&&it.return()}finally{if(nt)throw at}}}var lt="",dt=!0,st=!1,ct=void 0;try{for(var ut,pt=jt.getSortedObjectKeyList(qt.boxTypeList,y)[Symbol.iterator]();!(dt=(ut=pt.next()).done);dt=!0){var ft=ut.value;lt&&(lt+="|"),lt+='<ins title="'+ft+'">-'+y[ft].toLocaleString()+"</ins>"}}catch(e){st=!0,ct=e}finally{try{!dt&&pt.return&&pt.return()}finally{if(st)throw ct}}if(Be+="<br><strong>盒子收获统计：</strong><i>盒子<ins>-"+b+"</ins>"+(lt?'<span class="pd_stat_extra">('+lt+")</span>":"")+"</i> ",0<k&&(Be+="<i>平均随机值<em>+"+jt.getFixedNumLocStr(x/k,2)+"</em></i> "),0<b){var mt=!0,gt=!1,ht=void 0;try{for(var vt,bt=jt.entries(_)[Symbol.iterator]();!(mt=(vt=bt.next()).done);mt=!0){var yt=Ot(vt.value,2),_t=yt[0];if((we=yt[1])&&("object"!==$.type(we)||!$.isEmptyObject(we)))if("object"===$.type(we)){var xt="item"===_t?qt.itemTypeList:qt.armTypeList,kt=!0,Ct=!1,wt=void 0;try{for(var It,$t=jt.getSortedObjectKeyList(xt,we)[Symbol.iterator]();!(kt=(It=$t.next()).done);kt=!0){Be+="<i>"+(De=It.value)+"<em>+"+we[De].toLocaleString()+"</em></i> "}}catch(e){Ct=!0,wt=e}finally{try{!kt&&$t.return&&$t.return()}finally{if(Ct)throw wt}}}else Be+="<i>"+_t+'<span class="pd_stat_extra"><em>+'+we.toLocaleString()+'</em>(<em title="平均值">+'+jt.getFixedNumLocStr(we/b,2).toLocaleString()+"</em>)</span></i> "}}catch(e){gt=!0,ht=e}finally{try{!mt&&bt.return&&bt.return()}finally{if(gt)throw ht}}}Be+="<br><strong>有效道具统计：</strong><i>有效道具<em>+"+C.toLocaleString()+"</em></i> ";var Lt=!0,St=!1,At=void 0;try{for(var Tt,Dt=jt.getSortedObjectKeyList(qt.itemTypeList,w)[Symbol.iterator]();!(Lt=(Tt=Dt.next()).done);Lt=!0){var Et=Tt.value;Be+="<i>"+Et+"<em>+"+w[Et].toLocaleString()+"</em></i> "}}catch(e){St=!0,At=e}finally{try{!Lt&&Dt.return&&Dt.return()}finally{if(St)throw At}}Be+="<br><strong>无效道具统计：</strong><i>无效道具<em>+"+I.toLocaleString()+"</em></i> ";var Mt=!0,Pt=!1,Bt=void 0;try{for(var Ft,Nt=jt.getSortedObjectKeyList(qt.itemTypeList,L)[Symbol.iterator]();!(Mt=(Ft=Nt.next()).done);Mt=!0){var Ut=Ft.value;Be+="<i>"+Ut+"<em>+"+L[Ut].toLocaleString()+"</em></i> "}}catch(e){Pt=!0,Bt=e}finally{try{!Mt&&Nt.return&&Nt.return()}finally{if(Pt)throw Bt}}return Be},v=function(){var e="pdImOrExLogDialog";if(!(0<$("#"+e).length)){var a=c.read(),o=d.create(e,"导入或导出日志",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label style="color: #f00;"><input type="radio" name="logType" value="setting" checked> 导入/导出日志</label>\n    <label style="color: #00f;"><input type="radio" name="logType" value="text"> 导出日志文本</label>\n  </div>\n  <div data-name="logSetting">\n    <strong>导入日志：</strong>将日志内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n    <strong>导出日志：</strong>复制文本框里的内容并粘贴到别处即可<br>\n    <textarea name="setting" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n  </div>\n  <div data-name="logText" style="display: none;">\n    <strong>导出日志文本</strong>：复制文本框里的内容并粘贴到别处即可\n    <div>\n      <label title="按时间顺序排序"><input type="radio" name="sortType2" value="time" checked> 按时间</label>\n      <label title="按日志类别排序"><input type="radio" name="sortType2" value="type"> 按类别</label>\n      <label title="在日志文本里显示每日以及全部数据的统计结果"><input type="checkbox" name="showStat" checked> 显示统计</label>\n    </div>\n    <textarea name="text" style="width: 600px; height: 400px;" readonly></textarea>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button">合并日志</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖日志</button>\n  <button data-action="close" type="button">关闭</button>\n</div>');o.find('[name="sortType2"], [name="showStat"]').click(function(){i(a,o),o.find('[name="text"]').select()}).end().find('[name="logType"]').click(function(){var e=$(this).val();o.find('[data-name="log'+("text"===e?"Setting":"Text")+'"]').hide(),o.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').show(),o.find('[data-name="log'+("text"===e?"Text":"Setting")+'"]').select()}).end().find('[name="merge"], [name="overwrite"]').click(function(e){e.preventDefault();var t=$(this).attr("name");if(confirm("是否将文本框中的日志"+("overwrite"===t?"覆盖":"合并")+"到本地日志？")){var n=$.trim(o.find('[name="setting"]').val());if(n){try{n=JSON.parse(n)}catch(e){return void alert("日志有错误")}n&&"object"===$.type(n)?(a="merge"===t?c.getMergeLog(a,n):n,c.write(a),alert("日志已导入"),location.reload()):alert("日志有错误")}}}),d.show(e),o.find('[name="sortType2"][value="'+Config.logSortType+'"]').prop("checked",!0).triggerHandler("click"),o.find('[name="setting"]').val(JSON.stringify(a)).select().focus(),p.runFunc("LogDialog.showImportOrExportLogDialog_after_")}},i=function(e,t){var n=t.find('input[name="sortType2"]:checked').val(),a=t.find('[name="showStat"]').prop("checked"),o="",i="",r=!0,l=!1,d=void 0;try{for(var s,c=Object.keys(e)[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;Array.isArray(e[u])&&(u<i&&(i=u),o+="【"+u+"】(共"+e[u].length+"项)\n"+("type"===n?"":"\n")+m(e,u,n).replace(/<h3>/g,"\n").replace(/<\/h3>/g,"\n").replace(/<\/p>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"").replace(/`/g,""),a&&(o+="-".repeat(46)+"\n合计：\n"+h(e,u,"current").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")+"\n"),o+="=".repeat(46)+"\n")}}catch(e){l=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw d}}o&&a&&(o+="\n总计：\n"+h(e,i,"all").replace(/<br\s*\/?>/g,"\n").replace(/(<.+?>|<\/.+?>)/g,"")),t.find('[name="text"]').val(o)}},{"./Config":4,"./Dialog":7,"./Item":10,"./Log":11,"./Read":19,"./Script":20,"./Util":23}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getPromoteHaloCostByTypeId=n.promoteHalo=n.getPromoteHaloInfo=n.setHaloInfo=n.getHaloInfo=n.addUserLinkInHaloPage=n.addUserLinkInPkListPage=n.getChangePointsCountDown=n.autoSaveLootLog=n.checkLoot=n.getLevelInfoList=n.getLevelInfo=n.getLogList=n.getLog=n.getLootInfo=n.updateLootInfo=n.lootAttack=n.recordPointsLog=n.changePointsAndArms=n.getRealProperty=n.getPointByProperty=n.getPropertyByPoint=n.getExtraPoint=n.getFieldNameByPointName=n.getPointNameByFieldName=n.getSkillAttack=n.getCurrentAssignedPoint=n.enhanceLootIndexPage=n.init=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},K=i(e("./Info")),z=o(e("./Util")),G=o(e("./Msg")),v=o(e("./Dialog")),V=i(e("./Const")),b=e("./Config"),Q=o(e("./Log")),J=o(e("./TmpLog")),X=o(e("./LootLog")),Y=o(e("./Script")),Z=o(e("./Public")),ee=o(e("./Item"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function x(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var k=void 0,C=void 0,w=void 0,I=void 0,s=void 0,L="",S=[],g=[],A={},h={},d={},T=new Map,D=new Map,E=new Map,M=0,y=[],P="",r=(n.init=function(){if(k=Z.getSafeId()){C=$(".kf_fw_ig3:first"),(w=$("#wdsx .kf_fw_ig1:first")).find("> tbody > tr:first-child > td").attr("id","pdArmArea"),I=w.find("#pdArmArea");var e=J.getValue(V.default.haloInfoTmpLogName);if(e&&"object"===$.type(e)){var t=$.now()-e.time;0<=t&&t<60*V.default.tmpHaloInfoExpires*1e3?(delete e.time,ke(e),r()):_e(!0)}else _e(!0)}},n.enhanceLootIndexPage=function(){Y.runFunc("Loot.enhanceLootIndexPage_before_");var e=C.html();A=B(e),E=ee.getItemsUsedNumInfo(e),D=ee.getArmsLevelInfo(e);var t=I.html();if(t.includes("（装备中）")){var n=t.split("<br><br>"),a=W(n,1)[0].split("（装备中）"),o=W(a,3),i=o[1],r=void 0===i?"":i,l=o[2],d=void 0===l?"":l;T.set("武器",ee.getArmInfo(r)),T.set("护甲",ee.getArmInfo(d)),$("#pk_text_div"),s=$("#pk_text"),L=s.html(),S=ue(L),g=fe(S),/你被击败了|今日战斗已完成|开始争夺战斗/.test(L)?localStorage.removeItem(V.default.tempPointsLogListStorageName+"_"+K.default.uid):y=be(S),c(),u(),p(),f(),Config.alwaysOpenPointAreaEnabled&&$("#wdsx").show(),/你被击败了|今日战斗已完成/.test(L)&&2!==parseInt(z.getCookie(V.default.lootCompleteCookieName))&&(z.setCookie(V.default.lootCompleteCookieName,2,ye()),z.deleteCookie(V.default.getDailyBonusCookieName)),$(document).dequeue("AutoAction"),Y.runFunc("Loot.enhanceLootIndexPage_after_")}else console.log("需要至少使用一件装备才能在此页面正常使用KFOL助手的功能")}),c=function(){C.attr("id","pdPropertiesArea").find('input[value$="可分配属性"]').after('<span id="pdSurplusPoint" class="pd_property_diff" hidden>(<em></em>)</span>');var e=C.find('> tbody > tr:first-child td:contains("错高峰福利") > span:last').attr("id","pdServerStatus");0<e.length&&(P=e.text().trim(),e.attr("id","pdServerStatus").data("prev-status",P)),C.on("change",".pd_arm_level",function(){var e=$(this).data("type"),t="Weapon";"护甲"===e?t="Armor":"项链"===e&&(t="Necklace"),$("#pd"+t+"ExpDiff em").text(D.get(e)["经验"]-2*Math.pow(D.get(e)["等级"]+1,2))}),C.find('input[value^="武器等级"]').addClass("pd_arm_level").attr("data-type","武器").after('<span id="pdWeaponExpDiff" class="pd_property_diff" title="下一级经验差值" style="color: #393;">(<em></em>)</span>').trigger("change"),C.find('input[value^="护甲等级"]').addClass("pd_arm_level").attr("data-type","护甲").after('<span id="pdArmorExpDiff" class="pd_property_diff" title="下一级经验差值" style="color: #393;">(<em></em>)</span>').trigger("change"),C.find('input[value^="项链等级"]').addClass("pd_arm_level").attr("data-type","项链").after('<span id="pdNecklaceExpDiff" class="pd_property_diff" title="下一级经验差值" style="color: #393;">(<em></em>)</span>').trigger("change"),$('<a data-name="copyParameterSetting" href="#" style="margin-left: -20px;" title="复制计算器的部分参数设置（包括神秘系数、光环和道具数量）">复</a>').insertAfter(C.find('input[value$="蕾米莉亚同人漫画"]')).click(function(e){e.preventDefault();var t=$(this),n=Math.floor((A["可分配属性点"]-50-(30===E.get("档案室钥匙")?30:0)-(10===E.get("消逝之药")?120:0))/5)+" "+Math.floor(1e3*d["全属性"])+"\n",a=!0,o=!1,i=void 0;try{for(var r,l=E.values()[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){n+=r.value+" "}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}t.data("copy-text",n.trim()),console.log("KFOL计算器的部分参数设置：\n"+n.trim()),z.copyText(t,"KFOL计算器的部分参数设置已复制")||alert("你的浏览器不支持复制，请打开Web控制台查看")})},u=function(){w.find('[type="text"]:not([readonly])').attr("type","number").attr("min",1).attr("max",9999).prop("required",!0).css("width","60px").addClass("pd_point").next("span").addClass("pd_extra_point").after('<span class="pd_sum_point" style="color: #f03; cursor: pointer;" title="点击：给该项加上或减去剩余属性点"></span>'),w.find("input[readonly]").attr("type","number").prop("disabled",!0).css("width","60px");var e=I.html().split("<br><br>",2),t=W(e,2),n=t[0],a=t[1],o=void 0===a?"":a,i=n.split("（装备中）"),r=W(i,3),l=r[1],d=void 0===l?"":l,s=r[2],c=void 0===s?"":s,u="";d&&(u+="（装备中）"+ee.handleUselessSubProperties(d)),c&&(u+="（装备中）"+ee.handleUselessSubProperties(c)),o&&(u+="<br><br>"+o),I.html(u),$('\n<tr>\n  <td>\n    装备ID和备注\n    <span class="pd_cfg_tips" title="可点击右边的“更换装备”按钮，也可手动填写装备ID。留空表示不更换装备。\n当文本框内的装备ID发生变化时，点击攻击按钮将会自动更换装备（点击“修改点数分配”按钮只会修改点数而不会更换装备）。">[?]</span>\n  </td>\n  <td>\n    <input class="pd_arm_input" name="weaponId" type="text" value="" maxlength="15" title="武器ID" placeholder="武器ID" style="width: 70px;">\n    <input class="pd_arm_input" name="weaponMemo" type="text" value="" maxlength="20" title="武器备注" placeholder="武器备注" style="width: 80px;">\n    <input class="pd_arm_input" name="armorId" type="text" value="" maxlength="15" title="护甲ID" placeholder="护甲ID" style="width: 70px;">\n    <input class="pd_arm_input" name="armorMemo" type="text" value="" maxlength="20" title="护甲备注" placeholder="护甲备注" style="width: 80px;">\n    <a class="pd_btn_link" data-name="changeArm" href="#" title="更换当前装备">更换装备</a>\n  </td>\n</tr>\n').insertAfter(I.parent()).find('[data-name="changeArm"]').click(function(e){e.preventDefault(),le(0)}),$('\n<tr hidden> \x3c!-- 临时 --\x3e\n  <td>\n    关键层列表\n    <span class="pd_cfg_tips" title="KFOL计算器的关键层列表（各关键层以空格分隔），用于“攻击到下一关键层前”按钮">[?]</span>\n  </td>\n  <td>\n    <input name="keyLevelList" type="text" value="'+Config.keyLevelList.join(" ")+'" maxlength="100" placeholder="关键层列表" style="width: 200px;">\n    <a class="pd_btn_link" data-name="saveKeyLevelList" href="#" title="保存关键层设置">保存</a>\n  </td>\n</tr>\n').insertBefore(w.find("> tbody > tr:last-child")).find('[data-name="saveKeyLevelList"]').click(function(e){e.preventDefault(),(0,b.read)();var t=$.trim(w.find('input[name="keyLevelList"]').val());Config.keyLevelList=t.split(" ").map(function(e){return parseInt(e)}).filter(function(e){return 0<e}),(0,b.write)(),alert("设置已保存")}),w.find('input[name="prosubmit"]').replaceWith('<button name="prosubmit" type="submit">修改点数分配</button>'),$('<button name="changePointsAndArms" type="button" title="按照当前页面上的点数设置和装备ID进行修改" style="margin-left: 3px;">修改点数和装备</button>').insertAfter(w.find('button[name="prosubmit"]')).click(function(){var t=G.wait("<strong>正在修改点数和装备&hellip;</strong>");te(-1,function(e){"success"===e?oe(function(){G.remove(t),G.show("<strong>已成功修改为指定的点数设置和装备ID</strong>",3)}):(G.remove(t),"ignore"===e?alert("当前页面的点数设置和装备ID没有发生变化"):"timeout"===e&&alert("连接超时，请重试"))})});var p=w.find("> tbody > tr:last-child > td:last-child");p.wrapInner('<span id="pdChangeCount"></span>');var f=/当前修改配点可用\[(\d+)]次/.exec(p.text());f&&(M=parseInt(f[1]));var m=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(p.text());if(m){var g=z.getDate("+"+m[1]+"m");z.setCookie(V.default.changePointsInfoCookieName,g.getTime(),g)}else{parseInt(z.getCookie(V.default.changePointsInfoCookieName))!==M&&z.setCookie(V.default.changePointsInfoCookieName,M+"c",z.getDate("+"+V.default.changePointsInfoExpires+"m"))}h={"耐力":parseInt(w.find('[name="p"]').next("span").text()),"幸运":parseInt(w.find('[name="l"]').next("span").text())};w.on("change",".pd_point",function(){var e=$(this);!function(){var e=A["可分配属性点"]-F(w.find(".pd_point"));$("#pdSurplusPoint").prop("hidden",0==e).css("color",0!=e?0<e?"#f03":"#393":"#000").find("em").text((0<e?"+":"")+e)}(),function(e){var t=parseInt(e.val());(!t||t<0)&&(t=1);var n=O(N(e.attr("name")),t);e.next(".pd_extra_point").text("+"+n)}(e),function(e){var t=parseInt(e.val());(!t||t<0)&&(t=1);var n=parseInt(e.next(".pd_extra_point").text());e.next(".pd_extra_point").next(".pd_sum_point").text("="+(t+n))}(e)}).on("click",".pd_sum_point",function(){var e=A["可分配属性点"]-F(w.find(".pd_point"));if(e){var t=$(this).prev("span").prev(".pd_point");if(t.length){var n=parseInt(t.val());(isNaN(n)||n<0)&&(n=0),n+=e,t.val(n<1?1:n).trigger("change")}}}).closest("form").submit(function(){return z.deleteCookie(V.default.changePointsInfoCookieName),_(w)}).find(".pd_point").trigger("change")},_=function(e){var t=A["可分配属性点"]-F(e.find(".pd_point"));return t<0?(alert("剩余属性点为负，请重新填写"),!1):!(0<t&&!confirm("可分配属性点尚未用完，是否继续？"))},B=function(e){var t={"攻击力":0,"生命值":0,"最大生命值":0,"攻击速度":0,"暴击几率":0,"技能伤害":0,"技能释放概率":0,"防御":0,"可分配属性点":0},n=/"(\d+)攻击力"/.exec(e);return n&&(t["攻击力"]=parseInt(n[1])),(n=/"(\d+)\/(\d+)生命值"/.exec(e))&&(t["生命值"]=parseInt(n[1]),t["最大生命值"]=parseInt(n[2])),(n=/"(\d+)攻击速度"/.exec(e))&&(t["攻击速度"]=parseInt(n[1])),(n=/"(\d+(?:\.\d+)?)%减伤"/.exec(e))&&(t["防御"]=parseFloat(n[1])),(n=/"(\d+)\s*可分配属性"/.exec(e))&&(t["可分配属性点"]=parseInt(n[1])),t},F=n.getCurrentAssignedPoint=function(e){var n=0;return e.each(function(){var e=$(this),t=(e.attr("name"),parseInt(e.val()));t&&0<t&&(n+=t)}),n},m=n.getSkillAttack=function(e,t,n){return 5*e+5*t+5*n},N=n.getPointNameByFieldName=function(e){switch(e){case"s1":return"力量";case"s2":return"体质";case"d1":return"敏捷";case"d2":return"灵活";case"i1":return"智力";case"i2":return"意志";case"p":return"耐力";case"l":return"幸运";case"weaponId":return"武器ID";case"weaponMemo":return"武器备注";case"armorId":return"护甲ID";case"armorMemo":return"护甲备注";default:return""}},U=n.getFieldNameByPointName=function(e){switch(e){case"力量":return"s1";case"体质":return"s2";case"敏捷":return"d1";case"灵活":return"d2";case"智力":return"i1";case"意志":return"i2";case"耐力":return"p";case"幸运":return"l";case"武器ID":return"weaponId";case"武器备注":return"weaponMemo";case"护甲ID":return"armorId";case"护甲备注":return"armorMemo";default:return""}},O=n.getExtraPoint=function(e,t){var n=5*E.get("消逝之药"),a=d["全属性"];switch(e){case"力量":case"体质":return Math.floor(t*a)+E.get("蕾米莉亚同人漫画")+n;case"敏捷":case"灵活":return Math.floor(t*a)+E.get("十六夜同人漫画")+n;case"智力":return Math.floor(t*a)+n;case"意志":return Math.floor((Math.floor(t*a)+n+t)*("铠甲"===T.get("护甲")["组别"]?1.1:1))-t;default:return 0}},j=n.getPropertyByPoint=function(e,t){var n=t+O(e,t);switch(e){case"力量":return 5*n+d["攻击力"];case"体质":return 20*n+(50===E.get("蕾米莉亚同人漫画")?700:0)+d["生命值"];case"敏捷":return 2*n+(50===E.get("十六夜同人漫画")?100:0);case"灵活":return Math.round(n/(n+100)*100);case"智力":return Math.round(n/(n+90)*100);case"意志":return Math.round(n/(n+150)*100);default:return 0}},q=n.getPointByProperty=function(e,t){var n=5*E.get("消逝之药"),a=1+d["全属性"],o=0;switch(e){case"力量":o=Math.ceil((Math.ceil((t-d["攻击力"])/5)-E.get("蕾米莉亚同人漫画")-n)/a);break;case"体质":o=Math.ceil((Math.ceil((t-d["生命值"]-(50===E.get("蕾米莉亚同人漫画")?700:0))/20)-E.get("蕾米莉亚同人漫画")-n)/a);break;case"敏捷":o=Math.ceil((Math.ceil((t-(50===E.get("十六夜同人漫画")?100:0))/2)-E.get("十六夜同人漫画")-n)/a);break;case"灵活":o=Math.floor((Math.round(100*t/(100-t))-E.get("十六夜同人漫画")-n)/a);break;case"智力":o=Math.floor((Math.round(90*t/(100-t))-n)/a);break;case"意志":o=Math.floor((Math.round(150*t/(100-t))-n)/a)}return(!isFinite(o)||o<1)&&(o=1),o},p=(n.getRealProperty=function(e,t,n,a){var o="灵活"===e?100:90,i=Math.round(2*n*{"普通":1,"强壮":1,"快速":1.5,"睿智":1,"坚强":1,BOSS:1.2}[a]),r=Math.max(t-Math.round((i+t)/3),0);return Math.round(r/(r+o)*100)},function(){$('\n<tr>\n  <td colspan="2">\n    <select id="pdLevelPointListSelect" style="margin: 5px 0;">\n      <option>点数分配方案</option>\n      <option value="0">默认</option>\n    </select>\n    <a class="pd_btn_link" data-name="save" href="#" title="将当前点数设置保存为新的方案">保存</a>\n    <a class="pd_btn_link" data-name="edit" href="#" title="编辑各层点数分配方案">编辑</a>\n    <a class="pd_btn_link" data-name="fill" href="#" title="输入一串数字按顺序填充到各个点数字段中">填充</a>\n  </td>\n</tr>').prependTo(w.find("> tbody")).find("#pdLevelPointListSelect").change(function(){var e=parseInt($(this).val());if(0<e){var n=Config.levelPointList[parseInt(e)];if("object"!==(void 0===n?"undefined":a(n)))return;w.find(".pd_point, .pd_arm_input").each(function(){var e=$(this),t=N(e.attr("name"));e.val(n[t])}).trigger("change")}else 0===e&&w.find(".pd_point, .pd_arm_input").each(function(){$(this).val(this.defaultValue)}).trigger("change")}).end().find('[data-name="save"]').click(function(e){if(e.preventDefault(),_(w)){var t=$("#pdLevelPointListSelect"),n=parseInt(t.val());if((n=parseInt(prompt("请输入层数：",n||"")))&&!(n<0)&&((0,b.read)(),!(n in Config.levelPointList)||confirm("该层数已存在，是否覆盖？"))){var a={},o=!0,i=!1,r=void 0;try{for(var l,d=Array.from(w.find(".pd_point, .pd_arm_input"))[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value,c=$(s),u=c.attr("name"),p=$.trim(c.val());if(c.is(".pd_point")){if(!(p=parseInt(p))||p<0)return}else{if(!p)continue;if(("weaponId"===u||"armorId"===u)&&(!(p=parseInt(p))||p<0))return}a[N(u)]=p}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}Config.levelPointList[n]=a,(0,b.write)(),H(Config.levelPointList),t.val(n)}}}).end().find('[data-name="edit"]').click(function(e){e.preventDefault(),l()}).end().find('[data-name="fill"]').click(function(e){e.preventDefault(),R(w)}),H(Config.levelPointList)}),R=function(e){var t=$.trim(prompt("请输入以任意字符分隔的一串数字，按顺序填充到各个点数字段中（注：5位数以上的数字将被当作装备ID）：\n可直接输入计算器输出的点数设置，例：1 100 50 5 25 1  0 3 Bow #1234567 Cloth #7654321"));if(t){var n=/^\s*(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+\s+\d+\s+(\S+)\s+#(\d+)\s+(\S+)\s+#(\d+)/.exec(t);if(n=n||/^\s*(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+\s+(\S+)\s+#(\d+)/.exec(t))e.find(".pd_point").each(function(e){e+1<n.length&&$(this).val(n[e+1]).trigger("change")}),e.find('input[name="weaponMemo"]').val(n[7]),e.find('input[name="weaponId"]').val(n[8]),n[9]&&n[10]&&(e.find('input[name="armorMemo"]').val(n[9]),e.find('input[name="armorId"]').val(n[10]));else{var a=t.match(/\b\d{1,4}\b/g);if(!a)return;e.find(".pd_point").each(function(e){if(!(e<a.length))return!1;$(this).val(parseInt(a[e])).trigger("change")});var o=t.match(/\b(\d{5,})\b/g);for(var i in o){var r=0===parseInt(i)?"weaponId":"armorId";e.find('input[name="'+r+'"]').val(o[i])}}}},H=function(e){var t="",n=!0,a=!1,o=void 0;try{for(var i,r=z.entries(e)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=W(i.value,2),d=l[0],s=l[1];$.isNumeric(d)&&(t+='<option value="'+d+'">第'+d+"层 "+(s["武器ID"]||s["护甲ID"]?"(装)":"")+"</option>")}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}$("#pdLevelPointListSelect").find("option:gt(1)").remove().end().append(t)},f=function(){$('\n<div id="pdAttackBtns" class="pd_result" style="margin-top: 5px;" hidden> \x3c!-- 临时 --\x3e\n  <label>\n    <input class="pd_input" name="autoChangeLevelPointsEnabled" type="checkbox" '+(Config.autoChangeLevelPointsEnabled?"checked":"")+'>\n    自动修改点数分配方案\n    <span class="pd_cfg_tips" title="在攻击时可自动修改为相应层数的点数分配方案（仅限自动攻击相关按钮有效）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="customPointsScriptEnabled" type="checkbox" '+(Config.customPointsScriptEnabled?"checked":"")+" \n"+("function"!=typeof V.default.getCustomPoints?"disabled":"")+'> 使用自定义脚本\n    <span class="pd_cfg_tips" title="使用自定义点数分配脚本（仅限自动攻击相关按钮有效，需正确安装自定义脚本后此项才可勾选）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="unusedPointNumAlertEnabled" type="checkbox" '+(Config.unusedPointNumAlertEnabled?"checked":"")+'>\n    有剩余属性点时提醒\n    <span class="pd_cfg_tips" title="在攻击时如有剩余属性点则进行提醒（仅限自动攻击相关按钮有效，挂机玩家请勿勾选）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="slowAttackEnabled" type="checkbox" '+(Config.slowAttackEnabled?"checked":"")+'> 慢速\n    <span class="pd_cfg_tips" title="延长每次攻击的时间间隔（在4~7秒之间）">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="alwaysOpenPointAreaEnabled" type="checkbox" '+(Config.alwaysOpenPointAreaEnabled?"checked":"")+'> 总是打开属性界面\n    <span class="pd_cfg_tips" title="总是打开个人属性/装备界面">[?]</span>\n  </label>\n  <label>\n    <input class="pd_input" name="alertServerStatusChangeEnabled" type="checkbox" '+(Config.alertServerStatusChangeEnabled?"checked":"")+'> 服务器状态变化提醒\n    <span class="pd_cfg_tips" title="在服务器状态发生变化时进行提醒（在状态变为“繁忙”、或由“空闲”变为“正常”状态时进行提醒，挂机玩家请勿勾选），可点击右侧的详情按钮进行更具体的设置">[?]</span>\n  </label>\n  <a class="pd_btn_link" data-name="setAlertServerStatusChangeType" href="#">详&raquo;</a><br>\n  <button name="autoAttack" type="button" title="自动攻击到指定层数">自动攻击</button>\n  <button name="onceAttack" type="button" title="自动攻击一层">一层</button>\n  <button name="nextKeyLevelAttack" type="button" title="攻击到下一关键层之前">到下一关键层前</button>\n  <span style="color: #888;">|</span>\n  <button name="manualAttack" type="button" title="手动攻击一层，会按照当前页面上发生变化了的点数设置和装备ID自动修改点数以及更换装备">手动攻击</button>\n  <span class="pd_cfg_tips" title="在不勾选“自动修改点数分配方案”或“使用自定义脚本”的情况下，点击所有的攻击按钮均会按照当前页面上的点数设置和装备ID自动修改点数以及更换装备。\n（注：只有在当前页面上点数设置或装备ID发生变化的情况下才会自动提交相应设置）。\n在勾选上述两种选项的情况下，点击自动攻击相关按钮会自动按照预设的点数分配方案或脚本返回的值修改点数及更换装备。而手动攻击按钮则无视这俩选项，依然按照前一种情况进行操作。">[?]</span>\n</div>\n').insertAfter("#wdsx").on("click",'button[name$="Attack"]',function(){if(/你被击败了|今日战斗已完成/.test(L))alert("你已经被击败了");else if(!(0<$(".pd_mask").length)){var e=$(this),t=e.attr("name"),n=0,a="manualAttack"===t?"manual":"auto";if("nextKeyLevelAttack"===t){var o=$.trim(w.find('input[name="keyLevelList"]').val()).split(" ").map(function(e){return parseInt(e)}).filter(function(e){return 0<e});if(!o.length)return void alert("没有设置关键层");var i=ve(S);n=Math.min.apply(Math,x(o.filter(function(e){return i+1<e})))-1}else if("auto"==a){var r="+1";if("autoAttack"===t){var l=e.data("prevTargetLevel");r=$.trim(prompt("攻击到第几层？（0表示攻击到被击败为止，+n表示攻击到当前层数+n层）",l||Config.attackTargetLevel))}if(!/\+?\d+/.test(r))return;if(r.startsWith("+"))n=ve(S)+parseInt(r);else n=parseInt(r);if(isNaN(n)||n<0)return;"autoAttack"===t&&e.data("prevTargetLevel",r)}G.destroy(),$("#pdLootLogHeader").find('[data-name="end"]').click();var d=(Config.autoChangeLevelPointsEnabled||Config.customPointsScriptEnabled&&"function"==typeof V.default.getCustomPoints)&&"auto"==a;if(d||_(w)){var s=C.find("#pdServerStatus"),c=s.data("no-alert"),u=s.data("prev-status");if(Config.alertServerStatusChangeEnabled&&!c&&u){if(("空闲"===u||"正常"===u)&&"繁忙"===P||"空闲"===u&&"正常"===P&&1!==Config.alertServerStatusChangeType){if(!confirm("当前服务器状态由["+u+"]变为["+P+"]，是否继续攻击？"))return;s.data("no-alert",!0)}s.data("prev-status",P)}ae({type:a,targetLevel:n,autoChangePointsEnabled:d,safeId:k})}}}).on("click",".pd_cfg_tips",function(){return!1}).on("click",'input[type="checkbox"]',function(){var e=$(this),t=e.attr("name"),n=e.prop("checked");t in Config&&Config[t]!==n&&((0,b.read)(),Config[t]=n,(0,b.write)())}).find('[data-name="setAlertServerStatusChangeType"]').click(function(e){e.preventDefault(),(0,b.read)();var t=parseInt(prompt("请输入提醒时机类型（0：总是提醒；1：仅当变为“繁忙”时提醒）：",Config.alertServerStatusChangeType));isNaN(t)||(Config.alertServerStatusChangeType=1===t?1:0,(0,b.write)())}).end().find('[name="customPointsScriptEnabled"]').click(function(){var e=$(this);e.prop("disabled")||$('[name="autoChangeLevelPointsEnabled"]').prop("disabled",e.prop("checked"))}).triggerHandler("click");var e=$(".kf_fw_ig1:eq(1) > tbody > tr:first-child > td");e.html(e.html().replace("（不再点击战斗记录开始）","（不再点击战斗记录开始）（↑ ↑ ↑ 助手的攻击按钮在上方）"))},te=n.changePointsAndArms=function(t,n){if(0<t&&Config.customPointsScriptEnabled&&"function"==typeof V.default.getCustomPoints){var e=null;try{e=V.default.getCustomPoints($.extend(ie(),{getExtraPoint:O,getPointByProperty:q,getPropertyByPoint:j}))}catch(e){console.log(e)}if("object"===$.type(e)){var a=!0,o=!1,i=void 0;try{for(var r,l=z.entries(e)[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var d=W(r.value,2),s=d[0],c=d[1];w.find('input[name="'+U(s)+'"]').val(c).trigger("change")}}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}t=-1}else{if("number"!=typeof e)return n(!1===e?"ignore":"error");t=1<(t=parseInt(e))?t:1}}var u=ve(S)+1,p=0<t?Math.max.apply(Math,x(Object.keys(Config.levelPointList).filter(function(e){return e<=t}))):-1,f=$("#pdLevelPointListSelect");0<p?f.val(p).trigger("change"):f.get(0).selectedIndex=0;var m=!1,g=!1,h=!1;if(w.find('.pd_point, input[name="weaponId"], input[name="armorId"]').each(function(){var e=$(this),t=e.attr("name"),n=$.trim(e.val());0<parseInt(n)&&this.defaultValue!==n&&("weaponId"===t?m=!0:"armorId"===t?g=!0:h=!0)}),m||g||h){if(Config.unusedPointNumAlertEnabled&&!K.default.w.unusedPointNumAlert&&0<parseInt($("#pdSurplusPoint > em").text())){if(!confirm("可分配属性点尚未用完，是否继续？"))return n("error");K.default.w.unusedPointNumAlert=!0}var v=parseInt(w.find('input[name="weaponId"]').val()),b=parseInt(w.find('input[name="armorId"]').val()),y=["ignore","ignore","ignore"];m&&(y[0]={type:"POST",url:"kf_fw_ig_mybpdt.php",timeout:V.default.defAjaxTimeout,data:"do=4&id="+v+"&safeid="+k}),g&&(y[1]={type:"POST",url:"kf_fw_ig_mybpdt.php",timeout:V.default.defAjaxTimeout,data:"do=4&id="+b+"&safeid="+k}),h&&(y[2]={type:"POST",url:"kf_fw_ig_enter.php",timeout:V.default.defAjaxTimeout,data:w.closest("form").serialize()});var _="success";$(document).clearQueue("ChangePointsAndArms"),$.each(y,function(d,e){"ignore"!==e&&$(document).queue("ChangePointsAndArms",function(){$.ajax(e).done(function(e){if(0===d){var t=z.removeHtmlTag(e);if(/装备完毕/.test(t)){if(w.find('input[name="weaponId"], input[name="weaponMemo"]').each(function(){this.defaultValue=$(this).val()}),Config.autoSaveArmsInfoEnabled){var n=ee.readArmsInfo();n["已装备武器"]=v,ee.writeArmsInfo(n)}}else G.show("<strong>更换武器："+t+"</strong>",-1),Y.runFunc("Loot.lootAttack_changePointsAndArms_error_",t),_="error"}else if(1===d){var a=z.removeHtmlTag(e);if(/装备完毕/.test(a)){if(w.find('input[name="armorId"], input[name="armorMemo"]').each(function(){this.defaultValue=$(this).val()}),Config.autoSaveArmsInfoEnabled){var o=ee.readArmsInfo();o["已装备护甲"]=b,ee.writeArmsInfo(o)}}else G.show("<strong>更换护甲："+a+"</strong>",-1),Y.runFunc("Loot.lootAttack_changePointsAndArms_error_",a),_="error"}else if(2===d){var i=z.getResponseMsg(e).msg;if(/已经重新配置加点！/.test(i))z.deleteCookie(V.default.changePointsInfoCookieName),w.find(".pd_point").each(function(){this.defaultValue=$(this).val()});else{var r=/你还需要等待(\d+)分钟/.exec(i);if(r){var l=z.getDate("+"+parseInt(r[1])+"m");z.setCookie(V.default.changePointsInfoCookieName,l.getTime(),l)}G.show("<strong>第<em>"+u+"</em>层方案："+i+"</strong>",-1),Y.runFunc("Loot.lootAttack_changePointsAndArms_error_",i),_="error"}}}).fail(function(){_="timeout"}).always(function(){"error"===_||"timeout"===_?($(document).clearQueue("ChangePointsAndArms"),n(_)):$(document).queue("ChangePointsAndArms").length?setTimeout(function(){return $(document).dequeue("ChangePointsAndArms")},V.default.minActionInterval):(ne(!0),Y.runFunc("Loot.changePointsAndArms_success_"),n(_))})})}),$(document).dequeue("ChangePointsAndArms")}else 1===u&&ne(),n("ignore")},ne=n.recordPointsLog=function(e){var t=0<arguments.length&&void 0!==e&&e;A=B(C.html());var n="",o="",a="",i=parseInt(w.find('input[name="weaponId"]').val()),r=$.trim(w.find('input[name="weaponMemo"]').val());0<i&&(n+="武器ID："+i+(r?"，武器备注："+r:""));var l=parseInt(w.find('input[name="armorId"]').val()),d=$.trim(w.find('input[name="armorMemo"]').val());0<l&&(n+=(n?"；":"")+"护甲ID："+l+(d?"，护甲备注："+d:"")),w.find(".pd_point").each(function(){var e=$(this),t=N(e.attr("name")),n=parseInt(e.val()),a=O(t,n);o+=t+"："+n+"+"+a+"="+(n+a)+"，"}),o=o.replace(/，$/,"");var s=!0,c=!1,u=void 0;try{for(var p,f=z.entries(A)[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=W(p.value,2),g=m[0],h=m[1];if("可分配属性点"!==g&&"生命值"!==g){var v="";!g.endsWith("率")&&"防御"!==g||(v="%"),a+=g+"："+h+v+"，"}}}catch(e){c=!0,u=e}finally{try{!s&&f.return&&f.return()}finally{if(c)throw u}}a=a.replace(/，$/,""),y[ve(S)+1]=(n?"装备信息（"+n+"）\n":"")+"点数方案（"+o+"）",localStorage.setItem(V.default.tempPointsLogListStorageName+"_"+K.default.uid,JSON.stringify({time:$.now(),pointsLogList:y})),t&&(n&&console.log("【更换武器】装备信息（"+n+"）"),console.log("【分配点数】点数方案（"+o+"）"))},ae=n.lootAttack=function(e){var o=e.type,i=e.targetLevel,r=e.autoChangePointsEnabled,t=e.safeId,n=ve(S);if(!(0<i&&i<=n)){var l=G.wait('<strong>正在攻击中，请稍等&hellip;</strong><i>当前层数：<em class="pd_countdown">'+n+'</em></i><a class="pd_stop_action pd_highlight" href="#">停止操作</a><a href="/" target="_blank">浏览其它页面</a>'),d=0,s=!1,c=!1,u=!1,p=function t(n,e){var a=1<arguments.length&&void 0!==e?e:V.default.lootAttackInterval;te(0<=n?n+1:-1,function(e){"ignore"===e?setTimeout(f,"function"==typeof a?a():a):"timeout"===e?setTimeout(function(){return t(n,a)},V.default.minActionInterval):"success"===e&&setTimeout(function(){oe(function(){setTimeout(f,"function"==typeof a?a():a)})},V.default.minActionInterval),"error"===e&&G.remove(l)})},f=function(){$.ajax({type:"POST",url:"kf_fw_ig_intel.php",data:{safeid:t},timeout:V.default.defAjaxTimeout}).done(function(e){d++,Config.autoLootEnabled&&z.setCookie(V.default.lootAttackingCookieName,1,z.getDate("+"+V.default.lootAttackingExpires+"m")),V.default.debug&&console.log(e);var t=z.getResponseMsg(e).type;if(/请稍后重试/.test(e)||-1===t)return c=!0,void m();var n="function"==typeof V.default.lootAttackPerCheckLevel?V.default.lootAttackPerCheckLevel():V.default.lootAttackPerCheckLevel;if(!/你\(\d+\)遭遇了/.test(e)||d%n==0)return"no"===e&&/你被击败了|今日战斗已完成/.test(L)&&(u=!0),void setTimeout(function(){oe(function(){/你被击败了|今日战斗已完成/.test(L)||(u=!1),m()})},V.default.minActionInterval);L=e+L;var a=C.find("#pdServerStatus"),o=a.data("no-alert"),i=a.data("prev-status");Config.alertServerStatusChangeEnabled&&!o&&i&&((("空闲"===i||"正常"===i)&&"繁忙"===P||"空闲"===i&&"正常"===P&&1!==Config.alertServerStatusChangeType)&&(confirm("当前服务器状态由["+i+"]变为["+P+"]，是否继续攻击？")?a.data("no-alert",!0):c=!0),a.data("prev-status",P)),m(!1),Y.runFunc("Loot.lootAttack_attack_after_",e)}).fail(function(){console.log("【争夺攻击】超时重试..."),setTimeout(function(){return oe(m)},"function"==typeof V.default.lootAttackInterval?V.default.lootAttackInterval():V.default.lootAttackInterval)})},m=function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];S=ue(L),g=fe(S),ce(S,g,y),se(g);var n=ve(S);console.log("【争夺攻击】当前层数："+n);var a=$(".pd_countdown:last");if(a.text(n),s=u||s||c||"auto"!==o||i&&i<=n||a.closest(".pd_msg").data("stop"))if(Config.autoLootEnabled&&(z.deleteCookie(V.default.lootCheckingCookieName),z.deleteCookie(V.default.lootAttackingCookieName),c?z.setCookie(V.default.lootCompleteCookieName,-2,z.getDate("+"+V.default.checkLootInterval+"m")):z.setCookie(V.default.lootCompleteCookieName,1,ye())),u)t?(G.remove(l),re(S,g,y),w.find('button[name="changePointsAndArms"]').css("display","inline-block")):setTimeout(function(){return oe(e)},V.default.minActionInterval),Y.runFunc("Loot.lootAttack_complete_");else{if(/你被击败了|今日战斗已完成/.test(L))return void setTimeout(function(){oe(function(){/你被击败了|今日战斗已完成/.test(L)&&(u=!0),e()})},V.default.defAjaxInterval);t||setTimeout(oe,V.default.minActionInterval),G.remove(l),G.show("<strong>你成功击败了第<em>"+n+"</em>层的NPC</strong>",-1),Y.runFunc("Loot.lootAttack_after_")}else r&&!/你被击败了|今日战斗已完成/.test(L)?setTimeout(function(){return p(n)},V.default.minActionInterval):setTimeout(f,"function"==typeof V.default.lootAttackInterval?V.default.lootAttackInterval():V.default.lootAttackInterval)};p(r?n:-1,0)}},oe=n.updateLootInfo=function e(t){var x=0<arguments.length&&void 0!==t?t:null;console.log("更新争夺信息Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:V.default.defAjaxTimeout}).done(function(e){var t=$("#wdsx",e).parent();if(L=t.find("#pk_text").html()){t.find('.kf_fw_ig3:first input[type="text"]').each(function(e){var t=$.trim($(this).val());t&&C.find('input[type="text"]:eq('+e+")").val(t)});var n=/错高峰福利：当前服务器状态\[\s*<span style="color:(#[a-fA-F0-9]+);[^<>]+>(\S+?)<\/span>\s*\]/.exec(e);if(n){var a=n[1];P=n[2],V.default.debug&&console.log("当前服务器状态："+P),C.find("#pdServerStatus").text(P).css("color",a)}var o=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(o){M=0;var i=z.getDate("+"+o[1]+"m");z.setCookie(V.default.changePointsInfoCookieName,i.getTime(),i),w.find("#pdChangeCount").text("(下次修改配点还需["+o[1]+"]分钟)")}var r=/当前修改配点可用\[(\d+)]次/.exec(e);r&&(M=parseInt(r[1]),z.setCookie(V.default.changePointsInfoCookieName,M+"c",z.getDate("+"+V.default.changePointsInfoExpires+"m")),w.find("#pdChangeCount").text("(当前修改配点可用["+M+"]次)"));var l=t.find(".kf_fw_ig1:first > tbody > tr:first-child > td").html();if(l.includes("（装备中）")){var d=l.split("<br><br>",2),s=W(d,2),c=s[0],u=s[1],p=void 0===u?"":u,f=c.split("（装备中）"),m=W(f,3),g=m[1],h=void 0===g?"":g,v=m[2],b=void 0===v?"":v,y="";h&&(y+="（装备中）"+ee.handleUselessSubProperties(h)),b&&(y+="（装备中）"+ee.handleUselessSubProperties(b)),p&&(y+="<br><br>"+p),I.html(y),T.set("武器",ee.getArmInfo(h)),T.set("护甲",ee.getArmInfo(b))}var _=C.html();A=B(_),E=ee.getItemsUsedNumInfo(_),D=ee.getArmsLevelInfo(_),C.find(".pd_arm_level").trigger("change"),w.find(".pd_point").trigger("change"),"function"==typeof x&&x(),Y.runFunc("Loot.updateLootInfo_after_",e)}else G.remove($(".pd_countdown").closest(".pd_msg"))}).fail(function(){setTimeout(function(){return e(x)},V.default.minActionInterval)})},ie=n.getLootInfo=function(){var e=ve(S),t=g[e],n=0,a=0;t&&(n=t.life,a=t.initLife);var o=he(g);return{currentLevel:e,currentLife:n,currentInitLife:a,levelPointList:Config.levelPointList,availablePoint:A["可分配属性点"],haloInfo:d,extraPointsList:h,propertyList:A,itemUsedNumList:E,armsLevelList:D,currentArmInfo:T,changePointsAvailableCount:M,log:L,logList:S,enemyList:o}},re=function(n,e,t){z.setCookie(V.default.lootCompleteCookieName,2,ye()),localStorage.removeItem(V.default.tempPointsLogListStorageName+"_"+K.default.uid);var a={},o=!0,i=!1,r=void 0;try{for(var l,d=z.entries(ge(e))[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=W(l.value,2),c=s[0],u=s[1];a[c]=u}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}var p="",f=!0,m=!1,g=void 0;try{for(var h,v=z.entries(a)[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var b=W(h.value,2);p+=(c=b[0])+"`+"+(u=b[1])+"` "}}catch(e){m=!0,g=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw g}}var y={},_=!0,x=!1,k=void 0;try{for(var C,w=z.entries(ge(e.filter(function(e,t){return t>=n.length-V.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(_=(C=w.next()).done);_=!0){var I=W(C.value,2);c=I[0],u=I[1];y[c]=u}}catch(e){x=!0,k=e}finally{try{!_&&w.return&&w.return()}finally{if(x)throw k}}var L=!0,S=!1,A=void 0;try{for(var T,D=z.entries(y)[Symbol.iterator]();!(L=(T=D.next()).done);L=!0){var E=W(T.value,2);(c=E[0])+"`+"+(u=E[1])+"` "}}catch(e){S=!0,A=e}finally{try{!L&&D.return&&D.return()}finally{if(S)throw A}}var M=ve(n),P=me(e),B=P.boxNum,F=P.boxes;$.isEmptyObject(F)||(Q.push("争夺攻击","你成功击败了第`"+(M-1)+"`层的NPC ("+p.trim()+")",{gain:{"盒子":B,box:F}}),X.record(n,t));var N="",U=!0,O=!1,j=void 0;try{for(var q,R=z.getSortedObjectKeyList(ee.boxTypeList,F)[Symbol.iterator]();!(U=(q=R.next()).done);U=!0){var H=q.value;N+="<i>"+H+"<em>+"+F[H].toLocaleString()+"</em></i>"}}catch(e){O=!0,j=e}finally{try{!U&&R.return&&R.return()}finally{if(O)throw j}}G.show("<strong>你被第<em>"+M+"</em>层的NPC击败了</strong>"+(75<N.length?"<br>":"")+N,Config.autoSaveLootLogInSpecialCaseEnabled?Config.defShowMsgDuration:-1),Config.autoGetDailyBonusEnabled&&Config.getBonusAfterLootCompleteEnabled&&(z.deleteCookie(V.default.getDailyBonusCookieName),$(document).queue("AutoAction",function(){return Z.getDailyBonus()})),Config.autoOpenBoxesAfterLootEnabled&&(J.setValue(V.default.autoOpenBoxesAfterLootTmpLogName,!0),$(document).clearQueue("AutoAction"),$(document).queue("AutoAction",function(){setTimeout(function(){return location.href="kf_fw_ig_mybp.php?openboxes=true"},V.default.minActionInterval)})),setTimeout(function(){return $(document).dequeue("AutoAction")},V.default.minActionInterval),Y.runFunc("Loot.recordLootLog_after_")},l=function t(e){var n="pdLevelPointListConfigDialog";if(!(0<$("#"+n).length)){(0,b.read)();var a=v.create(n,"各层点数分配方案",'\n<div class="pd_cfg_main">\n  <div style="margin: 5px 0; line-height: 1.6em;">\n    请填写各层对应的点数分配方案，相邻层数如数值完全相同的话，则只保留最前面的一层<br>\n    （例：11-19层点数相同的话，则只保留第11层）<br>\n    武器、护甲ID和备注为可选项，只在需要更换装备时填写<br>\n    自定义点数分配方案脚本的参考范例请参见<a href="read.php?tid=500968&spid=13270735" target="_blank">此贴53楼</a>\n  </div>\n  <div style="overflow-y: auto; max-height: 400px;">\n    <table id="pdLevelPointList" style="text-align: center; white-space: nowrap;">\n      <tbody>\n        <tr>\n          <th></th><th>层数</th><th>力量</th><th>体质</th><th>敏捷</th><th>灵活</th><th>智力</th><th>意志</th>\n<th>武器ID</th><th>武器备注</th><th>护甲ID</th><th>护甲备注</th><th></th>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n  <hr>\n  <div style="float: left; line-height: 27px;">\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n    <a class="pd_btn_link pd_highlight" data-name="add" href="#">增加</a>\n    <a class="pd_btn_link" data-name="deleteSelect" href="#">删除</a>\n  </div>\n  <div data-id="modifyArea" style="float: right;">\n    <input name="s1" type="text" maxlength="5" title="力量" placeholder="力量" style="width: 35px;">\n    <input name="s2" type="text" maxlength="5" title="体质" placeholder="体质" style="width: 35px;">\n    <input name="d1" type="text" maxlength="5" title="敏捷" placeholder="敏捷" style="width: 35px;">\n    <input name="d2" type="text" maxlength="5" title="灵活" placeholder="灵活" style="width: 35px;">\n    <input name="i1" type="text" maxlength="5" title="智力" placeholder="智力" style="width: 35px;">\n    <input name="i2" type="text" maxlength="5" title="意志" placeholder="意志" style="width: 35px;">\n    <a class="pd_btn_link" data-name="clear" href="#" title="清空各修改字段">清空</a>\n    <button type="button" name="modify">修改</button>\n    <span class="pd_cfg_tips" title="可将所选择的层数的相应属性修改为指定的数值；数字前可设+/-号，表示增加/减少相应数量；例：100、+5或-2">[?]</span>\n  </div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExLevelPointListConfigDialog" href="#">导入/导出分配方案</a></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>',"min-width: 840px;"),i=a.find("#pdLevelPointList > tbody"),o=function(e,t){$('\n<tr>\n  <td style="width: 25px; text-align: left;"><input type="checkbox"></td>\n  <td style="text-align: left;">\n    <label style="margin-right: 8px;">\n      第 <input name="level" type="text" value="'+(e||"")+'" style="width: 30px;"> 层\n    </label>\n  </td>\n  <td><input class="pd_point" name="s1" type="number" value="'+t["力量"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="s2" type="number" value="'+t["体质"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d1" type="number" value="'+t["敏捷"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="d2" type="number" value="'+t["灵活"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i1" type="number" value="'+t["智力"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_point" name="i2" type="number" value="'+t["意志"]+'" min="1" style="width: 50px;" required></td>\n  <td><input class="pd_arm_input" name="weaponId" type="text" value="'+(t["武器ID"]?t["武器ID"]:"")+'" maxlength="15" style="width: 65px;"></td>\n  <td><input class="pd_arm_input" name="weaponMemo" type="text" value="'+(t["武器备注"]?t["武器备注"]:"")+'" maxlength="20" style="width: 70px;"></td>\n  <td><input class="pd_arm_input" name="armorId" type="text" value="'+(t["护甲ID"]?t["护甲ID"]:"")+'" maxlength="15" style="width: 65px;"></td>\n  <td><input class="pd_arm_input" name="armorMemo" type="text" value="'+(t["护甲备注"]?t["护甲备注"]:"")+'" maxlength="20" style="width: 70px;"></td>\n  <td style="text-align: left;">\n    <a class="pd_btn_link" data-name="fill" href="#">填充</a>\n    <a class="pd_btn_link" data-name="addArm" href="#">装备</a>\n    <a class="pd_btn_link pd_highlight" data-name="delete" href="#">删除</a>\n  </td>\n</tr>\n<tr>\n  <td></td>\n  <td class="pd_custom_tips" title="剩余属性点">剩余：<span data-id="surplusPoint">0</span></td>\n  <td title="攻击力" hidden> \x3c!-- 临时禁用 --\x3e\n    攻：<span data-id="pro_s1" style="cursor: pointer;">0</span> <a data-id="opt_s1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="最大生命值" hidden>\n    命：<span data-id="pro_s2" style="cursor: pointer;">0</span> <a data-id="opt_s2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="攻击速度" hidden>\n    速：<span data-id="pro_d1" style="cursor: pointer;">0</span> <a data-id="opt_d1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="暴击几率" hidden>\n    暴：<span data-id="pro_d2" style="cursor: pointer;">0</span>% <a data-id="opt_d2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="技能释放概率" hidden>\n    技：<span data-id="pro_i1" style="cursor: pointer;">0</span>% <a data-id="opt_i1" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td title="防御减伤" hidden>\n    防：<span data-id="pro_i2" style="cursor: pointer;">0</span>% <a data-id="opt_i2" href="#" title="点击：给该项加上或减去剩余属性点">&#177;</a>\n  </td>\n  <td class="pd_custom_tips" title="[飞身劈斩]伤害：攻击+体质值*5+智力值*5" hidden>技伤：<span data-id="skillAttack">0</span></td>\n  <td hidden></td>\n  <td hidden></td>\n</tr>\n').appendTo(i).find(".pd_point").trigger("change")};a.submit(function(e){e.preventDefault(),(0,b.read)();var f={},m={},g=!1,h=!1;i.find("tr:gt(0)").each(function(){var e=$(this);if(e.find(".pd_point").length){var t=A["可分配属性点"]-F(e.find(".pd_point"));if(0<t)h=!0;else if(t<0)return!(g=!0);var n=parseInt(e.find('[name="level"]').val());if(n&&!(n<0)){var a={},o=!0,i=!1,r=void 0;try{for(var l,d=Array.from(e.find(".pd_point, .pd_arm_input"))[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value,c=$(s),u=c.attr("name"),p=null;if(p=$.trim(c.val()),c.is(".pd_point")){if(!(p=parseInt(p))||p<0)return}else{if(!p)continue;if(("weaponId"===u||"armorId"===u)&&(!(p=parseInt(p))||p<0))return}a[N(u)]=p}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}z.deepEqual(m,a)||(f[n]=a,m=a)}}}),h&&!confirm("部分层数的可分配属性点尚未用完，是否提交？")||(g?alert("部分层数的剩余属性点为负，请重新填写"):(Config.levelPointList=f,(0,b.write)(),v.close(n),H(Config.levelPointList)))}).find('[data-name="add"]').click(function(e){e.preventDefault();o(0,{"力量":1,"体质":1,"敏捷":1,"灵活":1,"智力":1,"意志":1}),i.find('[name="level"]:last').focus(),v.resize(n)}).end().find('[data-name="deleteSelect"]').click(function(e){e.preventDefault();var t=i.find('[type="checkbox"]:checked');t.length&&confirm("是否删除所选层数？")&&(t.closest("tr").next("tr").addBack().remove(),v.resize(n))}).end().find('[data-name="openImOrExLevelPointListConfigDialog"]').click(function(e){e.preventDefault(),Z.showCommonImportOrExportConfigDialog("各层点数分配方案","levelPointList",null,function(){$("#pdLevelPointListConfigDialog").remove(),t(function(e){return e.submit()})})}).end().find('[data-name="selectAll"]').click(function(){return z.selectAll(i.find('[type="checkbox"]'))}).end().find('[data-name="selectInverse"]').click(function(){return z.selectInverse(i.find('[type="checkbox"]'))}),i.on("click",'[data-name="fill"]',function(e){e.preventDefault(),R($(this).closest("tr"))}).on("click",'[data-name="delete"]',function(e){e.preventDefault(),$(this).closest("tr").next("tr").addBack().remove(),v.resize(n)}).on("click",'[data-name="addArm"]',function(e){e.preventDefault(),i.find("#pdAddWeaponId, #pdAddWeaponMemo, #pdAddArmorId, #pdAddArmorMemo").removeAttr("id"),$(this).closest("tr").find('[name="weaponId"]').attr("id","pdAddWeaponId").end().find('[name="weaponMemo"]').attr("id","pdAddWeaponMemo").end().find('[name="armorId"]').attr("id","pdAddArmorId").end().find('[name="armorMemo"]').attr("id","pdAddArmorMemo"),le(1)}).on("change",".pd_point",function(){var e=$(this),t=e.attr("name"),n=parseInt(e.val());if(n&&!(n<0)){var a=e.closest("tr"),o=a.next("tr");o.find('[data-id="pro_'+t+'"]').text(j(N(t),n));var i=parseInt(a.find('[name="s1"]').val()),r=parseInt(a.find('[name="s2"]').val()),l=parseInt(a.find('[name="i1"]').val());o.find('[data-id="skillAttack"]').text(m(i+O("力量",i),r+O("体质",r),l+O("智力",l)));var d=A["可分配属性点"]-F(a.find(".pd_point"));o.find('[data-id="surplusPoint"]').text(d).css("color",0!=d?"#f00":"#000")}}).on("click",'[data-id^="pro_"]',function(){var e=$(this),t=e.data("id").replace("pro_",""),n=parseInt(prompt("请输入数值：",e.text()));!n||n<0||e.closest("tr").prev("tr").find('[name="'+t+'"]').val(q(N(t),n)).trigger("change")}).on("click",'[data-id^="opt_"]',function(e){e.preventDefault();var t=$(this),n=t.data("id").replace("opt_",""),a=t.closest("tr").prev("tr"),o=A["可分配属性点"]-F(a.find(".pd_point"));if(o){var i=a.find('[name="'+n+'"]');if(i.length){var r=parseInt(i.val());(isNaN(r)||r<0)&&(r=0),r+=o;var l=parseInt(i.attr("min"));i.val(r<l?l:r).trigger("change")}}}),a.find('[name="modify"]').click(function(){var e=i.find('[type="checkbox"]:checked');if(e.length){var o={};a.find('[data-id="modifyArea"] [type="text"]').each(function(){var e=$(this),t=e.attr("name"),n=$.trim(e.val());if(n){var a=/^(-|\+)?(\d+)$/.exec(n);a||(alert("格式不正确"),e.select().focus()),o[t]={},void 0!==a[1]?o[t].action="+"===a[1]?"add":"minus":o[t].action="equal",o[t].value=parseInt(a[2])}}),e.each(function(){$(this).closest("tr").find(".pd_point").each(function(){var e=$(this),t=e.attr("name");if(t in o)if("equal"!==o[t].action){var n=parseInt(e.val());(!n||n<0)&&(n=0),n+="add"===o[t].action?o[t].value:-o[t].value,e.val(1<n?n:1)}else e.val(o[t].value)}).trigger("change")}),alert("点数已修改")}}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),$(this).closest('[data-id="modifyArea"]').find('[type="text"]').val("")});var r=!0,l=!1,d=void 0;try{for(var s,c=z.entries(Config.levelPointList)[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=W(s.value,2),p=u[0],f=u[1];$.isNumeric(p)&&o(p,f)}}catch(e){l=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw d}}v.show(n),"function"==typeof e&&e(a)}},le=function(n){(0,b.read)();var e="pd"+(1===n?"Add":"Change")+"ArmDialog",t=$("#"+e).parent();if(0<t.length&&1===n)t.fadeIn("fast"),v.resize(e);else{var a=G.wait("<strong>正在获取装备信息&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_mybp.php?t="+$.now(),timeout:V.default.defAjaxTimeout}).done(function(e){G.remove(a);var t=/<tr><td width="\d+%">装备.+?\r\n(<tr.+?<\/tr>)<tr><td colspan="4">/.exec(e);t&&de(n,t[1])}).fail(function(){return G.remove(a)})}},de=function(e,t){var n="pd"+(1===e?"Add":"Change")+"ArmDialog";if(!(0<$("#"+n).length)){var a='\n<div class="pd_cfg_main" style="padding: 0;">\n  <table class="kf_fw_ig4" data-name="armList" cellspacing="0" cellpadding="0" align="center" style="width: 800px;">\n    <tbody>\n      <tr hidden><td colspan="3" class="kf_fw_ig_title1">我的装备背包</td></tr>\n      <tr><td width="10%">装备</td><td width="10%">熔炼</td><td width="80%">名称</td></tr>\n      '+t+'\n      <tr><td colspan="3"><span style="color:#00f;">不显示超过10件以上的物品，如物品超过10件，请熔炼掉多余的即可全部显示。</span></td></tr>\n    </tbody>\n  </table>\n</div>\n<div class="pd_cfg_btns">\n  '+(0===e?'<button name="manualInputArmId" type="button" title="手动输入装备ID">手动输入ID</button>':"")+'\n  <button data-action="close" type="button">关闭</button>\n</div>',o=v.create(n,(1===e?"加入":"更换")+"装备",a,"min-width: 820px; z-index: 1003;"),i=o.find('.kf_fw_ig4[data-name="armList"]');ee.addCommonArmsButton(o.find(".pd_cfg_btns"),i),1===e?o.off("click",'[data-action="close"]').on("click",'[data-action="close"]',function(){o.fadeOut("fast")}):o.find('[name="manualInputArmId"]').click(function(){var e=$.trim(prompt("请输入装备ID（多个ID用空格分隔）："));if(e){var t=e.split(" "),a=G.wait("<strong>正在装备中&hellip;</strong>");$(document).clearQueue("ChangeArms"),$.each(t,function(e,t){t&&$(document).queue("ChangeArms",function(){$.post("kf_fw_ig_mybpdt.php","do=4&id="+t+"&safeid="+k,function(e){var t=z.removeHtmlTag(e);if(/装备完毕/.test(t)){if(Config.autoSaveArmsInfoEnabled){var n=ee.readArmsInfo();n["已装备武器"]=n["已装备护甲"]=0,ee.writeArmsInfo(n)}}else G.remove(a),alert(t)}).fail(function(){$(document).clearQueue("ChangeArms"),G.remove(a),alert("连接超时")}).always(function(){$(document).queue("ChangeArms").length?setTimeout(function(){return $(document).dequeue("ChangeArms")},V.default.minActionInterval):oe(function(){G.remove(a),v.close(n),$(".pd_arm_input").val("")})})})}),$(document).dequeue("ChangeArms")}}),Config.autoSaveArmsInfoEnabled&&ee.addSavedArmsInfo(i),ee.handleArmArea(i,e),ee.bindArmLinkClickEvent(i,k,1),v.show(n),Y.runFunc("Item.show"+(1===e?"Add":"Change")+"ArmDialog_after_")}},se=function(d){var e=me(d),t=e.boxNum,n=e.boxes,a="",o=!0,i=!1,r=void 0;try{for(var l,s=z.getSortedObjectKeyList(ee.boxTypeList,n)[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=l.value;a+="<i>"+c+"<em>+"+n[c].toLocaleString()+"</em></i> "}}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}var u="",p=!0,f=!1,m=void 0;try{for(var g,h=z.entries(ge(d))[Symbol.iterator]();!(p=(g=h.next()).done);p=!0){var v=W(g.value,2);u+="<i>"+v[0]+"<em>+"+v[1]+"</em></i> "}}catch(e){f=!0,m=e}finally{try{!p&&h.return&&h.return()}finally{if(f)throw m}}var b="",y=!0,_=!1,x=void 0;try{for(var k,C=z.entries(ge(d.filter(function(e,t){return t>=d.length-V.default.enemyStatLatestLevelNum})))[Symbol.iterator]();!(y=(k=C.next()).done);y=!0){var w=W(k.value,2);b+="<i>"+w[0]+"<em>+"+w[1]+"</em></i> "}}catch(e){_=!0,x=e}finally{try{!y&&C.return&&C.return()}finally{if(_)throw x}}var I=$("#pdLogStat");if(I.html("\n<li><b>收获统计：</b><i>盒子<em>+"+t+"</em></i> "+(a||"无")+"</li>\n<li><b>全部层数：</b>"+u+"<br><b>最近"+V.default.enemyStatLatestLevelNum+"层：</b>"+b+"</li>\n"),Config.showLevelEnemyStatEnabled){for(var L="",S=function(n){L+="&nbsp;&nbsp;<b>"+n+"-"+(n+9<d.length?n+9:d.length-1)+"：</b>";var e="",t=!0,a=!1,o=void 0;try{for(var i,r=z.entries(ge(d.filter(function(e,t){return n<=t&&t<n+10})))[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var l=W(i.value,2);e+="<i>"+l[0]+"<em>+"+l[1]+"</em></i> "}}catch(e){a=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(a)throw o}}L+=(e||"无")+"<br>"},A=1;A<d.length;A+=10)S(A);I.append("<li><b>分层统计：</b>"+(L?"<br>"+L:"无")+"</li>")}},ce=function(e,t,r){var l=[];$.each(e,function(e,t){if(t){var n=/\[([^\]]+)的]NPC/.exec(t);if(n){var a=n[1],o="";switch(a){case"普通":o="#09c";break;case"特别睿智":o="#c96";break;case"特别坚强":o="#cc587c";break;case"特别强壮":o="#f93";break;case"特别快速":o="#f3c";break;case"BOSS":o="#f00";break;default:o="#0075ea"}if(l[e]=t.replace(n[0],'<span style="background-color: '+o+';">['+a+"的]</span>NPC"),r[e]){var i=r[e];l[e]=l[e].replace("</li>",('</li><li class="pk_log_g" style="color: #666;">'+i+"</li>").replace(/\n/g,"<br>"))}}}}),s.html(l.reverse().join("")),Config.showLiteLootLogEnabled?$("#pdLiteLootLogStyle").length||$("head").append('<style id="pdLiteLootLogStyle">.pk_log_g, .pk_log_i, .pk_log_u, .pk_log_v { display: none; }</style>'):$("#pdLiteLootLogStyle").remove(),Y.runFunc("Loot.showEnhanceLog_after_")},ue=(n.getLog=function(){return L},n.getLogList=function(e){var t=[],n=e.match(/<li class="pk_log_j">.+?(?=\s*<li class="pk_log_j">|\s*$)/g);for(var a in n){var o=/在\[\s*(\d+)\s*层]/.exec(z.removeHtmlTag(n[a]));o&&(t[parseInt(o[1])]=n[a])}return t}),pe=n.getLevelInfo=function(e){var t={enemy:"",life:0,initLife:0,box:""};if(!e)return t;e=z.removeHtmlTag(e.replace(/<\/li>/g,"</li>\n"));var n=/你\((\d+)\)遭遇了\[([^\]]+)的]NPC/.exec(e);return n&&(t.initLife=parseInt(n[1]),t.enemy=n[2],t.enemy=t.enemy.replace("特别","").replace("(后续更新前此路不通)","")),(n=/生命值\[(\d+)\s*\/\s*\d+]/.exec(e))&&(t.life=parseInt(n[1])),(n=/敌人掉落了一个\s*\[\s*(\S+?盒子)\s*]/.exec(e))&&(t.box=n[1]),t},fe=n.getLevelInfoList=function(e){var n=[];return $.each(e,function(e,t){t&&(n[e]=pe(t))}),n},me=function(e){var n=0,a={};return $.each(e,function(e,t){t&&t.box&&(t.box in a||(a[t.box]=0),a[t.box]++,n++)}),{boxNum:n,boxes:a}},ge=function(e){var n={"普通":0,"强壮":0,"快速":0,"睿智":0,"坚强":0,BOSS:0,"大魔王":0};return $.each(he(e),function(e,t){t&&t in n&&n[t]++}),n.BOSS||delete n.BOSS,n["大魔王"]||delete n["大魔王"],n},he=function(e){var n=[];return $.each(e,function(e,t){t&&t.enemy&&(n[e]=t.enemy)}),n},ve=function(e){return 1<=e.length-1?e.length-1:0},be=function(e){var t=localStorage.getItem(V.default.tempPointsLogListStorageName+"_"+K.default.uid);if(!t)return[];try{t=JSON.parse(t)}catch(e){return[]}if(!t||"object"!==$.type(t)||"number"!==$.type(t.time)||!Array.isArray(t.pointsLogList))return[];var n=$.now()-t.time;return t.pointsLogList.length>e.length||864e5<=n||n<0?(localStorage.removeItem(V.default.tempPointsLogListStorageName+"_"+K.default.uid),[]):t.pointsLogList},ye=function(){var e=new Date,t=z.getTimezoneDateByTime("02:30:00");return(t<e||!Config.autoLootEnabled&&!Config.autoSaveLootLogInSpecialCaseEnabled)&&(t=z.getTimezoneDateByTime("00:00:30")).setDate(t.getDate()+1),t<e&&t.setDate(t.getDate()+1),t},_e=(n.checkLoot=function e(){if(new Date<z.getDateByTime(Config.checkLootAfterTime))$(document).dequeue("AutoAction");else{console.log("检查争夺情况Start");var l=G.wait("<strong>正在检查争夺情况中&hellip;</strong>");z.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:V.default.defAjaxTimeout,success:function(e){if(G.remove(l),/你被击败了|今日战斗已完成/.test(e))z.setCookie(V.default.lootCompleteCookieName,2,ye());else{if(z.getCookie(V.default.lootCheckingCookieName))return;var t=$("#pk_text",e);if(!t.length)return void z.setCookie(V.default.lootCompleteCookieName,-2,z.getDate("+"+V.default.checkLootInterval+"m"));if(0<Config.attackTargetLevel){var n=t.html(),a=ue(n),o=ve(a);if(Config.attackTargetLevel<=o)return void z.setCookie(V.default.lootCompleteCookieName,1,ye())}var i=/错高峰福利：当前服务器状态\[\s*<span[^<>]+>(\S+?)<\/span>\s*\]/.exec(e);if(i){var r=i[1];if(console.log("当前服务器状态："+r),"Idle"===Config.autoLootServerStatusType&&"空闲"!==r||"IdleOrNormal"===Config.autoLootServerStatusType&&"空闲"!==r&&"正常"!==r)return void z.setCookie(V.default.lootCompleteCookieName,-2,z.getDate("+"+V.default.checkLootInterval+"m"))}z.setCookie(V.default.lootCheckingCookieName,1,z.getDate("+1m")),z.setCookie(V.default.lootAttackingCookieName,1,z.getDate("+1h")),G.destroy(),$(document).clearQueue("AutoAction"),location.href="kf_fw_ig_index.php"}},error:function(){G.remove(l),$(document).clearQueue("AutoAction"),$(document).queue("AutoAction",function(){setTimeout(e,V.default.minActionInterval)})},complete:function(){$(document).dequeue("AutoAction")}})}},n.autoSaveLootLog=function e(){console.log("检查争夺情况Start");var l=G.wait("<strong>正在检查争夺情况中&hellip;</strong>");$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:V.default.defAjaxTimeout,success:function(e){if(G.remove(l),!z.getCookie(V.default.lootCompleteCookieName)){var t=$("#pk_text",e).html();if(/你被击败了|今日战斗已完成/.test(t)){z.setCookie(V.default.lootCompleteCookieName,2,ye());var n=ue(t),a=fe(n),o=X.read();if(!$.isEmptyObject(o)){var i=z.getObjectKeyList(o,1),r=parseInt(i[i.length-1]);if(r>z.getDate("-1d").getTime()&&o[r].log.join("").trim()===n.join("").trim())return}re(n,a,[])}else z.setCookie(V.default.lootCompleteCookieName,-1,z.getDate("+"+V.default.checkLootInterval+"m"))}},error:function(){G.remove(l),$(document).queue("AutoAction",function(){setTimeout(e,V.default.minActionInterval)})},complete:function(){$(document).dequeue("AutoAction")}})},n.getChangePointsCountDown=function(){return console.log("获取改点倒计时Start"),$.ajax({type:"GET",url:"kf_fw_ig_index.php?t="+$.now(),timeout:V.default.defAjaxTimeout}).then(function(e){var t=/\(下次修改配点还需\[(\d+)]分钟\)/.exec(e);if(t){var n=z.getDate("+"+t[1]+"m");return z.setCookie(V.default.changePointsInfoCookieName,n.getTime(),n),n.getTime()}if(t=/当前修改配点可用\[(\d+)]次/.exec(e)){var a=parseInt(t[1]);return z.setCookie(V.default.changePointsInfoCookieName,a+"c",z.getDate("+"+V.default.changePointsInfoExpires+"m")),a}var o=z.getDate("+1h");return z.setCookie(V.default.changePointsInfoCookieName,o.getTime(),o),"error"},function(){return"timeout"})},n.addUserLinkInPkListPage=function(){$(".kf_fw_ig1 > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===K.default.userName&&e.find("a").addClass("pd_highlight")})},n.addUserLinkInHaloPage=function(){$(".kf_fw_ig1:eq(1) > tbody > tr:gt(1) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===K.default.userName&&e.find("a").addClass("pd_highlight")})},function t(e){var n=0<arguments.length&&void 0!==e&&e;console.log("获取战力光环信息Start");var a=G.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>");xe().done(function(e){"object"===$.type(e)&&(ke(e),n?r():w.find(".pd_point").trigger("change"))}).always(function(e){G.remove(a),"timeout"===e?setTimeout(function(){return t(n)},V.default.defAjaxInterval):"error"===e&&G.show("<strong>战力光环信息获取失败！</strong>",-1)})}),xe=n.getHaloInfo=function(){return $.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+$.now(),timeout:V.default.defAjaxTimeout}).then(function(e){var t={"全属性":0,"攻击力":0,"生命值":0},n=/全属性\s*\+\s*(\d+(?:\.\d+)?)%/.exec(e);if(n){t["全属性"]=Math.round(10*parseFloat(n[1]))/1e3;var a=/福利加成\s*\+\s*(\d+)攻击力\s*&\s*\+\s*(\d+)生命值/.exec(e);return a&&(t["攻击力"]=parseInt(a[1]),t["生命值"]=parseInt(a[2])),J.setValue(V.default.haloInfoTmpLogName,$.extend(t,{time:$.now()})),t}return"error"},function(){return"timeout"})},ke=n.setHaloInfo=function(e){if(d=e,!$("#pdHaloInfo").length){var t=C.find('input[type="text"]:eq(13)');if(!t.length||$.trim(t.val()))return;t.attr("id","pdHaloInfo"),$('<a data-name="reloadHaloInfo" href="#" style="margin-left: -20px;" title="如战力光环信息不正确时，请点此重新读取">读</a>').insertAfter(t).click(function(e){e.preventDefault(),confirm("是否重新读取战力光环信息？")&&(J.deleteValue(V.default.haloInfoTmpLogName),_e())})}$("#pdHaloInfo").val("全属性+"+Math.round(1e3*d["全属性"])/10+"% (+"+d["攻击力"]+"|+"+d["生命值"]+")")},Ce=n.getPromoteHaloInfo=function t(){Y.runFunc("Loot.getPromoteHaloInfo_before_"),console.log("获取战力光环页面信息Start");function d(e){var t=z.getDate(e);return z.setCookie(V.default.promoteHaloCookieName,t.getTime(),t),$(document).dequeue("AutoAction"),!1}var s=G.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),i=function(e){var l=0<arguments.length&&void 0!==e?e:-1;$.ajax({type:"GET",url:"kf_fw_ig_halo.php?t="+$.now(),timeout:V.default.defAjaxTimeout}).done(function(e){G.remove(s);var t=/safeid=(\w+)"/.exec(e);if(!t)return d("+1h");var n=t[1],a=/下次随机还需\[(\d+)]分钟/.exec(e);if(a){var o=Config.promoteHaloAutoIntervalEnabled?V.default.minPromoteHaloInterval:60*Config.promoteHaloInterval;return o=o<V.default.minPromoteHaloInterval?V.default.minPromoteHaloInterval:o,d("+"+(o-(V.default.minPromoteHaloInterval-parseInt(a[1])))+"m")}var i=1,r=/当前光环随机可用\[(\d+)]次/.exec(e);Config.promoteHaloAutoIntervalEnabled&&r&&(i=parseInt(r[1]),-1<l&&(i=l<i?l:i)),we(i,Config.promoteHaloCostType,n)}).fail(function(){G.remove(s),setTimeout(t,V.default.defAjaxInterval)})};0<Config.promoteHaloLimit?function e(){$.ajax({type:"GET",url:"profile.php?action=show&uid="+K.default.uid+"&t="+$.now(),timeout:V.default.defAjaxTimeout}).done(function(e){G.remove(s);var t=(11<=Config.promoteHaloCostType?/贡献数值：(\d+(?:\.\d+)?)/:/论坛货币：(-?\d+)\s*KFB/).exec(e);if(!t)return d("+"+V.default.promoteHaloLimitNextActionInterval+"m");var n=parseFloat(t[1]);if(!(n>Config.promoteHaloLimit))return d("+"+V.default.promoteHaloLimitNextActionInterval+"m");var a=Ie(Config.promoteHaloCostType).num,o=Math.floor((n-Config.promoteHaloLimit)/a);if(!(0<o))return d("+"+V.default.promoteHaloLimitNextActionInterval+"m");s=G.wait("<strong>正在获取战力光环信息，请稍候&hellip;</strong>"),i(o)}).fail(function(){return setTimeout(e,V.default.defAjaxInterval)})}():i()},we=n.promoteHalo=function(t,d,n){console.log("提升战力光环Start");var a=G.wait('<strong>正在提升战力光环&hellip;</strong><i>剩余：<em class="pd_countdown">'+t+'</em></i><a class="pd_stop_action" href="#">停止操作</a>');J.deleteValue(V.default.haloInfoTmpLogName);var s=!1,c=0,u=z.getDate("+10m").getTime();!function e(){$.ajax({type:"GET",url:"kf_fw_ig_halo.php?do=buy&id="+d+"&safeid="+n+"&t="+$.now(),timeout:V.default.defAjaxTimeout}).done(function(e){Z.showFormatLog("提升战力光环",e);var t=z.getResponseMsg(e).msg,n=/(新数值为|随机值为)\[(\d+(?:\.\d+)?)%]/.exec(t);if(n){var a="新数值为"===n[1];u=Config.promoteHaloAutoIntervalEnabled?0:z.getDate("+"+Config.promoteHaloInterval+"h").getTime();var o=parseFloat(n[2]),i=Ie(d);G.show("<strong>"+(a?"恭喜你提升了光环的效果！新数值为【<em>"+o+"%</em>】":"你本次随机值为【<em>"+o+"%</em>】，未超过光环效果")+"</strong><i>"+i.type+"<ins>"+(-i.num).toLocaleString()+"</ins></i>");var r={};r[i.type]=-i.num,Q.push("提升战力光环",a?"恭喜你提升了光环的效果！新数值为【`"+o+"%`】":"你本次随机值为【`"+o+"%`】，未超过光环效果",{pay:r}),c++}else if(/两次操作间隔过短/.test(t)?u=z.getDate("+10s").getTime():s=!0,(n=/你的(贡献点数|KFB)不足/.exec(t))&&(u=z.getDate("+"+Config.promoteHaloInterval+"h").getTime(),G.show("<strong>"+n[1]+'不足，无法提升战力光环</strong><a href="kf_fw_ig_halo.php" target="_blank">手动选择</a>',-1)),n=/你还需要等待(\d+)分钟/.exec(t)){var l=60*Config.promoteHaloInterval;l=l<V.default.minPromoteHaloInterval?V.default.minPromoteHaloInterval:l,u=z.getDate("+"+(60*Config.promoteHaloInterval-(V.default.minPromoteHaloInterval-parseInt(n[1])))+"m").getTime()}}).always(function(){a.find(".pd_countdown").text(t-c),(s=s||a.data("stop"))||c===t?(G.remove(a),0<u||s?(z.setCookie(V.default.promoteHaloCookieName,u,new Date(u)),setTimeout(function(){return $(document).dequeue("AutoAction")},V.default.minActionInterval)):(z.deleteCookie(V.default.promoteHaloCookieName),Ce()),Y.runFunc("Loot.promoteHalo_after_")):setTimeout(e,V.default.promoteHaloActionInterval)})}()},Ie=n.getPromoteHaloCostByTypeId=function(e){switch(e){case 1:return{type:"KFB",num:100};case 2:return{type:"KFB",num:1e3};case 11:return{type:"贡献",num:.2};case 12:return{type:"贡献",num:2};default:return{type:"KFB",num:0}}}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Item":10,"./Log":11,"./LootLog":14,"./Msg":15,"./Public":18,"./Script":20,"./TmpLog":22,"./Util":23}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMergeLog=n.record=n.clear=n.write=n.read=void 0;var a=r(e("./Info")),o=r(e("./Const")),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./Util"));function r(e){return e&&e.__esModule?e:{default:e}}var l=o.default.storagePrefix+"loot_log",d=n.read=function(){var t={},e=i.readData(l+"_"+a.default.uid);if(!e)return t;try{e=JSON.parse(e)}catch(e){return t}return e&&"object"===$.type(e)?t=e:t},s=n.write=function(e){return i.writeData(l+"_"+a.default.uid,JSON.stringify(e))};n.clear=function(){return i.deleteData(l+"_"+a.default.uid)},n.record=function(e,t){var n=d();n[$.now()]={log:e,points:t};var a={};$.each(i.getObjectKeyList(n,1).slice(-Config.lootLogSaveMaxNum),function(e,t){t=parseInt(t),a[t]=n[t]}),s(a)},n.getMergeLog=function(e,t){for(var n in t)!$.isNumeric(n)||parseInt(n)<=0||"object"===$.type(t[n])&&Array.isArray(t[n].log)&&Array.isArray(t[n].points)&&(e[n]=t[n]);return e}},{"./Const":6,"./Info":9,"./Util":23}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=n.show=function(e,t){var n={msg:"",duration:Config.defShowMsgDuration,clickable:!0,preventable:!1};"object"===$.type(e)?$.extend(n,e):(n.msg=e,n.duration=void 0===t?Config.defShowMsgDuration:t),20<$(".pd_msg").length&&g();var a=$(".pd_msg_container"),o=0===a.length;if(!o&&!$(".pd_mask").length){var i=$(".pd_msg:last");if(0<i.length){var r=i.offset().top,l=$(window).scrollTop();(r<l||r>=l+$(window).height()-i.outerHeight()-10)&&(g(),o=!0)}}n.preventable&&!$(".pd_mask").length&&$('<div class="pd_mask"></div>').appendTo("body"),o&&(a=$('<div class="pd_msg_container"></div>').appendTo("body"));var d=$('<div class="pd_msg">'+n.msg+"</div>").appendTo(a);d.on("click",".pd_stop_action",function(e){e.preventDefault(),$(this).html("正在停止&hellip;").closest(".pd_msg").data("stop",!0)}),n.clickable&&d.css("cursor","pointer").click(function(){$(this).stop(!0,!0).fadeOut("slow",function(){m($(this))})}).find("a").click(function(e){e.stopPropagation()});var s=$(window).width(),c=d.outerWidth(),u=d.outerHeight(),p=s/2-c/2;s<p+c&&(p=s-c-20),p<0&&(p=0),o?a.css("top",$(window).height()/2-u/2):a.stop(!1,!0).animate({top:"-="+u/1.75}),$(":focus").blur();var f=d.prev(".pd_msg");return d.css({top:0<f.length?parseInt(f.css("top"))+f.outerHeight()+5:0,left:p}).fadeIn("slow"),-1!==n.duration&&d.delay(1e3*n.duration).fadeOut("slow",function(){m($(this))}),d},m=(n.wait=function(e,t){return a({msg:e,duration:-1,clickable:!1,preventable:!(1<arguments.length&&void 0!==t)||t})},n.remove=function(e){var t=e.parent();e.remove(),$(".pd_msg").length?$(".pd_countdown").length||$(".pd_mask").remove():(t.remove(),$(".pd_mask").remove())}),g=n.destroy=function(){$(".pd_msg_container").remove(),$(".pd_mask").remove()}},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleProfilePage=n.addUserNameLinkInRankPage=n.addAvatarChangeAlert=n.syncModifyPerPageFloorNum=n.addAutoChangeIdColorButton=n.addMsgSelectButton=n.modifyMyPostLink=n.addFollowAndBlockAndMemoUserLink=n.addFastDrawMoneyLink=n.highlightUnReadAtTipsMsg=n.addFastGotoThreadPageLink=n.highlightNewPost=void 0;var m=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(e("./Info")),g=o(e("./Util")),c=(o(e("./Msg")),r(e("./Const"))),u=e("./Config"),a=e("./ConfigDialog"),p=o(e("./TmpLog"));o(e("./Public")),o(e("./Bank"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}n.highlightNewPost=function(){$(".thread1 > tbody > tr > td:last-child").has("a.bl").each(function(){var e=$(this).html();/\|\s*\d{2}:\d{2}<br>\n.*\d{2}:\d{2}/.test(e)&&(e=e.replace(/(\d{2}:\d{2})<br>/,'<span class="pd_highlight">$1</span><br>'),$(this).html(e))})},n.addFastGotoThreadPageLink=function(){$('.threadtit1 > a[href^="read.php"]').each(function(){var e=$(this),t=e.closest("td").next().find("ul > li > a").contents().eq(0).text();if(t&&!(t<Config.perPageFloorNum)){for(var n=e.attr("href"),a=Math.floor(t/Config.perPageFloorNum)+1,o="",i=1;i<a;i++){if(i>Config.maxFastGotoThreadPageNum){i+1<=a&&(o+='..<a href="'+n+"&page="+a+'">'+a+"</a>");break}o+='<a href="'+n+"&page="+(i+1)+'">'+(i+1)+"</a>"}o='<span class="pd_thread_page">&hellip;'+o+"</span>",e.after(o).parent().css("white-space","normal")}})},n.highlightUnReadAtTipsMsg=function(){if($(".kf_share1:first").text().trim()==="含有关键词 “"+i.default.userName+"” 的内容"){var a=g.getCookie(c.default.prevReadAtTipsCookieName);if(a&&/^\d+日\d+时\d+分$/.test(a)){var o="";$(".kf_share1:eq(1) > tbody > tr:gt(0) > td:first-child").each(function(e){var t=$(this),n=t.text().trim();if(0===e&&(o=n),!(a<n&&n<=o))return!1;t.addClass("pd_highlight"),o=n}),$(".kf_share1").on("click","td > a",function(){g.deleteCookie(c.default.prevReadAtTipsCookieName)})}}},n.addFastDrawMoneyLink=function(){if($('td:contains("SYSTEM")').length&&$('td:contains("收到了他人转账的贡献")').length){var e=$(".thread2 > tbody > tr:eq(-2) > td:last"),t=e.html(),n=/给你转帐(\d+(?:\.\d+)?)贡献/.exec(t);if(n){var a=parseFloat(n[1]);e.html(t.replace(/会员\[(.+?)\]通过论坛银行/,'会员[<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" target="_blank" href="profile.php?action=show&username=$1">$1</a>]通过论坛银行').replace(n[0],'给你转帐<span class="pd_stat"><em>'+a.toLocaleString()+"</em></span>贡献")),$('a[href^="message.php?action=write&remid="]').attr("href","#").addClass("pd_disabled_link").click(function(e){e.preventDefault(),alert("本短消息由系统发送，请勿直接回复；如需回复，请点击给你转账的用户链接，向其发送短消息")})}}},n.addFollowAndBlockAndMemoUserLink=function(){var e=/(.+?)\s*详细信息/.exec($('td:contains("详细信息")').text());if(e){var f=$.trim(e[1]);$('<span>[<a href="#">关注用户</a>] [<a href="#">屏蔽用户</a>]</span><br><span>[<a href="#">添加备注</a>]</span><br>').appendTo($('a[href^="message.php?action=write&touid="]').parent()).find("a").each(function(){var e=$(this);if(e.is('a:contains("备注")')){var t="",n=!0,a=!1,o=void 0;try{for(var i,r=g.entries(Config.userMemoList)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=m(i.value,2),d=l[0],s=l[1];if(d===f){t=s;break}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}if(""!==t){e.text("修改备注").data("memo",t);var c=$(".log1 > tbody > tr:last-child > td:last-child");c.html("备注："+t+"<br>"+c.html())}}else{var u="关注",p=Config.followUserList;-1<e.text().indexOf("屏蔽")&&(u="屏蔽",p=Config.blockUserList),-1<g.inFollowOrBlockUserList(f,p)&&e.addClass("pd_highlight").text("解除"+u)}}).click(function(e){e.preventDefault(),(0,u.read)();var t=$(this);if(t.is('a:contains("备注")')){var n=t.data("memo");n=n||"";var a=prompt("为此用户添加备注（要删除备注请留空）：",n);if(null===a)return;Config.userMemoEnabled||(Config.userMemoEnabled=!0),(a=$.trim(a))?(Config.userMemoList[f]=a,t.text("修改备注")):(delete Config.userMemoList[f],t.text("添加备注")),t.data("memo",a),(0,u.write)()}else{var o="关注",i=Config.followUserList;if(t.text().includes("屏蔽")?(o="屏蔽",i=Config.blockUserList,Config.blockUserEnabled||(Config.blockUserEnabled=!0)):Config.followUserEnabled||(Config.followUserEnabled=!0),t.text()==="解除"+o){var r=g.inFollowOrBlockUserList(f,i);-1<r&&(i.splice(r,1),(0,u.write)()),t.removeClass("pd_highlight").text(o+"用户"),alert("该用户已被解除"+o)}else{if(-1===g.inFollowOrBlockUserList(f,i)){if("屏蔽"===o){var l=Config.blockUserDefaultType;if(null===(l=prompt("请填写屏蔽类型，0：屏蔽主题和回帖；1：仅屏蔽主题；2：仅屏蔽回帖",l)))return;l=parseInt(l),(isNaN(l)||l<0||2<l)&&(l=Config.blockUserDefaultType),i.push({name:f,type:l})}else i.push({name:f});(0,u.write)()}t.addClass("pd_highlight").text("解除"+o),alert("该用户已被"+o)}}})}},n.modifyMyPostLink=function(){$('.t a[href^="read.php?tid="]').each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/&uid=\d+#(\d+)/,"&spid=$1"))})},n.addMsgSelectButton=function(){var n=$('.thread1 > tbody > tr > td:last-child > [type="checkbox"]');$('<input value="自定义" type="button" style="margin-right: 3px;">').insertBefore('[type="button"][value="全选"]').click(function(e){e.preventDefault();var t=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的贡献|收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));if(""!==t){n.prop("checked",!1);var l=t.split("|");$(".thread1 > tbody > tr > td:nth-child(2) > a").each(function(){var e=$(this),t=!0,n=!1,a=void 0;try{for(var o,i=l[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;e.text().toLowerCase().includes(r.toLowerCase())&&e.closest("tr").find('td:last-child > input[type="checkbox"]').prop("checked",!0)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}})}}).parent().attr("colspan",4).prev("td").attr("colspan",3),$('<input value="反选" type="button" style="margin-left: 5px; margin-right: 1px;">').insertAfter('[type="button"][value="全选"]').click(function(){return g.selectInverse(n)})},n.addAutoChangeIdColorButton=function(){var e=$('table div > table > tbody > tr > td:contains("自定义ID颜色")');$('<span class="pd_highlight">低等级没人权？没有自己喜欢的颜色？快来试试助手的<a href="#">自定义本人神秘颜色</a>的功能吧！（虽然仅限自己可见 ╮(╯▽╰)╭）</span><br>').appendTo(e).find("a").click(function(e){e.preventDefault(),(0,a.show)()});var d=e.parent("tr").nextAll("tr").not("tr:last");if(!(d.find("a").length<=1)){var s=$('\n<form>\n<div data-name="autoChangeIdColorBtns" style="margin-top: 5px;">\n  <label><input name="autoChangeIdColorEnabled" class="pd_input" type="checkbox"> 自动更换ID颜色</label>\n</div>\n</form>\n').appendTo(e);s.find('[name="autoChangeIdColorEnabled"]').click(function(){var e=$(this),t=e.prop("checked");if(t!==Config.autoChangeIdColorEnabled&&((0,u.read)(),Config.autoChangeIdColorEnabled=t,(0,u.write)()),t){d.addClass("pd_id_color_select").find("td:not(:has(a))").css("cursor","not-allowed"),$('\n<label class="pd_cfg_ml">\n  更换顺序\n  <select name="autoChangeIdColorType" style="font-size: 12px;">\n    <option value="random">随机</option><option value="sequence">顺序</option>\n  </select>\n</label>&nbsp;\n<label>每隔 <input name="autoChangeIdColorInterval" class="pd_input" style="width: 25px;" type="text" maxlength="5"> 小时</label>\n<button name="save" type="button">保存</button>\n<button name="reset" type="button" style="margin-left: 3px;">重置</button><br>\n<a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n<a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n<label><input name="changeAllAvailableIdColorEnabled" class="pd_input" type="checkbox"> 选择当前所有可用的ID颜色</label>\n').insertAfter(e.parent()).filter('[name="save"]').click(function(){var e=s.find('[name="autoChangeIdColorInterval"]'),t=parseInt(e.val());if(isNaN(t)||t<=0)return alert("ID颜色更换时间间隔格式不正确"),void e.select().focus();var n=s.find('[name="changeAllAvailableIdColorEnabled"]').prop("checked"),a=[];if(d.find('[type="checkbox"]:checked').each(function(){a.push(parseInt($(this).val()))}),!n&&a.length<=1)alert("必须选择2种或以上的ID颜色");else{a.length<=1&&(a=[]);var o=Config.autoChangeIdColorInterval;(0,u.read)(),Config.autoChangeIdColorType=s.find('[name="autoChangeIdColorType"]').val().toLowerCase(),Config.autoChangeIdColorInterval=t,Config.changeAllAvailableIdColorEnabled=n,Config.customAutoChangeIdColorList=a,(0,u.write)(),o!==Config.autoChangeIdColorInterval&&g.deleteCookie(c.default.autoChangeIdColorCookieName),alert("设置保存成功")}}).end().filter('[name="reset"]').click(function(){(0,u.read)(),Config.autoChangeIdColorEnabled=u.Config.autoChangeIdColorEnabled,Config.autoChangeIdColorType=u.Config.autoChangeIdColorType,Config.autoChangeIdColorInterval=u.Config.autoChangeIdColorInterval,Config.changeAllAvailableIdColorEnabled=u.Config.changeAllAvailableIdColorEnabled,Config.customAutoChangeIdColorList=u.Config.customAutoChangeIdColorList,(0,u.write)(),g.deleteCookie(c.default.autoChangeIdColorCookieName),p.deleteValue(c.default.prevAutoChangeIdColorTmpLogName),alert("设置已重置"),location.reload()}).end().filter('[data-name="selectAll"], [data-name="selectInverse"]').click(function(e){if(e.preventDefault(),0<d.find("input[disabled]").length)return alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),void s.find('[name="changeAllAvailableIdColorEnabled"]').focus();$(this).is('[data-name="selectAll"]')?g.selectAll(d.find('[type="checkbox"]')):g.selectInverse(d.find('[type="checkbox"]'))}),d.find("td:has(a)").each(function(){var e=$(this),t=/&color=(\d+)/i.exec(e.find("a").attr("href"));t&&e.append('<input type="checkbox" class="pd_input" value="'+t[1]+'">')}),s.find('[name="autoChangeIdColorType"]').val(Config.autoChangeIdColorType),s.find('[name="autoChangeIdColorInterval"]').val(Config.autoChangeIdColorInterval),s.find('[name="changeAllAvailableIdColorEnabled"]').click(function(){d.find("input").prop("disabled",$(this).prop("checked"))}).prop("checked",Config.changeAllAvailableIdColorEnabled).triggerHandler("click");var n=!0,a=!1,o=void 0;try{for(var i,r=Config.customAutoChangeIdColorList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;d.find('input[value="'+l+'"]').prop("checked",!0)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}}else e.parent().nextAll().remove(),d.removeClass("pd_id_color_select").find("input").remove()}),d.on("click","td",function(e){if(!$(e.target).is("a")){var t=$(this);0<t.find("input[disabled]").length?(alert("请先取消勾选“选择当前所有可用的ID颜色”复选框"),s.find('[name="changeAllAvailableIdColorEnabled"]').focus()):$(e.target).is("input")||t.find("input").click()}}),Config.autoChangeIdColorEnabled&&s.find('[name="autoChangeIdColorEnabled"]').prop("checked",!0).triggerHandler("click")}},n.syncModifyPerPageFloorNum=function(){function e(){var e=parseInt($('select[name="p_num"]').val());isNaN(e)||(e=e||10)!==Config.perPageFloorNum&&(Config.perPageFloorNum=e,(0,u.write)())}$("form#creator").submit(function(){(0,u.read)(),e()}),e()},n.addAvatarChangeAlert=function(){$('input[name="uploadurl[2]"]').parent().append('<div class="pd_highlight">本反向代理服务器为了提高性能对图片设置了缓存，更换头像后可能需等待<b>最多30分钟</b>才能看到效果</div>')},n.addUserNameLinkInRankPage=function(){$(".kf_no11:eq(2) > tbody > tr:gt(0) > td:nth-child(2)").each(function(){var e=$(this),t=e.text().trim();e.html('<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+t+'" target="_blank">'+t+"</a>"),t===i.default.userName&&e.find("a").addClass("pd_highlight")})},n.handleProfilePage=function(){var e=$(".log1 > tbody > tr:last-child > td:nth-child(2)");e.html(e.html().replace(/<b>在线<\/b>/,'<b style="color: #090;">在线</b>').replace(/<b>离线<\/b>/,'<b style="color: #999;">离线</b>').replace(/系统等级：(\S+)/,'系统等级：<span class="pd_highlight">$1</span>').replace(/发帖数量：(\d+)/,function(e,t){return'发帖数量：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/神秘等级：(-?\d+)/,function(e,t){return'神秘等级：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/论坛货币：(-?\d+)/,function(e,t){return'论坛货币：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/贡献数值：(-?\d+(?:\.\d+)?)/,function(e,t){return'贡献数值：<span data-num="'+t+'">'+parseFloat(t).toLocaleString()+"</span>"}).replace(/在线时间：(\d+)/,function(e,t){return'在线时间：<span data-num="'+t+'">'+parseInt(t).toLocaleString()+"</span>"}).replace(/注册时间：((\d{4})-(\d{2})-(\d{2}))/,function(e,t,n,a,o){var i=new Date,r=t;return parseInt(a)===i.getMonth()+1&&parseInt(o)===i.getDate()&&parseInt(n)<=i.getFullYear()&&(r='<span class="pd_custom_tips pd_highlight" title="今天是该用户注册'+(i.getFullYear()-parseInt(n))+'周年纪念日">'+t+"</span>"),"注册时间："+r})).css("vertical-align","top")}},{"./Bank":2,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Info":9,"./Msg":15,"./Public":18,"./TmpLog":22,"./Util":23}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.replaceSiteLink=n.addFillTitleBtn=n.addRedundantKeywordWarning=n.savePostContentWhenSubmit=n.preventCloseWindowWhenEditPost=n.importKfSmileEnhanceExtension=n.addAttachChangeAlert=n.modifyPostPreviewPage=n.addExtraOptionInPostPage=n.addExtraPostEditorButton=n.removeUnpairedBBCodeInQuoteContent=n.handleMultiQuote=void 0;var o=i(e("./Info")),k=a(e("./Util")),C=a(e("./Msg")),w=i(e("./Const")),I=a(e("./Script"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}n.handleMultiQuote=function(e){var t=0<arguments.length&&void 0!==e?e:1;I.runFunc("Post.handleMultiQuote_before_",t),$("#pdClearMultiQuoteData").length||("/read.php"===location.pathname?$('<a id="pdClearMultiQuoteData" style="margin-right: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').prependTo($('input[name="diy_guanjianci"]').parent()):$('<a id="pdClearMultiQuoteData" style="margin-left: 7px;" title="清除在浏览器中保存的多重引用数据" href="#">清除引用数据</a>').insertAfter('input[name="diy_guanjianci"]'),$("#pdClearMultiQuoteData").click(function(e){e.preventDefault(),localStorage.removeItem(w.default.multiQuoteStorageName),$('input[name="diy_guanjianci"]').val(""),$(2===t?"#textarea":'textarea[name="atc_content"]').val(""),alert("多重引用数据已被清除")}));var n=localStorage[w.default.multiQuoteStorageName];if(n){try{n=JSON.parse(n)}catch(e){return}if(n&&"object"===$.type(n)&&!$.isEmptyObject(n)){var a=parseInt(k.getUrlParam("tid")),i=parseInt(k.getUrlParam("fid"));if(a&&void 0!==n.tid&&n.tid===a&&Array.isArray(n.quoteList)&&(2!==t||i)){var r=[],o=!0,l=!1,d=void 0;try{for(var s,c=n.quoteList[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;if(Array.isArray(u)){var p=!0,f=!1,m=void 0;try{for(var g,h=u[Symbol.iterator]();!(p=(g=h.next()).done);p=!0){var v=g.value;r.push(v)}}catch(e){f=!0,m=e}finally{try{!p&&h.return&&h.return()}finally{if(f)throw m}}}}}catch(e){l=!0,d=e}finally{try{!o&&c.return&&c.return()}finally{if(l)throw d}}if(r.length){var b=new Set,y="",_=$('input[name="diy_guanjianci"]');if(2===t&&(C.wait('<strong>正在获取引用内容中&hellip;</strong><i>剩余：<em class="pd_countdown">'+r.length+"</em></i>"),$(document).clearQueue("MultiQuote")),$.each(r,function(o,e){void 0!==e.floor&&void 0!==e.pid&&(b.add(e.userName),2===t?$(document).queue("MultiQuote",function(){$.get("post.php?action=quote&fid="+i+"&tid="+a+"&pid="+e.pid+"&article="+e.floor+"&t="+$.now(),function(e){var t=/<textarea id="textarea".*?>((.|\n)+?)<\/textarea>/i.exec(e);t&&(y+=k.removeUnpairedBBCodeContent(k.htmlDecode(t[1]).replace(/\n{2,}/g,"\n"))+(o===r.length-1?"":"\n"));var n=$(".pd_countdown:last");if(n.text(parseInt(n.text())-1),o===r.length-1){C.destroy();var a=$("#textarea");a.get(0).defaultValue=y,a.val(y).focus(),_.trigger("change")}else setTimeout(function(){$(document).dequeue("MultiQuote")},100)})}):y+="[quote]回 "+e.floor+"楼("+e.userName+") 的帖子[/quote]\n")}),_.val([].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(b)).join(",")),$('form[name="FORM"]').submit(function(){localStorage.removeItem(w.default.multiQuoteStorageName)}),2===t)$(document).dequeue("MultiQuote");else{var x=$('textarea[name="atc_content"]');x.get(0).defaultValue=y,x.val(y).focus(),_.trigger("change")}I.runFunc("Post.handleMultiQuote_after_",t)}else localStorage.removeItem(w.default.multiQuoteStorageName)}}}},n.removeUnpairedBBCodeInQuoteContent=function(){var e=$("#textarea"),t=e.val(),n=/\[quote\](.|\r|\n)+?\[\/quote\]/.exec(t);if(n){var a=k.removeUnpairedBBCodeContent(n[0]);n[0]!==a&&e.val(t.replace(n[0],a))}},n.addExtraPostEditorButton=function(){var r=$("#textarea").get(0);r&&$('\n<span id="wy_post" title="插入隐藏内容" data-type="hide" style="background-position: 0 -280px;">插入隐藏内容</span>\n<span id="wy_justifyleft" title="左对齐" data-type="left" style="background-position: 0 -360px;">左对齐</span>\n<span id="wy_justifycenter" title="居中" data-type="center" style="background-position: 0 -380px;">居中</span>\n<span id="wy_justifyright" title="右对齐" data-type="right" style="background-position: 0 -400px;">右对齐</span>\n<span id="wy_subscript" title="下标" data-type="sub" style="background-position: 0 -80px;">下标</span>\n<span id="wy_superscript" title="上标" data-type="sup" style="background-position: 0 -100px;">上标</span>\n<span class="pd_editor_btn" title="插入飞行文字" data-type="fly">F</span>\n<span class="pd_editor_btn" title="插入HTML5音频" data-type="audio">A</span>\n<span class="pd_editor_btn" title="插入HTML5视频" data-type="video">V</span>\n').appendTo("#editor-button .editor-button").click(function(){var e=$(this).data("type"),t="";switch(e){case"hide":t=prompt("请输入神秘等级：",5);break;case"audio":t=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐的单曲地址，将自动转换为外链地址）","http://");var n=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(t);n&&(t="https://music.miaola.info/163/"+n[1]+".mp3"),(n=/^https?:\/\/www\.xiami\.com\/song\/(\w+)/i.exec(t))&&(t="https://music.miaola.info/xiami/"+n[1]+".mp3");break;case"video":t=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var a=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(t);a&&(t="https://video.miaola.info/youtube/"+a[1]),(a=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(t))&&(t="https://video.miaola.info/youtube/"+a[1])}if(null!==t){var o="",i="";switch(e){case"hide":i="[hide="+t+"]"+(o=k.getSelText(r))+"[/hide]";break;case"left":i="[align=left]"+(o=k.getSelText(r))+"[/align]";break;case"center":i="[align=center]"+(o=k.getSelText(r))+"[/align]";break;case"right":i="[align=right]"+(o=k.getSelText(r))+"[/align]";break;case"fly":i="[fly]"+(o=k.getSelText(r))+"[/fly]";break;case"sub":i="[sub]"+(o=k.getSelText(r))+"[/sub]";break;case"sup":i="[sup]"+(o=k.getSelText(r))+"[/sup]";break;case"audio":i="[audio]"+t+"[/audio]";break;case"video":i="[video]"+t+"[/video]"}i&&(k.addCode(r,i,o),r.focus())}}).mouseenter(function(){$(this).addClass("buttonHover")}).mouseleave(function(){$(this).removeClass("buttonHover")})},n.addExtraOptionInPostPage=function(){$('\n<div class="pd_post_extra_option">\n  <label><input type="checkbox" name="autoAnalyzeUrl" checked> 自动分析url</label>\n  <label style="margin-left: 5px;"><input type="checkbox" name="windCodeAutoConvert" checked> Wind Code自动转换</label>\n</div>\n').appendTo($("#menu_show").closest("td")).on("click",'[type="checkbox"]',function(){var e=$(this),t=e.is('[name="autoAnalyzeUrl"]')?"atc_autourl":"atc_convert";$('form[name="FORM"]').find('[name="'+t+'"]').val(e.prop("checked")?1:0)}),$('<input type="button" value="预览帖子" style="margin-left: 7px;">').insertAfter('[type="submit"][name="Submit"]').click(function(e){e.preventDefault();var t=$('form[name="preview"]');t.find('input[name="atc_content"]').val($("#textarea").val()),t.submit()})},n.modifyPostPreviewPage=function(){$("table > tbody > tr.tr1 > th").css({"text-align":"left","font-weight":"normal",border:"1px solid #9191ff",padding:"10px"})},n.addAttachChangeAlert=function(){$(document).on("click",'.abtn[id^="md_"]',function(){$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))})},n.importKfSmileEnhanceExtension=function(){var e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.src="https://kf.miaola.info/KfEmotion.min.user.js"+(void 0!==o.default.w.resTimestamp?"?ts="+o.default.w.resTimestamp:""),document.body.appendChild(e)},n.preventCloseWindowWhenEditPost=function(){window.addEventListener("beforeunload",function(e){var t=$("/post.php"===location.pathname?"#textarea":'textarea[name="atc_content"]'),n=t.val();if(n&&n!==t.get(0).defaultValue&&!o.default.w.isSubmit){var a="你可能正在撰写发帖内容中，确定要关闭页面吗？";return e.returnValue=a}}),$('form[action="post.php?"]').submit(function(){o.default.w.isSubmit=!0})},n.savePostContentWhenSubmit=function(){var t=$("/post.php"===location.pathname?"#textarea":'textarea[name="atc_content"]');$('form[action="post.php?"]').submit(function(){var e=t.val();0<$.trim(e).length&&sessionStorage.setItem(w.default.postContentStorageName,e)});var n=sessionStorage.getItem(w.default.postContentStorageName);n&&$('\n<div style="padding: 0 10px; line-height: 2em; text-align: left; background-color: #fefee9; border: 1px solid #99f;">\n  <a class="pd_btn_link" data-name="restore" href="#">[恢复上次提交的内容]</a>\n  <a class="pd_btn_link" data-name="clear" href="#">[清除]</a>\n</div>\n').insertBefore(t).find('[data-name="restore"]').click(function(e){e.preventDefault(),t.val(n),$(this).parent().find('[data-name="clear"]').click()}).end().find('[data-name="clear"]').click(function(e){e.preventDefault(),sessionStorage.removeItem(w.default.postContentStorageName),$(this).parent().remove()})},n.addRedundantKeywordWarning=function(){$('input[name="diy_guanjianci"]').change(function(){var e=$(this);5<$.trim(e.val()).split(",").filter(function(e){return e}).length&&(alert("所填关键词已超过5个，多余的关键词将被忽略"),e.select().focus())})},n.addFillTitleBtn=function(){$('<a class="pd_btn_link" data-name="fill" href="#" title="按照格式填充标题">填充</a>').insertAfter("#btyl").click(function(e){e.preventDefault();var t=$.trim(prompt("请按格式填写标题名称，会自动填充到相应的表单中（选填项可不填）：\n例：[诸神字幕组][Seiren][清恋][01-12合集][简繁日内挂][1080P][百度30D][3.25GB][BDRIP]\n或 [自购][新作][nostalabel]待雪の花 ～snow drop～[MEGA长期][667MB][BMP]"));if(t){var n=/(\[自购\])?(\[新作\])?(.+)\[([^\[\]]+?)(\d+D|长期)?\]\[(\d+(?:\.\d+)?(?:G|M)B?)\](?:\[([^\[\]]+)\])?/i.exec(t);n?($("#diy_titlezigou").prop("checked",void 0!==n[1]),$("#diy_xinzuo").prop("checked",void 0!==n[2]),$("#diy_titlewplx").val(n[4]),$("#diy_titleyxqx").val(n[5]?n[5]:""),$("#diy_titlezytj").val(n[6]),$("#diy_titlezygs").val(n[7]?n[7]:""),$("#diy_titlezpmc").val(n[3]).trigger("change")):alert("标题格式不符合标准")}})},n.replaceSiteLink=function(){$('form[name="FORM"]').submit(function(){var e=$(this).find('textarea[name="atc_content"]');e.length&&e.val(e.val().replace(new RegExp(location.protocol+"//"+location.hostname.replace(/\./g,"\\.")+"/(\\w+)\\.php","g"),"https://bbs.ikfol.com/$1.php"))})}},{"./Const":6,"./Info":9,"./Msg":15,"./Script":20,"./Util":23}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addChangePointsInfoTips=exports.addSlowActionChecked=exports.changeNewTipsColor=exports.showCommonImportOrExportLogDialog=exports.showCommonImportOrExportConfigDialog=exports.turnPageViaKeyboard=exports.repairBbsErrorCode=exports.addSearchDialogLink=exports.makeSearchByBelowTwoKeyWordAvailable=exports.bindSearchTypeSelectMenuClick=exports.bindElementTitleClick=exports.showElementTitleTips=exports.changeIdColor=exports.addFastNavMenu=exports.blockThread=exports.blockUsers=exports.followUsers=exports.getDailyBonus=exports.startTimingMode=exports.getNextTimingIntervalInfo=exports.addPolyfill=exports.showFormatLog=exports.preventCloseWindowWhenActioning=exports.handleSideBarLink=exports.addConfigAndLogDialogLink=exports.appendCss=exports.checkBrowserType=exports.getSafeId=exports.getUidAndUserName=void 0;var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Config=require("./Config"),_ConfigDialog=require("./ConfigDialog"),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_LogDialog=require("./LogDialog"),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_Script=require("./Script"),Script=_interopRequireWildcard(_Script),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),_Item=require("./Item"),Item=_interopRequireWildcard(_Item);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var getUidAndUserName=exports.getUidAndUserName=function(){var e=$('#kf_topuser > a[href="javascript:;"]').eq(0),t=_Info2.default.$userMenu.find('a[href^="profile.php?action=show&uid="]').eq(0);if(!e.length||!t.length)return!1;if(e.attr("id","pdUserName"),_Info2.default.userName=$.trim(e.contents().get(0).textContent),!_Info2.default.userName)return!1;var n=/&uid=(\d+)/.exec(t.attr("href"));return!!n&&(_Info2.default.uid=parseInt(n[1]),!0)},getSafeId=exports.getSafeId=function(){var e=$("input#safeid").val();if(!e){var t=/safeid=(\w+)/i.exec($('a[href*="safeid="]:first').attr("href"));t&&(e=t[1])}return e||""},checkBrowserType=exports.checkBrowserType=function(){"auto"===Config.browseType?_Info2.default.isMobile=/(Mobile|MIDP)/i.test(navigator.userAgent):_Info2.default.isMobile="mobile"===Config.browseType},appendCss=exports.appendCss=function(){$("head").append('\n<style>\n  /* 公共 */\n  .pd_highlight { color: #f00 !important; }\n  .pd_notice, .pd_msg .pd_notice { font-style: italic; color: #666; }\n  .pd_input, .pd_cfg_main input, .pd_cfg_main select {\n    vertical-align: middle; height: auto; margin-right: 0; line-height: 22px; font-size: 12px;\n  }\n  .pd_input[type="text"], .pd_input[type="number"], .pd_cfg_main input[type="text"], .pd_cfg_main input[type="number"] {\n    height: 22px; line-height: 22px;\n  }\n  .pd_input:focus, .pd_cfg_main input[type="text"]:focus, .pd_cfg_main input[type="number"]:focus, .pd_cfg_main textarea:focus,\n      .pd_textarea:focus { border-color: #7eb4ea; }\n  .pd_textarea, .pd_cfg_main textarea { border: 1px solid #ccc; font-size: 12px; }\n  .pd_btn_link { margin-left: 4px; margin-right: 4px; }\n  .pd_custom_tips { cursor: help; }\n  .pd_disabled_link { color: #999 !important; text-decoration: none !important; cursor: default; }\n  .pd_not_click_link, .pd_not_click_link:visited { color: #000; pointer-events: none; }\n  hr {\n    box-sizing: content-box; height: 0; margin-top: 7px; margin-bottom: 7px; border: 0; border-top: 1px solid rgba(0, 0, 0, .2);\n  }\n  .pd_overflow { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n  .pd_hide { width: 0 !important; height: 0 !important; font: 0/0 a; color: transparent; background-color: transparent; border: 0 !important; }\n  .pd_stat i { display: inline-block; font-style: normal; margin-right: 3px; }\n  .pd_stat_extra em, .pd_stat_extra ins { padding: 0 2px; cursor: help; }\n  .pd_panel { position: absolute; overflow-y: auto; background-color: #fff; border: 1px solid #9191ff; opacity: 0.9; }\n  .pd_title_tips {\n    position: absolute; max-width: 470px; font-size: 12px; line-height: 1.5em;\n    padding: 2px 5px; background-color: #fcfcfc; border: 1px solid #767676; z-index: 9999;\n  }\n  .pd_search_type {\n    float: left; height: 26px; line-height: 26px; width: 65px; text-align: center;\n    border: 1px solid #ccc; border-left: none; border-right: none; cursor: pointer;\n  }\n  .pd_search_type i { font-style: normal; margin-left: 5px; font-family: sans-serif; }\n  .pd_search_type_list {\n    position: absolute; width: 63px; background-color: #fcfcfc; border: 1px solid #ccc; border-top: none; line-height: 26px;\n    text-indent: 13px; cursor: pointer; z-index: 1004;\n  }\n  .pd_search_type_list li:hover { color: #fff; background-color: #87c3cf; }\n  .drow { z-index: 1001 !important; }\n  \n  /* 消息框 */\n  .pd_mask { position: fixed; width: 100%; height: 100%; left: 0; top: 0; z-index: 1000; }\n  .pd_msg_container { position: '+(_Info2.default.isMobile?"absolute":"fixed")+'; width: 100%; z-index: 1003; }\n  .pd_msg {\n    border: 1px solid #6ca7c0; text-shadow: 0 0 3px rgba(0, 0, 0, 0.1); border-radius: 3px; padding: 10px 40px; text-align: center;\n    font-size: 14px; position: absolute; display: none; color: #333; line-height: 1.6em; background: #f8fcfe; background-repeat: no-repeat;\n    background-image: -webkit-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -moz-linear-gradient(top, #f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: -ms-linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n    background-image: linear-gradient(#f9fcfe, #f6fbfe 25%, #eff7fc);\n  }\n  .pd_msg strong { margin-right: 5px; }\n  .pd_msg i { font-style: normal; padding-left: 10px; }\n  .pd_msg em, .pd_stat em, .pd_msg ins, .pd_stat ins { font-weight: 700; font-style: normal; color:#ff6600; padding: 0 3px; }\n  .pd_msg ins, .pd_stat ins { text-decoration: none; color: #339933; }\n  .pd_msg a { font-weight: bold; margin-left: 15px; }\n  \n  /* 帖子页面 */\n  .readlou .pd_goto_link { color: #000; }\n  .readlou .pd_goto_link:hover { color: #51d; }\n  .pd_fast_goto_floor, .pd_multi_quote_chk { margin-right: 2px; }\n  .pd_user_memo { font-size: 12px; color: #999; line-height: 1.2; margin-bottom: 5px; }\n  .pd_user_memo_tips { font-size: 12px; color: #999; margin-left: 5px; cursor: help; }\n  .pd_user_memo_tips:hover { color: #ddd; }\n  .readtext img[onclick] { max-width: 550px; }\n  .read_fds { text-align: left !important; font-weight: normal !important; font-style: normal !important; }\n  .pd_code_area { max-height: 550px; margin-top: 1em; overflow-y: auto; font-size: 12px; font-family: Consolas, "Courier New"; }\n  .pd_code_area .pd_copy_code { position: absolute; margin-top: -1em; min-width: 5em; text-align: center; background-color: #fcfcfc; }\n  .pd_good_post_mark { outline: 3px solid #f00; outline-offset: -3px; }\n  \n  /* 我的物品页面 */\n  .pd_item_btns { text-align: right; margin-top: 5px;  }\n  .pd_item_btns button, .pd_item_btns input { margin-bottom: 2px; vertical-align: middle; }\n  .pd_result { border: 1px solid #99f; padding: 5px; margin-top: 10px; line-height: 2em; }\n  .pd_arm_equipped { background-color:#eef; -webkit-box-shadow: 0 0 7px #99f; box-shadow: 0 0 7px #99f; }\n  .pd_arm_equipped > td:nth-child(3)::before { content: "（装备中）"; font-weight: bold; }\n  .pd_arm_equipped a[data-name="equip"], .pd_arm_equipped a[data-name="smelt"] { color: #777; pointer-events: none; }\n  .kf_fw_ig4 > tbody > tr > td { position: relative; }\n  .kf_fw_ig4 > tbody > tr > td[data-memo]::after {\n    content: "(" attr(data-memo) ")"; position: absolute; bottom: 0; right: 5px; padding: 0 5px; color: #777; background: rgba(252, 252, 252, .7);\n  }\n  .kf_fw_ig4 > tbody > .pd_arm_equipped > td[data-memo]::after { background: rgba(238, 238, 255, .7); }\n  .kf_fw_ig4 > tbody > tr > td > input[name="armCheck"] { position: absolute; top: 0; left: 5px; }\n  .show_arm_info { position: absolute; top: 0; right: 0; padding: 0 10px; background: rgba(252, 252, 252, .9); }\n  .pd_arm_equipped .show_arm_info { background: rgba(238, 238, 255, .9); }\n  .pd_useless_sub_property { color: #999; text-decoration: line-through; }\n  .pd_arm_id { font-style: normal; color: #999; }\n  .pd_new_arm_mark { font-style: normal; color: #f00; }\n  \n  /* 发帖页面 */\n  #pdSmilePanel img { margin: 3px; cursor: pointer; }\n  .editor-button .pd_editor_btn { background: none; text-indent: 0; line-height: 18px; cursor: default; }\n  .pd_post_extra_option { text-align: left; margin: 5px; }\n  .pd_post_extra_option input { vertical-align: middle; height: auto; margin-right: 0; }\n  \n  /* 其它页面 */\n  .pd_thread_page { margin-left: 5px; }\n  .pd_thread_page a { color: #444; padding: 0 3px; }\n  .pd_thread_page a:hover { color: #51d; }\n  .pd_card_chk { position: absolute; bottom: -8px; left: 1px; }\n  .indexlbtit2 .pd_thread_goto, .rightlbtit .pd_thread_goto {\n    position: absolute; top: 0; right: 0; margin: 0; padding: 0; width: 65px; border: none;\n  }\n  .indexlbtit2 .pd_thread_goto:hover, .rightlbtit .pd_thread_goto:hover { border: none; }\n  .pd_id_color_select > td { position: relative; cursor: pointer; }\n  .pd_id_color_select > td > input { position: absolute; top: 18px; left: 10px; }\n  #pdPropertiesArea td { position: relative; }\n  #pdPropertiesArea input[type="text"] { width: 211px; }\n  .pd_property_diff { position: absolute; top: 0px; right: 5px; }\n  .pd_property_diff em { font-style: normal; }\n  .rightbox1 { overflow: hidden; }\n  .pd_rightbox1_gray, .pd_rightbox1_gray:visited, .pd_rightbox1_gray:hover { color: #b0b0ff; border-color: #b0b0ff; }\n\n  /* 设置对话框 */\n  .pd_cfg_ml { margin-left: 10px; }\n  .pd_cfg_box {\n    position: '+(_Info2.default.isMobile?"absolute":"fixed")+'; border: 1px solid #9191ff; display: none; z-index: 1002;\n    -webkit-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);\n  }\n  .pd_cfg_box h1 {\n    text-align: center; font-size: 14px; background-color: #9191ff; color: #fff; line-height: 2em; margin: 0; padding-left: 20px;\n  }\n  .pd_cfg_box h1 span { float: right; cursor: pointer; padding: 0 10px; }\n  .pd_cfg_nav { text-align: right; margin-top: 5px; margin-bottom: -5px; }\n  .pd_cfg_main { background-color: #fcfcfc; padding: 0 10px; font-size: 12px; line-height: 24px; min-height: 50px; overflow: auto; }\n  .pd_cfg_main fieldset { border: 1px solid #ccccff; padding: 0 6px 6px; }\n  .pd_cfg_main legend { font-weight: bold; }\n  .pd_cfg_main input[type="color"] { height: 18px; width: 30px; padding: 0; }\n  .pd_cfg_tips { color: #51d; text-decoration: none; cursor: help; }\n  .pd_cfg_tips:hover { color: #ff0000; }\n  #pdConfigDialog .pd_cfg_main { overflow-x: hidden; white-space: nowrap; }\n  .pd_cfg_panel { display: inline-block; width: 400px; vertical-align: top; }\n  .pd_cfg_panel + .pd_cfg_panel { margin-left: 5px; }\n  .pd_cfg_btns { background-color: #fcfcfc; text-align: right; padding: 5px; }\n  .pd_cfg_btns input, .pd_cfg_btns button { vertical-align: middle; }\n  .pd_cfg_btns button { min-width: 80px; }\n  .pd_cfg_about { float: left; line-height: 24px; margin-left: 5px; }\n  .pd_custom_script_header { margin: 7px 0; padding: 5px; background-color: #e8e8e8; border-radius: 5px; }\n  .pd_custom_script_content { display: none; width: 750px; height: 350px; white-space: pre; }\n\n  /* 日志对话框 */\n  .pd_log_nav { text-align: center; margin: -5px 0 -12px; font-size: 14px; line-height: 44px; }\n  .pd_log_nav a { display: inline-block; }\n  .pd_log_nav h2 { display: inline; font-size: 14px; margin-left: 7px; margin-right: 7px; }\n  .pd_log_content { height: 242px; overflow: auto; }\n  .pd_log_content h3 { display: inline-block; font-size: 12px; line-height: 22px; margin: 0; }\n  .pd_log_content h3:not(:first-child) { margin-top: 5px; }\n  .pd_log_content p { line-height: 22px; margin: 0; }\n</style>\n'),"/read.php"===location.pathname&&(0<Config.threadContentFontSize||Config.adjustThreadContentWidthEnabled)&&$("head").append("\n<style>\n  .readtext > table > tbody > tr > td {\n    width: "+(Config.adjustThreadContentWidthEnabled?643.2:823.2)+"px;\n    display: inline-block;\n    overflow-wrap: break-word;\n  }\n  .readtext > table > tbody > tr > td table { word-break: break-all; }\n</style>\n"),Config.customCssEnabled&&$("head").append("<style>"+Config.customCssContent+"</style>")},addConfigAndLogDialogLink=exports.addConfigAndLogDialogLink=function(){$('\n<li><a data-name="openConfigDialog" href="#">助手设置</a></li>\n<li><a data-name="openLogDialog" href="#">助手日志</a></li>\n').appendTo(_Info2.default.$userMenu).find('[data-name="openConfigDialog"]').click(function(e){e.preventDefault(),(0,_ConfigDialog.show)()}).end().find('[data-name="openLogDialog"]').click(function(e){e.preventDefault(),(0,_LogDialog.show)()})},handleSideBarLink=exports.handleSideBarLink=function(){var e=$('a.rightbox1[title="网站虚拟货币"]');e.attr("id","pdKfb");var t=/(-?\d+)KFB\s*\|\s*(-?\d+(?:\.\d+)?)贡献/.exec(e.text());if(t){var n=parseInt(t[1]),a=parseFloat(t[2]);e.html("<b>"+n.toLocaleString()+"</b>KFB | <b>"+a.toLocaleString()+"</b>贡献").attr("data-kfb",n).attr("data-gongxian",a)}var o=$('a.rightbox1[href="kf_growup.php"]');if(o.attr("id","pdSmLevel"),t=/神秘(-?\d+)级 \(系数排名第\s*(\d+\+?)\s*位/.exec(o.text())){var i=parseInt(t[1]),r=t[2];o.html("神秘<b>"+i.toLocaleString()+'</b>级 (系数排名第<b style="color: #00f;">'+r+"</b>位)").attr("data-sm-level",i).attr("data-sm-rank",r)}$('a.rightbox1[href="kf_fw_ig_index.php"]').attr("id","pdLoot")},preventCloseWindowWhenActioning=exports.preventCloseWindowWhenActioning=function(e){if(0<$(".pd_mask").length){var t="操作正在进行中，确定要关闭页面吗？";return e.returnValue=t}},showFormatLog=exports.showFormatLog=function(e,t){var n=Util.getResponseMsg(t),a=n.msg,o=n.url;console.log("【"+e+"】回应："+a+(o?"；跳转地址："+Util.getHostNameUrl()+o:""))},addPolyfill=exports.addPolyfill=function(){Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var a=parseInt(arguments[1])||0,o=void 0;0<=a?o=a:(o=n+a)<0&&(o=0);for(var i=void 0;o<n;){if(e===(i=t[o])||e!=e&&i!=i)return!0;o++}return!1}),String.prototype.padStart||(String.prototype.padStart=function(e,t){var n=1<arguments.length&&void 0!==t?t:" ",a=Object(this),o=String(a),i=parseInt(e)||0,r=parseInt(o.length)||0;if(i<=r)return o;var l=void 0===n?" ":String(n);if(""===l)return o;for(var d=i-r;l.length<d;){var s=l.length,c=d-s;l+=c<s?l.slice(0,c):l}return l.slice(0,d)+o}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){var n=1<arguments.length&&void 0!==t?t:" ",a=Object(this),o=String(a),i=parseInt(e)||0,r=parseInt(o.length)||0;if(i<=r)return o;var l=void 0===n?" ":String(n);if(""===l)return o;for(var d=i-r;l.length<d;){var s=l.length,c=d-s;l+=c<s?l.slice(0,c):l}return o+l.slice(0,d)})},getNextTimingIntervalInfo=exports.getNextTimingIntervalInfo=function(){var e=-1;if(Config.autoPromoteHaloEnabled){var t=parseInt(Util.getCookie(_Const2.default.promoteHaloCookieName));e=0<t?Math.floor((t-$.now())/1e3):0}var n=-1;if(Config.autoGetDailyBonusEnabled){var a=parseInt(Util.getCookie(_Const2.default.getDailyBonusCookieName));if(0<a){var o=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);o.setDate(o.getDate()+1);var i=new Date;o<i&&o.setDate(o.getDate()+1),n=Math.floor((o-i)/1e3)}else n=a<0?60*_Const2.default.getDailyBonusSpecialInterval:0}var r=-1;if(Config.autoBuyItemEnabled){var l=Util.getDateByTime(Config.buyItemAfterTime),d=new Date;r=Util.getCookie(_Const2.default.buyItemReadyCookieName)?300:Util.getCookie(_Const2.default.buyItemCookieName)||d<l?(l<d&&l.setDate(l.getDate()+1),Math.floor((l-d)/1e3)):0}var s=[{action:"提升战力光环",interval:e},{action:"检查争夺情况",interval:-1},{action:"自动获取每日奖励",interval:n},{action:"自动购买物品",interval:r}],c="",u=-1,p=!0,f=!1,m=void 0;try{for(var g,h=s.filter(function(e){return-1<e.interval})[Symbol.iterator]();!(p=(g=h.next()).done);p=!0){var v=g.value,b=v.action,y=v.interval;(u<0||y<u)&&(c=b,u=y)}}catch(e){f=!0,m=e}finally{try{!p&&h.return&&h.return()}finally{if(f)throw m}}return{action:0<u?c:"",interval:u+1}},startTimingMode=exports.startTimingMode=function(){var e=getNextTimingIntervalInfo(),t=e.action,n=e.interval;if(-1!==n){var l=document.title,d=null,o=-1,i=0,s=function(e,t){var n=Util.getTimeDiffInfo(Util.getDate("+"+t+"s").getTime()),a=0<n.hours?n.hours+"时":"";return a+=1===e?(0<n.minutes?n.minutes+"分":"")+n.seconds+"秒":n.minutes+"分"},r=function(e,t,n){var a=1<arguments.length&&void 0!==t?t:"",o=2<arguments.length&&void 0!==n&&n;d&&window.clearInterval(d);var i=e;if(console.log("【定时模式】倒计时"+(a?"("+a+")":"")+"："+s(1,i)),"never"!==Config.showTimingModeTipsType.toLowerCase()){var r=function(){document.title=l+" (定时: "+s(e<60?1:2,i)+")",i=e<60?i-1:i-60};o||"always"===Config.showTimingModeTipsType.toLowerCase()||e<60?r():i=e<60?i-1:i-60,d=setInterval(r,60*_Const2.default.showRefreshModeTipsInterval*1e3)}},c=function e(){Msg.remove($(".pd_refresh_notice").parent()),$(document).clearQueue("AutoAction"),Config.autoPromoteHaloEnabled&&!Util.getCookie(_Const2.default.promoteHaloCookieName)&&$(document).queue("AutoAction",function(){return Loot.getPromoteHaloInfo()}),Config.autoGetDailyBonusEnabled&&!Util.getCookie(_Const2.default.getDailyBonusCookieName)&&$(document).queue("AutoAction",function(){return getDailyBonus()}),!Config.autoBuyItemEnabled||Util.getCookie(_Const2.default.buyItemCookieName)||Util.getCookie(_Const2.default.buyItemReadyCookieName)||$(document).queue("AutoAction",function(){return Item.buyItems(Config.buyItemIdList)}),Config.autoOpenBoxesAfterLootEnabled&&TmpLog.getValue(_Const2.default.autoOpenBoxesAfterLootTmpLogName)&&!/kf_fw_ig_mybp\.php\?openboxes=true/.test(location.href)&&($(document).clearQueue("AutoAction"),$(document).queue("AutoAction",function(){setTimeout(function(){return location.href="kf_fw_ig_mybp.php?openboxes=true"},_Const2.default.minActionInterval)})),$(document).dequeue("AutoAction");var t=getNextTimingIntervalInfo(),n=t.action,a=t.interval;if(0<a&&(i=0),0===a&&0===o)return o=-1,void function e(){var t=0,n="";$.ajax({type:"GET",url:"index.php?t="+$.now(),timeout:_Const2.default.defAjaxTimeout,success:function(e){/"kf_fw_ig_index.php"/.test(e)||(t=10,n="论坛维护或其它未知情况")},error:function(){t=_Const2.default.errorRefreshInterval,n="连接超时"},complete:function(){0<t?(console.log("定时操作失败（原因："+n+"），将在"+t+"分钟后重试..."),Msg.remove($(".pd_refresh_notice").parent()),Msg.show('<strong class="pd_refresh_notice">定时操作失败（原因：'+n+"），将在<em>"+t+"</em>分钟后重试&hellip;</strong>",-1),setTimeout(e,60*t*1e3),r(60*t,"",!0)):6<i?(i=0,t=15,setTimeout(c,60*t*1e3),r(60*t,"",!0)):(i++,c())}})}();-1!==(o=a)?(0===a&&(a=_Const2.default.actionFinishRetryInterval),setTimeout(e,1e3*a),r(a,n,!0)):d&&clearInterval(d)};setTimeout(c,n<60?6e4:1e3*n),r(n<60?60:n,t)}},getDailyBonus=exports.getDailyBonus=function e(){Script.runFunc("Public.getDailyBonus_before_"),console.log("领取每日奖励Start");function f(){var e=Util.getTimezoneDateByTime(_Const2.default.getDailyBonusAfterTime);return e.setDate(e.getDate()+1),new Date>e&&e.setDate(e.getDate()+1),e}var m=Msg.wait("<strong>正在领取每日奖励，请稍候&hellip;</strong>");$.ajax({type:"GET",url:"kf_growup.php?t="+$.now(),timeout:_Const2.default.defAjaxTimeout}).done(function(e){var t=/<a href="(kf_growup\.php\?ok=3&safeid=\w+)" target="_self">你可以领取\s*(\d+)KFB\s*\+\s*(\d+)经验\s*\+\s*(\d+(?:\.\d+)?)贡献\s*\+\s*(\d+)转账额度/.exec(e);if(t){if(Config.getBonusAfterLootCompleteEnabled&&!/<div class="gro_divlv">\r\n争夺奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(m);if(Config.getBonusAfterSpeakCompleteEnabled&&!/<div class="gro_divlv">\r\n发言奖励/.test(e))return Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+"+_Const2.default.getDailyBonusSpecialInterval+"m")),void Msg.remove(m);var n=t[1],p={};0<parseInt(t[2])&&(p.KFB=parseInt(t[2])),0<parseInt(t[3])&&(p["经验值"]=parseInt(t[3])),0<parseFloat(t[4])&&(p["贡献"]=parseFloat(t[4])),0<parseInt(t[5])&&(p["转账额度"]=parseInt(t[5])),$.get(n+"&t="+$.now(),function(e){showFormatLog("领取每日奖励",e);var t=Util.getResponseMsg(e).msg;if(Msg.remove(m),/领取成功/.test(t)){Util.setCookie(_Const2.default.getDailyBonusCookieName,1,f());var n="",a="",o=!0,i=!1,r=void 0;try{for(var l,d=Util.entries(p)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=_slicedToArray(l.value,2),c=s[0],u=s[1];n+=c+"+"+u+" ",a+="<i>"+c+"<em>+"+u.toLocaleString()+"</em></i>"}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}console.log("领取每日奖励，"+n),Msg.show("<strong>领取每日奖励</strong>"+a),$.isEmptyObject(p)||Log.push("领取每日奖励","领取每日奖励",{gain:p}),0<Config.promoteHaloLimit&&Util.deleteCookie(_Const2.default.promoteHaloCookieName)}else Util.setCookie(_Const2.default.getDailyBonusCookieName,-1,Util.getDate("+5m"));Script.runFunc("Public.getDailyBonus_after_",t)}).fail(function(){return Msg.remove(m)})}else Msg.remove(m),Util.setCookie(_Const2.default.getDailyBonusCookieName,1,f())}).fail(function(){Msg.remove(m),$(document).queue("AutoAction",function(){setTimeout(e,_Const2.default.defAjaxInterval)})}).always(function(){setTimeout(function(){return $(document).dequeue("AutoAction")},_Const2.default.minActionInterval)})},followUsers=exports.followUsers=function(){Config.followUserList.length&&(_Info2.default.isInHomePage&&Config.highlightFollowUserThreadInHPEnabled||("/thread.php"===location.pathname?$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.text(),Config.followUserList)&&(e.addClass("pd_highlight"),Config.highlightFollowUserThreadLinkEnabled&&e.parent("td").prev("td").prev("td").find('div > a[href^="read.php?tid="]').addClass("pd_highlight"))}):"/read.php"===location.pathname?$('.readidmsbottom > a[href^="profile.php?action=show"], .readidmbottom > a[href^="profile.php?action=show"]').each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(Util.getFloorUserName(e.text()),Config.followUserList)&&e.closest(".readlou").next(".readlou").find("div:nth-child(2) > span:first-child > a").addClass("pd_highlight")}):"/guanjianci.php"===location.pathname||"/kf_share.php"===location.pathname?$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.text(),Config.followUserList)&&e.addClass("pd_highlight")}):"/search.php"===location.pathname&&$('.thread1 a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.text(),Config.followUserList)&&e.addClass("pd_highlight")})))},blockUsers=exports.blockUsers=function(){if(Config.blockUserList.length){var i=0;if(!_Info2.default.isInHomePage){if("/thread.php"===location.pathname){var e=parseInt($('input[name="f_fid"]:first').val());if(!e)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(e))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(e))return;$('a.bl[href^="profile.php?action=show&uid="]').each(function(){var e=$(this),t=Util.inFollowOrBlockUserList(e.text(),Config.blockUserList);-1<t&&Config.blockUserList[t].type<2&&(i++,e.closest("tr").remove())})}else if("/read.php"===location.pathname){if(0<Config.blockUserForumType){var t=parseInt($('input[name="fid"]:first').val());if(!t)return;if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(t))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(t))return}var r=Util.getCurrentThreadPage();$('.readidmsbottom > a[href^="profile.php?action=show"], .readidmbottom > a[href^="profile.php?action=show"]').each(function(e){var t=$(this),n=Util.inFollowOrBlockUserList(Util.getFloorUserName(t.text()),Config.blockUserList);if(-1<n){var a=Config.blockUserList[n].type;if(0===e&&1===r&&1<a)return;if((0===e&&1!==r||0<e)&&1===a)return;i++;var o=t.closest(".readlou");o.next(".readlou").remove(),o.next('div[id^="floor"]').remove(),o.next(".readtext").remove(),o.next(".readlou").remove(),o.remove()}}),$('.readtext fieldset:has(legend:contains("Quote:"))').each(function(){var e=$(this),t=e.text(),n=!0,a=!1,o=void 0;try{for(var i,r=Config.blockUserList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(1!==l.type)try{var d=new RegExp("^Quote:引用(第\\d+楼|楼主)"+l.name+"于","i"),s=new RegExp("^Quote:回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(d.test(t)||s.test(t))&&e.html('<legend>Quote:</legend><mark class="pd_custom_tips" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}})}else"/guanjianci.php"===location.pathname&&Config.blockUserAtTipsEnabled&&$(".kf_share1 > tbody > tr > td:last-child").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.text(),Config.blockUserList)&&(i++,e.closest("tr").remove())});0<i&&console.log("【屏蔽用户】共有"+i+"个帖子或回复被屏蔽")}}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _iterator4=Config.blockThreadList[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _step4$value=_step4.value,keyWord=_step4$value.keyWord,includeUser=_step4$value.includeUser,excludeUser=_step4$value.excludeUser,includeFid=_step4$value.includeFid,excludeFid=_step4$value.excludeFid,regex=null;if(/^\/.+\/[gimuy]*$/.test(keyWord))try{regex=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(includeUser){if(!includeUser.includes(userName))continue}else if(excludeUser&&excludeUser.includes(userName))continue;if(fid)if(includeFid){if(!includeFid.includes(fid))continue}else if(excludeFid&&excludeFid.includes(fid))continue;if(regex){if(regex.test(title))return!0}else if(title.toLowerCase().includes(keyWord.toLowerCase()))return!0}}catch(e){_didIteratorError4=!0,_iteratorError4=e}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return!1},num=0;if(!_Info2.default.isInHomePage){if("/thread.php"===location.pathname){var fid=parseInt($('input[name="f_fid"]:first').val());if(!fid)return;$('.threadtit1 a[href^="read.php"]').each(function(){var e=$(this);isBlock(e.text(),e.closest("tr").find("td:last-child > a.bl").text(),fid)&&(num++,e.closest("tr").remove())})}else if("/read.php"===location.pathname){if(1!==Util.getCurrentThreadPage())return;var title=Read.getThreadTitle();if(!title)return;var $userName=$('.readidmsbottom > a[href^="profile.php?action=show"], .readidmbottom > a[href^="profile.php?action=show"]').eq(0);if("楼主"!==$userName.closest(".readlou").next(".readlou").find("> div:nth-child(2) > span:first-child").text().trim())return;var userName=Util.getFloorUserName($userName.text());if(!userName)return;var _fid2=parseInt($('input[name="fid"]:first').val());if(!_fid2)return;if(isBlock(title,userName,_fid2)){num++;var $floor=$userName.closest(".readlou");$floor.next(".readlou").remove(),$floor.next('div[id^="floor"]').remove(),$floor.next(".readtext").remove(),$floor.next(".readlou").remove(),$floor.remove()}}0<num&&console.log("【屏蔽帖子】共有"+num+"个帖子被屏蔽")}}},addFastNavMenu=exports.addFastNavMenu=function(){var e=$('.drow > .dcol > .topmenuo > .topmenuo1 > .topmenuo3:nth-last-child(2) > a:contains("最新共享")');e.length&&(e.text("快捷导航").attr("href","javascript:;").after('\n<ul class="topmenuo2">\n  <li><a href="kf_share.php">最新共享</a></li>\n  <li><a href="search.php?authorid='+_Info2.default.uid+'">我的主题</a></li>\n  <li><a href="personal.php?action=post">我的回复</a></li>\n  <li><a href="kf_fw_ig_index.php">争夺奖励</a></li>\n  <li><a href="kf_fw_ig_mybp.php">我的物品</a></li>\n  <li><a href="kf_fw_ig_shop.php">物品商店</a></li>\n  <li><a href="kf_fw_ig_mycard.php">角色卡片</a></li>\n  <li><a href="kf_fw_ig_halo.php">战力光环</a></li>\n  <li><a href="profile.php?action=favor">收藏</a></li>\n  <li><a href="profile.php?action=friend">好友列表</a></li>\n  '+(_Info2.default.isInSpecialDomain?'<li><a href="https://m.miaola.info/" target="_blank">移动版</a></li>':"")+"\n  "+_Const2.default.customFastNavMenuContent+"\n</ul>"),Config.adminMemberEnabled&&$('.drow > .dcol > .topmenuo > .topmenuo1 > .topmenuo3:nth-last-child(3) > a:contains("聊天交流")').next("ul").append('<li><a href="thread.php?fid=93">内部管理专用</a></li>'))},changeIdColor=exports.changeIdColor=function(){if(Config.changeAllAvailableIdColorEnabled||!(Config.customAutoChangeIdColorList.length<=1)){var D=function(){var e=Util.getDate("+"+Config.autoChangeIdColorInterval+"h");Util.setCookie(_Const2.default.autoChangeIdColorCookieName,e.getTime(),e)};console.log("自动更换ID颜色Start"),$.get("kf_growup.php?t="+$.now(),function(e){if(!Util.getCookie(_Const2.default.autoChangeIdColorCookieName)){var t=e.match(/href="kf_growup\.php\?ok=2&safeid=\w+&color=\d+"/g);if(t){var n="",a=/safeid=(\w+)&/i.exec(t[0]);if(a&&(n=a[1]),!n)return void D();var o=[];for(var i in t){var r=/color=(\d+)/i.exec(t[i]);r&&o.push(parseInt(r[1]))}var l=o;if(!Config.changeAllAvailableIdColorEnabled){var d=!0,s=!(l=[]),c=void 0;try{for(var u,p=Config.customAutoChangeIdColorList[Symbol.iterator]();!(d=(u=p.next()).done);d=!0){var f=u.value;o.includes(f)&&l.push(f)}}catch(e){s=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(s)throw c}}}if(l.length<=1)return void D();var m=parseInt(TmpLog.getValue(_Const2.default.prevAutoChangeIdColorTmpLogName));(isNaN(m)||m<0)&&(m=0);var g=0;if("sequence"===Config.autoChangeIdColorType.toLowerCase()){var h=!0,v=!1,b=void 0;try{for(var y,_=l.entries()[Symbol.iterator]();!(h=(y=_.next()).done);h=!0){var x=_slicedToArray(y.value,2),k=(x[0],x[1]);if(m<k){g=k;break}}}catch(e){v=!0,b=e}finally{try{!h&&_.return&&_.return()}finally{if(v)throw b}}0===g&&(g=l[0])}else{var C=!0,w=!1,I=void 0;try{for(var L,S=l.entries()[Symbol.iterator]();!(C=(L=S.next()).done);C=!0){var A=_slicedToArray(L.value,2),T=A[0];if(A[1]===m){l.splice(T,1);break}}}catch(e){w=!0,I=e}finally{try{!C&&S.return&&S.return()}finally{if(w)throw I}}g=l[Math.floor(Math.random()*l.length)]}$.get("kf_growup.php?ok=2&safeid="+n+"&color="+g+"&t="+$.now(),function(e){D(),showFormatLog("自动更换ID颜色",e);var t=Util.getResponseMsg(e).msg;/等级颜色修改完毕/.test(t)&&(console.log("ID颜色更换为："+g),TmpLog.setValue(_Const2.default.prevAutoChangeIdColorTmpLogName,g))})}else D()}})}},showElementTitleTips=exports.showElementTitleTips=function(e,t){$(".pd_title_tips").remove(),t&&e.originalEvent&&$('<div class="pd_title_tips">'+t.replace(/\n/g,"<br>")+"</div>").appendTo("body").css("left",e.originalEvent.pageX-20).css("top",e.originalEvent.pageY+15)},bindElementTitleClick=exports.bindElementTitleClick=function(){var n=["A","IMG","INPUT","BUTTON","TEXTAREA","SELECT"];$(document).click(function(e){var t=e.target;!t.title&&!n.includes(t.nodeName)&&t.parentNode&&t.parentNode.title&&(t=t.parentNode),!t.title||n.includes(t.nodeName)||t.id&&t.id.startsWith("wy_")||$(t).is(".pd_editor_btn")?$(".pd_title_tips").remove():showElementTitleTips(e,t.title)})},bindSearchTypeSelectMenuClick=exports.bindSearchTypeSelectMenuClick=function(){$(document).on("click",".pd_search_type",function(){var o=$(this),i=$(".pd_search_type_list");if(0<i.length)i.remove();else{var e=o.data("type");i=$('\n<ul class="pd_search_type_list">\n  <li>标题</li><li>作者</li><li>关键词</li><li '+(Config.adminMemberEnabled?"":"hidden")+">用户名</li>\n</ul>").appendTo("body");var t=o.offset();i.css("top",t.top+o.height()+2).css("left",t.left+1),"dialog"===e&&i.css({width:"65px",left:t.left-1}),i.on("click","li",function(){var e=$(this).text().trim(),t=o.closest("form"),n=t.find('input[name="keyword"], input[name="pwuser"]');o.find("span").text(e),"关键词"!==e&&"用户名"!==e&&t.attr("action","search.php?"),"作者"===e?n.attr("name","pwuser"):n.attr("name","keyword");var a=t.find('[name="searchRange"][value="current"]');0<a.length&&a.prop("disabled","关键词"===e||"用户名"===e||!a.data("enabled")),i.remove(),n.focus()})}}),$(document).on("submit",'form[name="pdSearchForm"]',function(){var e=$(this),t=$.trim(e.find(".pd_search_type > span").text());"关键词"===t?e.attr("action","guanjianci.php?gjc="+e.find('input[name="keyword"]').val()):"用户名"===t&&e.attr("action","profile.php?action=show&username="+e.find('input[name="keyword"]').val())})},makeSearchByBelowTwoKeyWordAvailable=exports.makeSearchByBelowTwoKeyWordAvailable=function(){$(document).on("submit",'form[action="search.php?"]',function(){var e=$(this).find('input[name="keyword"]');if(e.length){var t=$.trim(e.val());!t||2<Util.getStrByteLen(t)||(e.val(t+" "+t),setTimeout(function(){e.val(t)},200))}})},addSearchDialogLink=exports.addSearchDialogLink=function(){$('<li><a data-name="search" href="#">搜索</a></li>').insertBefore(_Info2.default.$userMenu.find("> li:nth-last-child(3)")).find('[data-name="search"]').click(function(e){e.preventDefault();var t="pdSearchDialog";if(!(0<$("#"+t).length)){var n=Dialog.create(t,"搜索",'\n<div class="pd_cfg_main">\n  <input name="step" value="2" type="hidden">\n  <input name="method" value="AND" type="hidden">\n  <input name="sch_area" value="0" type="hidden">\n  <input name="s_type" value="forum" type="hidden">\n  <input name="f_fid" value="all" type="hidden">\n  <input name="orderway" value="lastpost" type="hidden">\n  <input name="asc" value="DESC" type="hidden">\n  <div style="margin-top: 15px;">\n    <input class="pd_input" name="keyword" type="search" style="float: left; width: 175px; line-height: 26px;" placeholder="关键字">\n    <div class="pd_search_type" data-type="dialog"><span>标题</span><i>∨</i></div>\n    <button class="indloginm" name="submit" type="submit">搜索</button>\n  </div>\n  <div style="margin-bottom: 8px; line-height: 35px;">\n    <label><input name="searchRange" type="radio" value="all" checked> 全站 </label>\n    <label><input name="searchRange" type="radio" value="current" disabled> 本版</label>\n  </div>\n</div>');n.closest("form").attr({name:"pdSearchForm",action:"search.php?",method:"post",target:"_blank"}).off("submit");var a=parseInt($('input[name="f_fid"]:first, input[name="fid"]:first').val());a&&(n.find('[name="searchRange"]').click(function(){var e=$(this);n.find('input[name="f_fid"]').val("current"===e.val()?a:"all")}),n.find('[name="searchRange"][value="current"]').prop("disabled",!1).data("enabled",!0).click()),n.keydown(function(e){27===e.keyCode&&$(".pd_search_type_list").remove()}).find("h1 > span").click(function(){$(".pd_search_type_list").remove()}),Dialog.show(t),n.find('[name="keyword"]').focus()}})},repairBbsErrorCode=exports.repairBbsErrorCode=function(){_Info2.default.w.is_ie=!1,"/read.php"===location.pathname&&(_Info2.default.w.strlen=Util.getStrByteLen)},turnPageViaKeyboard=exports.turnPageViaKeyboard=function(){$(document).keydown(function(e){if((37===e.keyCode||39===e.keyCode)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=$(".pages:first");if(t.find('li > a[href="javascript:;"]').length){var n=Util.getCurrentThreadPage(),a="";if(37===e.keyCode){if(n<=1)return;a=t.find('li > a:contains("上一页")').attr("href")}else{var o=/&page=(\d+)/.exec(t.find("li:last-child > a").attr("href"));if(!o)return;if(n>=parseInt(o[1]))return;a=t.find('li > a:contains("下一页")').attr("href")}location.href=a}}})},showCommonImportOrExportConfigDialog=exports.showCommonImportOrExportConfigDialog=function(e,n,t,a){var o="pdCommonImOrExConfigDialog";if(!(0<$("#"+o).length)){(0,_Config.read)();var i=Dialog.create(o,"导入或导出"+e,'\n<div class="pd_cfg_main">\n  <div>\n    <strong>导入设置：</strong>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n    <strong>导出设置：</strong>复制文本框里的内容并粘贴到别处即可\n  </div>\n  <textarea name="commonConfig" style="width: 500px; height: 300px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"></span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n</div>'),r="object"===$.type(n)?n.read():Config[n];i.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(i.find('[name="commonConfig"]').val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}t&&$.type(t)===$.type(r)?("object"===$.type(n)?n.write(t):(Config[n]=t,(0,_Config.write)()),alert("设置已导入"),Dialog.close(o),"function"==typeof a?a():location.reload()):alert("设置有错误")}}}),Dialog.show(o),i.find('[name="commonConfig"]').val(JSON.stringify(r)).select().focus(),"function"==typeof t&&t(i),Script.runFunc("Public.showCommonImportOrExportConfigDialog_after_",{title:e,configName:n})}},showCommonImportOrExportLogDialog=exports.showCommonImportOrExportLogDialog=function(e){var a=e.name,t=e.read,o=e.write,i=e.merge,n=e.callback,r=e.callbackAfterSubmit,l="pdCommonImOrExLogDialog";if(!(0<$("#"+l).length)){var d=t(),s='\n<div class="pd_cfg_main">\n  <strong>导入'+a+"：</strong>将"+a+"内容粘贴到文本框中并点击合并或覆盖按钮即可<br>\n  <strong>导出"+a+'：</strong>复制文本框里的内容并粘贴到别处即可<br>\n  <textarea name="log" style="width: 600px; height: 400px; word-break: break-all;"></textarea>\n</div>\n<div class="pd_cfg_btns">\n  <button name="merge" type="button" '+("function"!=typeof i?"hidden":"")+'>合并记录</button>\n  <button name="overwrite" type="button" style="color: #f00;">覆盖记录</button>\n  <button data-action="close" type="button">关闭</button>\n</div>',c=Dialog.create(l,"导入或导出"+a,s);c.find('[name="merge"], [name="overwrite"]').click(function(e){e.preventDefault();var t=$(this).attr("name");if(confirm("是否将文本框中的"+a+("overwrite"===t?"覆盖":"合并")+"到本地？")){var n=$.trim(c.find('[name="log"]').val());if(n){try{n=JSON.parse(n)}catch(e){return void alert(a+"有错误")}n&&"object"===$.type(n)?(d="merge"===t&&"function"==typeof i?i(d,n):n,o(d),alert(a+"已导入"),"function"==typeof r?r():location.reload()):alert(a+"有错误")}}}),Dialog.show(l),c.find('[name="log"]').val(JSON.stringify(d)).select().focus(),"function"==typeof n&&n(c),Script.runFunc("Public.showCommonImportOrExportLogDialog_after_",{name:a,read:t,write:o,merge:i})}},changeNewTipsColor=exports.changeNewTipsColor=function(){var e=$("#pdUserName").find("span:first");e.length&&(e.addClass("pd_new_tips"),0<_Info2.default.$userMenu.find('a[href="message.php"]:contains("有新消息")').length?e.attr("id","pdNewMsgTips").css({color:"#0099cc"}):0<_Info2.default.$userMenu.find('a[href^="guanjianci.php?gjc="]:contains("有人@我")').length?e.attr("id","pdNewReplyTips"):0<_Info2.default.$userMenu.find('a[href="kf_fw_1wkfb.php?ping=3"]:contains("有新评分")').length&&e.attr("id","pdNewRateTips").css({color:"#5cb85c"}))},addSlowActionChecked=exports.addSlowActionChecked=function(e){$('\n<label style="margin-right: 5px;">\n  <input name="slowActionEnabled" type="checkbox" '+(Config.slowActionEnabled?"checked":"")+'> 慢速操作\n  <span class="pd_cfg_tips" title="延长部分批量操作的时间间隔（在3~7秒之间），如使用道具、打开盒子等">[?]</span>\n</label>\n').prependTo(e).find('input[name="slowActionEnabled"]').click(function(){var e=$(this).prop("checked");$('input[name="slowActionEnabled"]').not(this).prop("checked",e),Config.slowActionEnabled!==e&&((0,_Config.read)(),Config.slowActionEnabled=e,(0,_Config.write)())})},addChangePointsInfoTips=exports.addChangePointsInfoTips=function e(){var t=Util.getCookie(_Const2.default.changePointsInfoCookieName);if(t){var n="";if($.isNumeric(t)){var a=parseInt(t)-$.now();if(0<a){var o=Math.ceil(a/60/1e3),i=Math.floor(o/60);n=(0<i?i+"时":"")+(o-=60*i)+"分"}}else n=parseInt(t)+"次";n&&$("#pdLoot").append('<span id="pdChangePointsTips"> (改点：'+n+")</span>")}else Loot.getChangePointsCountDown().done(e).fail(function(){return setTimeout(e,_Const2.default.minActionInterval)})}},{"./Config":4,"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Info":9,"./Item":10,"./Log":11,"./LogDialog":12,"./Loot":13,"./Msg":15,"./Read":19,"./Script":20,"./TmpLog":22,"./Util":23}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blockUselessThreadButtons=n.showBuyThreadLogDialog=n.recordBuyThreadLog=n.clearBuyThreadLog=n.writeBuyThreadLog=n.readBuyThreadLog=n.getThreadTitle=n.showAttachImageOutsideSellBox=n.parseMediaTag=n.addMoreSmileLink=n.addCopyCodeLink=n.addUserMemo=n.modifyKFOtherDomainLink=n.addMultiQuoteButton=n.getMultiQuoteData=n.handleBuyThreadBtn=n.buyThreads=n.showStatFloorDialog=n.statFloor=n.addStatAndBuyThreadBtn=n.addCopyBuyersListOption=n.adjustThreadContentFontSize=n.modifyMySmColor=n.modifyFloorSmColor=n.fastGotoFloor=n.addFastGotoFloorInput=n.addFloorGotoLink=void 0;var C=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=i(e("./Info")),O=o(e("./Util")),g=o(e("./Msg")),j=o(e("./Dialog")),h=i(e("./Const")),q=e("./Config"),d=o(e("./Log")),R=o(e("./Script")),H=o(e("./Public")),a=o(e("./Post"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}n.addFloorGotoLink=function(){var o=O.getThreadSfParam();$(".readtext").prev("div").prev(".readlou").find("> div:nth-child(2) > span:first-child").each(function(){var e=$(this),t=e.text();if(/^\d+楼/.test(t)){var n=e.closest(".readlou").prev(".readlou").prev("a").attr("name");if(n&&/^\d+$/.test(n)){var a=O.getHostNameUrl()+"read.php?tid="+O.getUrlParam("tid")+"&spid="+n+(o?"&sf="+o:"");e.html(e.html().replace(/(\d+)楼/,'<a class="pd_goto_link" href="'+a+'" title="复制楼层链接">$1楼</a>')),e.find("a").click(function(e){e.preventDefault();var t=$(this),n=t.attr("href");t.data("copy-text",n),O.copyText(t,"楼层链接已复制")||prompt("本楼的跳转链接（请按Ctrl+C复制）：",n)})}}})},n.addFastGotoFloorInput=function(){$('\n<form>\n<li class="pd_fast_goto_floor">\n  直达 <input class="pd_input" style="width: 30px;" type="text" maxlength="8">\n  <span data-name="submit" style="cursor: pointer;">楼</span>\n</li>\n</form>\n').prependTo($(".readtext:first").prev("div").prev(".readlou").find("> div:first-child > ul")).submit(function(e){e.preventDefault();var t=parseInt($(this).find("input").val());if(t&&!(t<0)){var n=O.getThreadSfParam();location.href="read.php?tid="+O.getUrlParam("tid")+"&page="+(parseInt(t/Config.perPageFloorNum)+1)+"&floor="+t+"&sf="+n}}).find('[data-name="submit"]').click(function(){$(this).closest("form").submit()}).end().closest("div").next().css({"max-width":"385px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"})},n.fastGotoFloor=function(){var e=parseInt(O.getUrlParam("floor"));if(e&&!(e<0)){var t=$('.readlou > div:nth-child(2) > span:first-child:contains("'+e+'楼")');if(t.length){var n=t.closest(".readlou").prev(".readlou").prev("a").attr("name");n&&/^\d+$/.test(n)&&(location.hash="#"+n)}}};var r=n.modifyFloorSmColor=function(e,t){e.css("color",t).parent(".readidmsbottom, .readidmbottom").parent(".readidms, .readidm").css("border-color",t).parent(".readlou").css("border-color",t).next(".readlou").css("border-color",t).next().next(".readtext").css("border-color",t).next(".readlou").css("border-color",t)},u=(n.modifyMySmColor=function(){var e=$('.readidmsbottom > a[href^="profile.php?action=show&uid='+c.default.uid+'"]');e.length||(e=$('.readidmbottom > a[href^="profile.php?action=show&uid='+c.default.uid+'"]')),0<e.length&&r(e,Config.customMySmColor)},n.adjustThreadContentFontSize=function(){0<Config.threadContentFontSize&&12!==Config.threadContentFontSize&&$("head").append("\n<style>\n  .readtext td { font-size: "+Config.threadContentFontSize+"px; line-height: 1.6em; }\n  .readtext td > div, .readtext td > .read_fds { font-size: 12px; }\n</style>\n")},n.addCopyBuyersListOption=function(){$('.readtext select[name="buyers"]').each(function(){$(this).find("option:first-child").after('<option value="copyList">复制名单</option><option value="openBuyThreadLogDialog">查看购买记录</option>')}),$(document).on("change",'select[name="buyers"]',function(){var e=$(this),t=e.val();if("copyList"===t){var n=e.find("option").map(function(e){var t=$(this).text();return e<=2||t.includes("-".repeat(11))?null:t}).get().join("\n");if(e.get(0).selectedIndex=0,!n)return void alert("暂时无人购买");var a="pdCopyBuyerListDialog";if(0<$("#"+a).length)return;var o='\n<div class="pd_cfg_main">\n  <textarea name="buyerList" style="width: 200px; height: 300px; margin: 5px 0;" readonly>'+n+"</textarea>\n</div>",i=j.create(a,"购买人名单",o);j.show(a),i.find('[name="buyerList"]').select().focus()}else"openBuyThreadLogDialog"===t&&(e.get(0).selectedIndex=0,b())})},n.addStatAndBuyThreadBtn=function(){$('<span style="margin: 0 5px;">|</span><a data-name="statAndBuyThread" title="统计回帖者名单以及批量购买帖子" href="#">统计和购买</a>').insertAfter('td > a[href^="kf_tidfavor.php?action=favor&tid="]').filter('[data-name="statAndBuyThread"]').click(function(e){if(e.preventDefault(),!(0<$("#pdStatFloorDialog").length)){var t=parseInt(O.getUrlParam("tid"));if(t){var n=$.trim(prompt("统计到第几楼？（0表示统计所有楼层，可用m-n的方式来设定统计楼层的区间范围）",0));if(""!==n)if(/^\d+(-\d+)?$/.test(n)){var a=O.getThreadSfParam(),o=0,i=0,r=n.split("-");if((i=2===r.length?(o=parseInt(r[0]),parseInt(r[1])):parseInt(r[0]))<o)alert("统计楼层格式不正确");else{var l=/(\d+)页/.exec($(".pages:eq(0) > li:last-child > a").text()),d=l?parseInt(l[1]):1;0===o&&(o=1),0===i&&(i=d*Config.perPageFloorNum-1);var s=Math.floor(o/Config.perPageFloorNum)+1,c=Math.floor(i/Config.perPageFloorNum)+1;d<c&&(c=d),c-s>h.default.statFloorMaxPage?alert("需访问的总页数不可超过"+h.default.statFloorMaxPage):(g.destroy(),g.wait('<strong>正在统计楼层中&hellip;</strong><i>剩余页数：<em class="pd_countdown">'+(c-s+1)+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),u(t,s,c,o,i,a))}}else alert("统计楼层格式不正确")}}})},n.statFloor=function(n,e,a,u,p,o){var f=!1,m=[];!function e(t){$.ajax({type:"GET",url:"read.php?tid="+n+"&page="+t+"&sf="+o+"&t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(e){$(".readtext",e.replace(/src="[^"]+"/g,"")).each(function(){var e={},t=$(this),n=t.prev("div").prev(".readlou"),a=parseInt(n.find("> div:nth-child(2) > span:first-child").text());if(a&&!(a<u)){if(p<a)return!(f=!0);e.pid=parseInt(n.prev(".readlou").prev("a").attr("name"));var o=n.prev(".readlou").find(".readidms, .readidm"),i=o.find('a[href^="profile.php?action=show&uid="]');e.userName=i.text(),e.uid="",e.sf="";var r=/profile\.php\?action=show&uid=(\d+)(?:&sf=(\w+))/.exec(i.attr("href"));r&&(e.uid=parseInt(r[1]),e.sf=r[2]),e.smLevel="";var l=/(\S+) 级神秘/.exec(o.find(".readidmsbottom, .readidmbottom").text());l&&(e.smLevel=l[1]);var d=t.find('[name="buyers"]:first');if((e.status=0)<d.length){var s=d.next("input");if(e.status=0<s.length?1:2,1===e.status){var c=/此帖售价\s*(\d+)\s*KFB/.exec(d.parent("legend").text());c&&(e.sell=parseInt(c[1])),(c=/location\.href="(.+)"/i.exec(s.attr("onclick")))&&(e.buyUrl=c[1])}}m[a]=e}});var t=$(".pd_countdown:last");t.text(parseInt(t.text())-1),f=f||t.closest(".pd_msg").data("stop")},error:function(){setTimeout(function(){return e(t)},h.default.defAjaxInterval)},complete:function(){f||a<=t?(g.destroy(),l(m)):setTimeout(function(){return e(t+1)},h.default.defAjaxInterval)}})}(e)}),l=n.showStatFloorDialog=function(h){function e(){var e=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(h)),t=b.find('[name="removeRepeatedEnabled"]').prop("checked"),n=b.find('[name="removeTopFloorEnabled"]').prop("checked");if(t&&(e=e.map(function(t,e,n){return t&&n.findIndex(function(e){return e&&e.userName===t.userName})===e?t:null})),n){var a=$(".readtext:first");if("tpc"===a.prev("div").prev(".readlou").prev("a").attr("name")){var o=a.find(".readidmsbottom, .readidmbottom").find('a[href^="profile.php?action=show&uid="]').text();e=e.map(function(e){return e&&e.userName!==o?e:null})}}var i="",r="",l=0,d=!0,s=!1,c=void 0;try{for(var u,p=e.entries()[Symbol.iterator]();!(d=(u=p.next()).done);d=!0){var f=C(u.value,2),m=f[0],g=f[1];g&&(i+='\n<tr>\n  <td>\n    <label>\n      <input data-status="'+g.status+'" data-sell="'+(g.sell?g.sell:0)+'" data-url="'+(g.buyUrl?g.buyUrl:"")+'"\n        type="checkbox" value="'+g.userName+'">\n    </label>\n  </td>\n  <td><a href="read.php?tid='+x+"&spid="+g.pid+(k?"&sf="+k:"")+'" target="_blank">'+m+'楼</a></td>\n  <td><a href="profile.php?action=show&uid='+g.uid+"&sf="+g.sf+'" target="_blank" style="color: #000;">'+g.userName+'</a></td>\n  <td style="'+(g.smLevel.endsWith("W")||"MAX"===g.smLevel?"color: #f39;":"")+'">'+g.smLevel+'</td>\n  <td class="pd_stat">'+(1===g.status?"<em>"+g.sell+"</em>":'<span class="pd_notice">'+(g.status?"已买":"无")+"</span>")+"</td>\n</tr>",r+=g.userName+"\n",l++)}}catch(e){s=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(s)throw c}}y.html(i),_.val(r).data("copy-text",r),v.find("#pdStatFloorShowCount").text(l),v.find("#pdStatFloorSelectCount").text(0)}var o="pdStatFloorDialog",v=j.create(o,"统计楼层",'\n<div class="pd_cfg_main">\n  <div id="pdStatFloorFilter" style="margin-top: 5px;">\n    <label><input name="removeRepeatedEnabled" type="checkbox"> 去除重复</label>\n    <label><input name="removeTopFloorEnabled" type="checkbox"> 去除楼主</label>\n  </div>\n  <div id="pdStatFloorSelectBtns">\n    <label style="margin-left: 3px;">售价区间：</label>\n    <input name="startSell" type="number" value="1" min="1" max="100" style="width: 40px;"> -\n    <input name="endSell" type="number" value="100" min="1" max="100" style="width: 40px;">\n    <label style="margin-left: 3px;">\n      每名用户限选 <input name="limitNum" type="number" min="0" style="width: 32px;"> 个\n    </label>\n    <a class="pd_btn_link" data-name="selectFilter" href="#">筛选</a><br>\n    <a class="pd_btn_link" data-name="selectAll" href="#">全选</a>\n    <a class="pd_btn_link" data-name="selectInverse" href="#">反选</a>\n  </div>\n  <div class="pd_highlight" style="text-align: center;">\n    共显示<b id="pdStatFloorShowCount">0</b>条项目，共选择<b id="pdStatFloorSelectCount">0</b>条项目\n  </div>\n  <table style="line-height: 1.8em; text-align: center;">\n    <thead>\n      <tr>\n        <th style="width: 30px;"></th>\n        <th style="width: 65px;">楼层号</th>\n        <th style="width: 120px;">用户名</th>\n        <th style="width: 80px;">神秘等级</th>\n        <th style="width: 100px;">\n          售价(KFB) <span class="pd_cfg_tips" title="注：售价信息在统计后可能会发生变化，如有必要，建议尽快购买帖子">[?]</span>\n        </th>\n      </tr>\n    </thead>\n    <tbody id="pdStatFloorList"></tbody>\n  </table>\n  <textarea name="statFloorListContent" style="margin-top: 8px; width: 250px; height: 300px;" hidden></textarea>\n</div>\n\n<div class="pd_cfg_btns">\n  <button name="copyList" type="button" style="color: #00f;" title="复制所有或所选楼层的用户名单">复制名单</button>\n  <button name="buyThread" type="button" style="color: #f00;" title="批量购买所选楼层的帖子">购买帖子</button>\n  <button data-action="close" type="button">关闭</button>\n</div>'),b=v.find("#pdStatFloorFilter"),y=v.find("#pdStatFloorList"),_=v.find('[name="statFloorListContent"]'),x=O.getUrlParam("tid"),k=O.getThreadSfParam();v.find("#pdStatFloorSelectBtns").on("click","[data-name]",function(e){e.preventDefault();var t=$(this).data("name");if("selectAll"===t)O.selectAll(y.find('[type="checkbox"]'));else if("selectInverse"===t)O.selectInverse(y.find('[type="checkbox"]'));else if("selectFilter"===t){var i=parseInt(v.find('[name="startSell"]').val()),r=parseInt(v.find('[name="endSell"]').val()),l=parseInt(v.find('[name="limitNum"]').val());if((!l||l<0)&&(l=0),!i||i<1||!r||r<1)return;var d={};y.find('[type="checkbox"]').each(function(){var e=$(this),t=parseInt(e.data("status"));if(t){var n=parseInt(e.data("sell")),a=e.val();a in d||(d[a]=0),d[a]++;var o=1===t&&i<=n&&n<=r;o&&0<l&&d[a]>l&&(o=!1),e.prop("checked",o)}})}v.find("#pdStatFloorSelectCount").text(y.find('[type="checkbox"]:checked').length)}).end().find('[name="copyList"]').click(function(){var e=$(this);if("取消复制"===e.text())return e.text("复制名单"),_.prop("hidden",!0),y.closest("table").prop("hidden",!1),void j.resize(o);var t="all",n=y.find('[type="checkbox"]:checked');if(0<n.length){t="select";var a="";n.each(function(){a+=$(this).val()+"\n"}),_.val(a).data("copy-text",a)}O.copyText(_,("all"===t?"所有":"所选")+"用户名单已复制")||(e.text("取消复制"),y.closest("table").prop("hidden",!0),_.prop("hidden",!1).select().focus(),j.resize(o))}).end().find('[name="buyThread"]').click(function(){var a=[],o=0;y.find('[type="checkbox"]:checked').length||v.find('[data-name="selectAll"]').click(),y.find('[type="checkbox"]:checked').each(function(){var e=$(this),t=e.data("url"),n=parseInt(e.data("sell"));t&&0<n&&(a.push({url:t,sell:n}),o+=n)}),a.length&&confirm("你共选择了 "+a.length+" 个可购买项，总售价 "+o.toLocaleString()+" KFB，均价 "+O.getFixedNumLocStr(o/a.length,2)+" KFB，是否批量购买？")&&(g.destroy(),g.wait('<strong>正在购买帖子中&hellip;</strong><i>剩余：<em class="pd_countdown">'+a.length+'</em></i><a class="pd_stop_action" href="#">停止操作</a>'),s(a))}),1!==O.getCurrentThreadPage()&&b.find('[name="removeTopFloorEnabled"]').prop("disabled",!0).parent("label").attr("title","请在第1页进行统计"),b.on("click",'[type="checkbox"]',e),e(),j.show(o),R.runFunc("Read.showStatFloorDialog_after_")},s=n.buyThreads=function(o){var i=0,r=0,l=0;$(document).clearQueue("BuyThread"),$.each(o,function(n,e){var t=e.url,a=e.sell;$(document).queue("BuyThread",function(){$.ajax({type:"GET",url:t+"&t="+$.now(),timeout:h.default.defAjaxTimeout,success:function(e){H.showFormatLog("购买帖子",e);var t=O.getResponseMsg(e).msg;/操作完成/.test(t)?(i++,l+=a):r++},error:function(){r++},complete:function(){var e=$(".pd_countdown:last");e.text(parseInt(e.text())-1);var t=e.closest(".pd_msg").data("stop");t&&$(document).clearQueue("BuyThread"),t||n===o.length-1?(g.destroy(),0<i&&d.push("购买帖子","共有`"+i+"`个帖子购买成功",{pay:{KFB:-l}}),console.log("共有"+i+"个帖子购买成功，共有"+r+"个帖子购买失败，KFB-"+l),g.show("<strong>共有<em>"+i+"</em>个帖子购买成功"+(0<r?"，共有<em>"+r+"</em>个帖子购买失败":"")+"</strong><i>KFB<ins>-"+l+"</ins></i>",-1),R.runFunc("Read.buyThreads_after_",o)):setTimeout(function(){return $(document).dequeue("BuyThread")},h.default.defAjaxInterval)}})})}),$(document).dequeue("BuyThread")},p=(n.handleBuyThreadBtn=function(){$('.readtext input[type="button"][value="愿意购买,支付KFB"]').each(function(){var e=$(this),t=/此帖售价\s*(\d+)\s*KFB/.exec(e.closest("legend").contents().eq(0).text());if(t){var n=parseInt(t[1]);(t=/location\.href="(.+?)"/i.exec(e.attr("onclick")))&&e.data("sell",n).data("url",t[1]).removeAttr("onclick").click(function(e){e.preventDefault();var s=$(this),c=s.data("sell"),u=s.data("url");if(c&&u&&(!(c>=h.default.minBuyThreadWarningSell)||confirm("此贴售价 "+c+" KFB，是否购买？")))if(Config.buyThreadNoJumpEnabled){var p=g.wait("<strong>正在购买帖子&hellip;</strong>");$.get(u+"&t="+$.now(),function(e){H.showFormatLog("购买帖子",e);var t=O.getResponseMsg(e).msg;if(g.remove(p),/操作完成/.test(t)){if(Config.saveBuyThreadLogEnabled){var n=/tid=(\d+)&pid=(\d+|tpc)/.exec(u);if(!n)return;var a=parseInt($('input[name="fid"]:first').val()),o=parseInt(n[1]),i=n[2],r=$('a[href^="kf_tidfavor.php?action=favor"]').parent().find('a[href^="thread.php?fid="]:last').text().trim(),l=f(),d=s.closest(".readtext").find(".readidmsbottom, .readidmbottom").find('a[href^="profile.php?action=show"]').text().trim();v({fid:a,tid:o,pid:i,forumName:r,threadTitle:l,userName:d,sell:c})}location.reload()}else/您已经购买此帖/.test(t)?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}else location.href=u})}})},n.getMultiQuoteData=function(){var i=[];return $(".pd_multi_quote_chk input:checked").each(function(){var e=$(this).closest(".readlou"),t=/(\d+)楼/.exec(e.find(".pd_goto_link").text()),n=t?parseInt(t[1]):0,a=e.prev(".readlou").prev("a").attr("name"),o=O.getFloorUserName(e.prev(".readlou").find(".readidmsbottom > a, .readidmbottom > a").text());o&&i.push({floor:n,pid:a,userName:o})}),i}),f=(n.addMultiQuoteButton=function(){var e=$('a[href^="post.php?action=reply"].b_tit2').attr("href");e&&($('<li class="pd_multi_quote_chk"><label title="多重引用"><input type="checkbox"> 引</label></li>').prependTo($(".readlou > div:first-child > ul").has('a[title="引用回复这个帖子"]')).find("input").click(function(){var e=parseInt(O.getUrlParam("tid")),t=localStorage[h.default.multiQuoteStorageName];if(t)try{!(t=JSON.parse(t))||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:void 0!==t.tid&&t.tid===e&&Array.isArray(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var n=p();t||(localStorage.removeItem(h.default.multiQuoteStorageName),t={tid:e,quoteList:[]});var a=O.getCurrentThreadPage();0<n.length?t.quoteList[a]=n:delete t.quoteList[a],localStorage[h.default.multiQuoteStorageName]=JSON.stringify(t)}),$(".readlou:last").next("div").find("table > tbody > tr > td:last-child").css({"text-align":"right",width:"320px"}).append('<span class="b_tit2" style="margin-left: 5px;"><a style="display: inline-block;" href="#" title="多重回复">回复</a> <a style="display: inline-block;" href="'+e+'&multiquote=1" title="多重引用">引用</a></span>').find(".b_tit2 > a:eq(0)").click(function(e){e.preventDefault(),a.handleMultiQuote(1)}))},n.modifyKFOtherDomainLink=function(){$(".readtext a, .thread2 a").each(function(){var e=$(this),t=e.attr("href");if(!/m\.miaola\.info\//i.test(t)){var n=/^(https?:\/\/(?:[\w\.]+?\.)?(?:2dgal|ddgal|9gal|9baka|9moe|kfgal|2dkf|ikfol|kfacg|miaola|koyuki)\.\w+?\/)\w+\.php/i.exec(t);n&&e.attr("href",t.replace(n[1],O.getHostNameUrl()))}})},n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$('.readidmsbottom > a[href^="profile.php?action=show&uid="], .readidmbottom > a[href^="profile.php?action=show&uid="]').each(function(){var e=$(this),t=O.getFloorUserName(e.text().trim()),n=Object.keys(Config.userMemoList).find(function(e){return e===t});if(n){var a=Config.userMemoList[n];if(e.is(".readidmbottom > a"))e.after('<span class="pd_user_memo_tips" title="备注：'+a+'">[?]</span>');else{var o=a;24<a.length&&(o=o.substring(0,24)+"&hellip;"),e.parent().append('<div class="pd_user_memo" title="备注：'+a+'">('+o+")</div>"),e.closest(".readidms").css({height:"auto","min-height":"280px"})}}})},n.addCopyCodeLink=function(){$('.readtext fieldset > legend:contains("Copy code")').html('<a class="pd_copy_code" href="#">复制代码</a>').parent("fieldset").addClass("pd_code_area"),$(".pd_copy_code").length&&$("#alldiv").on("click","a.pd_copy_code",function(e){e.preventDefault();var t=$(this),n=t.closest("fieldset");if(!O.copyText(n,"代码已复制",t.parent())){var a=n.data("content");if(a)n.html('<legend><a class="pd_copy_code" href="#">复制代码</a></legend>'+a).removeData("content");else{var o=n.html();o=o.replace(/<legend>.+?<\/legend>/i,""),n.data("content",o),o=O.htmlDecode(o);var i=n.height();(i-=17)<50&&(i=50),540<i&&(i=540),n.html('\n<legend><a class="pd_copy_code" href="#">还原代码</a></legend>\n<textarea wrap="off" class="pd_textarea" style="width: 100%; height: '+i+'px; line-height: 1.4em; white-space: pre;">'+o+"</textarea>\n"),n.find("textarea").select().focus()}}})},n.addMoreSmileLink=function(){function d(e){var t=$('textarea[name="atc_content"]').get(0);if(t){var n="[s:"+e+"]";O.addCode(t,n),c.default.isMobile?t.blur():t.focus()}}var s=$('form[action="post.php?"] > div:first > table > tbody > tr:nth-child(2) > td:first-child');s.on("click",'a[href="javascript:;"]',function(e){e.preventDefault();var t=$(this).data("id");t&&d(t)}).find('a[onclick^="javascript:addsmile"]').each(function(){var e=$(this),t=/addsmile\((\d+)\)/i.exec(e.attr("onclick"));t&&e.data("id",t[1]).removeAttr("onclick").attr("href","javascript:;")}),$('<a class="pd_highlight" href="#">[更多]</a>').appendTo(s).click(function(e){e.preventDefault();var t=$(this),n=$("#pdSmilePanel");if(0<n.length)return t.text("[更多]"),void n.remove();t.text("[关闭]");for(var a=["48","35","34","33","32","31","30","29","28","27","26","36","37","47","46","45","44","43","42","41","40","39","38","25","24","11","10","09","08","01","02","03","04","05","06","12","13","23","22","21","20","19","18","17","16","15","14","07"],o=[57,44,43,42,41,40,39,38,37,36,35,45,46,56,55,54,53,52,51,50,49,48,47,34,33,20,19,18,17,10,11,12,13,14,15,21,22,32,31,30,29,28,27,26,25,24,23,16],i="",r=0;r<a.length;r++)i+='<img src="'+c.default.w.imgpath+"/post/smile/em/em"+a[r]+'.gif" alt="[表情]" data-id="'+o[r]+'">';i='<div class="pd_panel" id="pdSmilePanel" style="width: 308px; height: 185px;">'+i+"</div>";var l=s.offset();(n=$(i).appendTo("body")).css("top",l.top-n.height()+10).css("left",l.left+s.width()-n.width()-10).on("click","img",function(){var e=$(this).data("id");e&&d(e)}),R.runFunc("Read.addMoreSmileLink_after_click_")})},n.parseMediaTag=function(){$(".readtext > table > tbody > tr > td").each(function(){var e=$(this),t=e.html();/\[(audio|video)\](http|ftp)[^<>]+\[\/(audio|video)\]/.test(t)&&e.html(t.replace(/\[audio\]((?:http|ftp)[^<>]+?)\[\/audio\](?!<\/fieldset>)/g,'<audio src="$1" controls preload="none" style="margin: 3px 0;">[你的浏览器不支持audio标签]</audio>').replace(/\[video\]((?:http|ftp)[^<>]+?)\[\/video\](?!<\/fieldset>)/g,'<video src="$1" controls preload="none" style="max-width: '+(Config.adjustThreadContentWidthEnabled?627:820)+'px; margin:3px 0;">[你的浏览器不支持video标签]</video>'))})},n.showAttachImageOutsideSellBox=function(){if(1===O.getCurrentThreadPage()){var e=$(".readtext:first > table > tbody > tr > td");if(e.find('select[name="buyers"]').length){var t=e.html();if(/\[attachment=\d+\]/.test(t)){var n=e.closest(".readtext").prev("div").prev(".readlou").prev(".readlou").prev("a").attr("name"),a=O.getUrlParam("tid");e.html(t.replace(/\[attachment=(\d+)\]/g,'<img src="job.php?action=download&pid='+n+"&tid="+a+'&aid=$1" alt="[附件图片]" style="max-width: 550px;" onclick="if(this.width>=550) window.open(\'job.php?action=download&pid='+n+"&tid="+a+"&aid=$1');\">"))}}}},n.getThreadTitle=function(){return $('form[name="delatc"] > div:first > table > tbody > tr > td > span:first').text().trim()}),m=h.default.storagePrefix+"buyThreadLog",W=n.readBuyThreadLog=function(){var t=[],e=O.readData(m+"_"+c.default.uid);if(!e)return t;try{e=JSON.parse(e)}catch(e){return t}return e&&Array.isArray(e)?t=e:t},K=n.writeBuyThreadLog=function(e){return O.writeData(m+"_"+c.default.uid,JSON.stringify(e))},z=n.clearBuyThreadLog=function(){return O.deleteData(m+"_"+c.default.uid)},v=n.recordBuyThreadLog=function(e){var t=e.fid,n=e.tid,a=e.pid,o=e.forumName,i=e.threadTitle,r=e.userName,l=e.sell,d=W();d.push($.extend({time:$.now()},{fid:t,tid:n,pid:a,forumName:o,threadTitle:i,userName:r,sell:l})),d=d.sort(function(e,t){return e.time-t.time}).slice(-Config.saveBuyThreadLogMaxNum),K(d)},b=n.showBuyThreadLogDialog=function(){var e="pdBuyThreadLogDialog";if(!(0<$("#"+e).length)){var t=W(),n='\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <label>\n      保存最近的 <input name="saveBuyThreadLogMaxNum" type="number" value="'+Config.saveBuyThreadLogMaxNum+'" min="1" max="10000" style="width: 60px;"> 条记录\n    </label>\n    <a class="pd_btn_link" data-name="save" href="#">保存</a>\n  </div>\n  <fieldset>\n    <legend>购买帖子记录 <span class="pd_stat" data-name="logHeaderInfo"></span></legend>\n    <div class="pd_stat pd_log_content" id="pdBuyThreadLog" style="width: 900px; max-height: 450px; height: auto;"></div>\n  </fieldset>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about"><a data-name="openImOrExBuyThreadLogDialog" href="#">导入/导出购买帖子记录</a></span>\n  <button data-action="close" type="button">关闭</button>\n  <button name="clear" type="button">清除记录</button>\n</div>',a=j.create(e,"购买帖子记录",n),o=a.find("#pdBuyThreadLog");a.find('[data-name="save"]').click(function(e){e.preventDefault();var t=parseInt(a.find('[name="saveBuyThreadLogMaxNum"]').val());!t||1e4<t||t<0?alert("数量取值范围：1-10000"):((0,q.read)(),Config.saveBuyThreadLogMaxNum=t,(0,q.write)(),alert("设置已保存"))}).end().find('[data-name="openImOrExBuyThreadLogDialog"]').click(function(e){e.preventDefault(),H.showCommonImportOrExportConfigDialog("购买帖子记录",{read:W,write:K})}).end().find('[name="clear"]').click(function(){confirm("是否清除所有购买帖子记录？")&&(z(),alert("购买帖子记录已清除"))});var i={},r=!0,l=!1,d=void 0;try{for(var s,c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value,p=O.getDateString(new Date(u.time));p in i||(i[p]=[]),i[p].push(u)}}catch(e){l=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw d}}var f=0,m="",g=!0,h=!1,v=void 0;try{for(var b,y=Object.keys(i).sort(function(e,t){return t<e?1:-1})[Symbol.iterator]();!(g=(b=y.next()).done);g=!0){var _=b.value,x="",k=0,C=!0,w=!1,I=void 0;try{for(var L,S=i[_][Symbol.iterator]();!(C=(L=S.next()).done);C=!0){var A=L.value,T=A.time,D=A.fid,E=A.tid,M=A.pid,P=A.forumName,B=A.threadTitle,F=A.userName,N=A.sell;f+=N,k+=N,x+="\n<p>\n  <b>"+O.getTimeString(new Date(T))+'：</b>[<a href="thread.php?fid='+D+'" target="_blank">'+P+'</a>]\n  《<a href="read.php?tid='+E+("tpc"===M?"":"&spid="+M)+'" target="_blank">'+B+'</a>》\n  &nbsp;发帖者：<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+F+'" target="_blank">'+F+"</a>\n  &nbsp;售价：<em>"+N+"</em>KFB\n</p>"}}catch(e){w=!0,I=e}finally{try{!C&&S.return&&S.return()}finally{if(w)throw I}}m+="<h3>【"+_+"】 (共<em>"+i[_].length+"</em>项，合计<em>"+k.toLocaleString()+"</em>KFB)</h3>"+x}}catch(e){h=!0,v=e}finally{try{!g&&y.return&&y.return()}finally{if(h)throw v}}o.html(m||"暂无购买帖子记录（需开启“保存购买帖子记录”的功能）"),a.find('[data-name="logHeaderInfo"]').html("(共<em>"+t.length+"</em>项，总售价<em>"+f.toLocaleString()+"</em>KFB)"),j.show(e);var U=o.find("p:last");0<U.length&&U.get(0).scrollIntoView(),R.runFunc("Read.showBuyThreadLogDialog_after_")}};n.blockUselessThreadButtons=function(){$('.readidmsbottom > a[href^="profile.php?action=show"], .readidmbottom > a[href^="profile.php?action=show"]').each(function(){var e=$(this);e.text().trim()!==c.default.userName&&e.closest(".readtext").prev().prev(".readlou").find('a[href^="post.php?action=modify"]').hide()})}},{"./Config":4,"./Const":6,"./Dialog":7,"./Info":9,"./Log":11,"./Msg":15,"./Post":17,"./Public":18,"./Script":20,"./Util":23}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleInstallScriptLink=exports.showDialog=exports.runFunc=exports.addFunc=exports.runCmd=exports.runCustomScript=void 0;var _Info=require("./Info"),_Info2=_interopRequireDefault(_Info),_Dialog=require("./Dialog"),Dialog=_interopRequireWildcard(_Dialog),_Config=require("./Config"),_Util=require("./Util"),Util=_interopRequireWildcard(_Util),_Const=require("./Const"),_Const2=_interopRequireDefault(_Const),_Msg=require("./Msg"),Msg=_interopRequireWildcard(_Msg),_Log=require("./Log"),Log=_interopRequireWildcard(_Log),_TmpLog=require("./TmpLog"),TmpLog=_interopRequireWildcard(_TmpLog),_LootLog=require("./LootLog"),LootLog=_interopRequireWildcard(_LootLog),_Public=require("./Public"),Public=_interopRequireWildcard(_Public),_Index=require("./Index"),Index=_interopRequireWildcard(_Index),_Read=require("./Read"),Read=_interopRequireWildcard(_Read),_Post=require("./Post"),Post=_interopRequireWildcard(_Post),_Other=require("./Other"),Other=_interopRequireWildcard(_Other),_Bank=require("./Bank"),Bank=_interopRequireWildcard(_Bank),_Card=require("./Card"),Card=_interopRequireWildcard(_Card),_Item=require("./Item"),Item=_interopRequireWildcard(_Item),_Loot=require("./Loot"),Loot=_interopRequireWildcard(_Loot),_ConfigDialog=require("./ConfigDialog"),ConfigDialog=_interopRequireWildcard(_ConfigDialog);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defScriptName="未命名脚本",metaRegex=/\/\/\s*==UserScript==((?:.|\n)+?)\/\/\s*==\/UserScript==/i,funcList=new Map,runCustomScript=exports.runCustomScript=function(e){var t=0<arguments.length&&void 0!==e?e:"end",n=!0,a=!1,o=void 0;try{for(var i,r=Config.customScriptList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value,d=l.enabled,s=l.trigger,c=l.content;d&&s===t&&c&&runCmd(c)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}},runCmd=exports.runCmd=function runCmd(cmd){var isOutput=1<arguments.length&&void 0!==arguments[1]&&arguments[1],result=!0,response="";try{response=eval(cmd),isOutput&&console.log(response)}catch(e){result=!1,response=e,console.log(e)}return{result:result,response:String(response)}},addFunc=exports.addFunc=function(e,t){funcList.has(e)||funcList.set(e,[]),funcList.get(e).push(t)},runFunc=exports.runFunc=function(e,t){if(funcList.has(e)){var n=!0,a=!1,o=void 0;try{for(var i,r=funcList.get(e)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if("function"==typeof l)try{l(t)}catch(e){console.log(e)}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}}},getScriptMeta=function(e){var t={name:defScriptName,version:"",trigger:"end",homepage:"",author:""},n=metaRegex.exec(e);if(!n)return t;var a=n[1];return(n=/@name[ \t]+(.*)/i.exec(a))&&(t.name=n[1]),(n=/@version[ \t]+(.*)/i.exec(a))&&(t.version=n[1]),(n=/@trigger[ \t]+(.*)/i.exec(a))&&(t.trigger="start"===n[1].toLowerCase()?"start":"end"),(n=/@homepage[ \t]+(.*)/i.exec(a))&&(t.homepage=n[1]),(n=/@author[ \t]+(.*)/i.exec(a))&&(t.author=n[1]),t},showDialog=exports.showDialog=function(e){var t=0<arguments.length&&void 0!==e?e:null,n="pdCustomScriptDialog";if(!(0<$("#"+n).length)){(0,_Config.read)();var a=Dialog.create(n,"自定义脚本",'\n<div class="pd_cfg_main">\n  <div style="margin-top: 5px;">\n    <a class="pd_highlight pd_btn_link" data-name="addNewScript" href="#">添加新脚本</a>\n    <a class="pd_btn_link" data-name="insertSample" href="#">插入范例</a>\n  </div>\n  <div data-name="customScriptList"></div>\n</div>\n<div class="pd_cfg_btns">\n  <span class="pd_cfg_about">\n    <a class="pd_btn_link pd_highlight" href="read.php?tid=500968" target="_blank">自定义脚本收集贴</a>\n    <a class="pd_btn_link" data-name="openImOrExCustomScriptDialog" href="#">导入/导出所有脚本</a>\n  </span>\n  <button type="submit">保存</button>\n  <button data-action="close" type="button">取消</button>\n  <button class="pd_highlight" name="clear" type="button">清空</button>\n</div>',"min-width: 776px;"),m=a.find('[data-name="customScriptList"]');a.submit(function(e){e.preventDefault(),Config.customScriptList=[],m.find(".pd_custom_script_content").each(function(){var e=$(this),t=e.val();if($.trim(t)){var n=e.prev().find('[type="checkbox"]').prop("checked");Config.customScriptList.push($.extend(getScriptMeta(t),{enabled:n,content:t}))}}),(0,_Config.write)(),Dialog.close(n),alert("自定义脚本修改成功（需刷新页面后才可生效）")}).end().find('[name="clear"]').click(function(e){e.preventDefault(),confirm("是否清空所有脚本？")&&(m.html(""),Dialog.resize(n))});var o=function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.enabled,a=void 0===n||n,o=t.name,i=void 0===o?defScriptName:o,r=t.version,l=void 0===r?"":r,d=t.homepage,s=void 0===d?"":d,c=t.trigger,u=void 0===c?"end":c,p=t.content,f=void 0===p?"":p;m.append('\n<div class="pd_custom_script_header">\n  <input type="checkbox" '+(a?"checked":"")+' title="是否启用此脚本">\n  <a class="pd_custom_script_name" href="#" style="margin-left: 5px;">['+i+']</a>\n  <span data-name="version" style="margin-left: 5px; color: #666;" '+(l?"":"hidden")+">"+l+'</span>\n  <span data-name="trigger" style="margin-left: 5px; color: '+("start"===u?"#f00":"#00f")+';" title="脚本执行时机">\n    ['+("start"===u?"开始时":"结束时")+']\n  </span>\n  <a data-name="homepage" href="'+s+'" target="_blank" style="margin-left: 5px;" '+(s?"":"hidden")+'>[主页]</a>\n  <a data-name="delete" href="#" style="margin-left: 5px; color: #666;">[删除]</a>\n</div>\n<textarea class="pd_custom_script_content" wrap="off">'+f+"</textarea>\n")},i=!0,r=!1,l=void 0;try{for(var d,s=Config.customScriptList[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var c=d.value;o(c)}}catch(e){r=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}a.find('[data-name="addNewScript"]').click(function(e){e.preventDefault(),m.find(".pd_custom_script_content").hide(),o(),m.find(".pd_custom_script_content:last").show().focus(),Dialog.resize(n)}).end().find('[data-name="insertSample"]').click(function(e){e.preventDefault();var t=m.find(".pd_custom_script_content:visible");t.val(("\n// ==UserScript==\n// @name        "+defScriptName+"\n// @version     1.0\n// @author      "+_Info2.default.userName+"\n// @trigger     end\n// @homepage    read.php?tid=500968&spid=12318348\n// @description 这是一个未命名脚本\n// ==/UserScript==\n").trim()+"\n"+t.val()).focus()}).end().find('[data-name="openImOrExCustomScriptDialog"]').click(function(e){e.preventDefault(),Public.showCommonImportOrExportConfigDialog("自定义脚本","customScriptList")}),m.on("click",".pd_custom_script_name",function(e){e.preventDefault(),a.find(".pd_custom_script_content").hide(),$(this).parent().next().show().focus(),Dialog.resize(n)}).on("click",'[data-name="delete"]',function(e){if(e.preventDefault(),confirm("是否删除此脚本？")){var t=$(this).closest(".pd_custom_script_header");t.next().remove(),t.remove(),Dialog.resize(n)}}).on("change",".pd_custom_script_content",function(){var e=$(this),t=getScriptMeta(e.val()),n=t.name,a=t.version,o=t.homepage,i=t.trigger,r=e.prev();r.find(".pd_custom_script_name").text("["+(n||defScriptName)+"]"),r.find('[data-name="version"]').text(a).prop("hidden",!a),r.find('[data-name="homepage"]').attr("href",o||"").prop("hidden",!o),r.find('[data-name="trigger"]').html("["+("start"===i?"开始时":"结束时")+"]").css("color","start"===i?"#f00":"#00f")}),Dialog.show(n),"number"==typeof t&&m.find(".pd_custom_script_name").eq(t).click()}},handleInstallScriptLink=exports.handleInstallScriptLink=function(){$(document).on("click",'a[href$="#install-script"]',function(e){e.preventDefault();var t=$(this).nextAll(".pd_code_area").eq(0);if(t.length){var n=Util.htmlDecode(t.html().replace(/<legend>.+?<\/legend>/i,"")).trim();if(metaRegex.test(n)){(0,_Config.read)();var a=getScriptMeta(n),o=Config.customScriptList.findIndex(function(e){return e.name===a.name&&e.author===a.author}),i=-1<o?1:0;if(confirm("是否"+(1==i?"更新":"安装")+"此脚本？")){Config.customScriptEnabled=!0;var r=$.extend(a,{enabled:!0,content:n});1==i?Config.customScriptList[o]=r:Config.customScriptList.push(r),(0,_Config.write)(),Dialog.close("pdCustomScriptDialog"),showDialog(o)}}}})}},{"./Bank":2,"./Card":3,"./Config":4,"./ConfigDialog":5,"./Const":6,"./Dialog":7,"./Index":8,"./Info":9,"./Item":10,"./Log":11,"./Loot":13,"./LootLog":14,"./Msg":15,"./Other":16,"./Post":17,"./Public":18,"./Read":19,"./TmpLog":22,"./Util":23}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleGoodPostSubmit=n.addLinksInPage=n.refreshWaitCheckRatePage=n.addUnrecognizedSizeWarning=n.showErrorSizeSubmitWarning=n.highlightRateErrorSize=n.checkRateSize=void 0;var a=o(e("./Info")),l=o(e("./Const")),r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./Public"));function o(e){return e&&e.__esModule?e:{default:e}}var d=n.checkRateSize=function(e,t){var n=0,a=e.match(/\b(\d+(?:\.\d+)?)\s?(M|G)B?\b/gi);if(a)for(var o=0;o<a.length;o++){var i=/(\d+(?:\.\d+)?)\s?(M|G)/i.exec(a[o]);if(i){var r=parseFloat(i[1]);"G"===i[2].toUpperCase()&&(r*=1024),n+=r}}return n&&t?n>t*(100+l.default.ratingErrorSizePercent)/100+1||n<t*(100-l.default.ratingErrorSizePercent)/100-1?{type:1,titleSize:n,ratingSize:t}:{type:0}:{type:-1}};n.highlightRateErrorSize=function(){$('.adp1:eq(1) a[href^="read.php?tid="]').each(function(){var e=$(this),t=e.text(),n=0,a=e.parent("td").next("td"),o=/认定\[(\d+)\]/i.exec(a.text());o&&(n=parseInt(o[1]));var i=d(t,n),r=i.type,l=i.titleSize;-1===r?a.css("color","#ff9933").attr("title","标题文件大小无法解析").addClass("pd_custom_tips"):1===r&&a.addClass("pd_highlight pd_custom_tips").attr("title","标题文件大小("+l.toLocaleString()+"M)与认定文件大小("+n.toLocaleString()+"M)不一致")})},n.showErrorSizeSubmitWarning=function(){$('form[name="mail1"]').submit(function(){var e=parseFloat($('[name="psize"]').val());if(!(isNaN(e)||e<=0)){2===parseInt($('[name="psizegb"]').val())&&(e*=1024);var t=$('.adp1 a[href^="read.php?tid="]').text(),n=d(t,e),a=n.type,o=n.titleSize;return 1===a?confirm("标题文件大小("+o.toLocaleString()+"M)与认定文件大小("+e.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.addUnrecognizedSizeWarning=function(){var e=$('.adp1 a[href^="read.php?tid="]'),t=e.text();-1===d(t,1).type&&e.parent().append('&nbsp;<span style="color: #ff9933;">(标题文件大小无法解析)</span>')},n.refreshWaitCheckRatePage=function(){if(/剩余-\d+分钟/.test($(".adp1:eq(1) > tbody > tr:last-child > td:first-child").text())){!function t(){console.log("自动刷新Start"),$.ajax({type:"GET",url:"kf_fw_1wkfb.php?ping=2&t="+$.now(),timeout:1e4}).done(function(e){/剩余-\d+分钟/.test(e)&&setTimeout(t,l.default.defAjaxInterval)}).fail(function(){return setTimeout(t,l.default.defAjaxInterval)})}()}},n.addLinksInPage=function(){if(/\/kf_fw_1wkfb\.php\?ping=5\b/.test(location.href))$(".adp1:last > tbody > tr:gt(0) > td:last-child").each(function(){var e=$(this),t=parseInt(e.text());e.wrapInner('<a class="'+(t===a.default.uid?"pd_highlight":"")+" "+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&uid='+t+'" target="_blank"></a>')});else if(/\/kf_fw_1wkfb\.php\?ping=6\b/.test(location.href))$(".adp1:last > tbody > tr:gt(1) > td:nth-child(3)").each(function(){var e=$(this),t=e.text().trim();"0"!==t&&e.wrapInner('<a class="'+(t===a.default.userName?"pd_highlight":"")+" "+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+t+'" target="_blank"></a>')}),$(".adp1:last > tbody > tr:gt(1) > td:last-child").each(function(){var e=$(this),t=/\[(\d+)]板块/.exec(e.text());t&&e.wrapInner('<a href="thread.php?fid='+t[1]+'" target="_blank"></a>')});else if(/\/kf_fw_1wkfb\.php\?ping=8\b/.test(location.href))$(".adp1:last > tbody > tr:gt(1) > td:last-child").each(function(){var e=$(this);e.html(e.html().replace(/(管理|会员):([^\[\]]+)\]/g,'$1:<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username=$2" target="_blank">$2</a>]').replace(/\[帖子:(\d+)\]/,'[帖子:<a href="read.php?tid=$1" target="_blank">$1</a>]'))});else if(/\/kf_fw_1wkfb\.php\?ping=9\b/.test(location.href))$(".adp1:last > tbody > tr:gt(2) > td:first-child").each(function(){var e=$(this);e.html(e.html().replace(/UID:(\d+)/,'UID:<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&uid=$1" target="_blank">$1</a>'))});else if(/\/kf_fw_1wkfb\.php\?do=2\b/.test(location.href)){var e=$('.adp1 > tbody > tr:nth-of-type(4):contains("评分会员") > td:last-child');e.wrapInner('<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username='+e.text().trim()+'" target="_blank"></a>');var t=$('.adp1 > tbody > tr:nth-of-type(10) > td:last-child:contains("异议提出人")');t.html(t.html().replace(/：(\S+)/,'：<a class="'+(Config.adminMemberEnabled?"":"pd_not_click_link")+'" href="profile.php?action=show&username=$1" target="_blank">$1</a>'))}},n.handleGoodPostSubmit=function(){$('a[id^="cztz"]').attr("data-onclick",function(){return $(this).attr("onclick")}).removeAttr("onclick"),$("#alldiv").on("click",'a[onclick^="cztz"]',function(){var e=$(this),t=e.closest(".readlou").next().next(".readtext");e.data("highlight")?(t.removeClass("pd_good_post_mark"),e.removeData("highlight")):(t.addClass("pd_good_post_mark"),e.data("highlight",!0))}).on("click",'a[id^="cztz"]',function(){var n=$(this);if(!n.data("wait")){var a=n.closest('div[id^="floor"]').next(".readtext"),e=a.find(".readidmsbottom, .readidmbottom").find('a[href^="profile.php?action=show"]').attr("href"),t=!1;if($(".readidmsbottom, .readidmbottom").find('a[href="'+e+'"]').each(function(){var e=$(this).closest(".readtext");if(!e.is(a))return 0<e.find('.read_fds:contains("本帖为优秀帖")').length?!(t=!0):void 0}),!t||confirm("在当前页面中该会员已经有回帖被评为优秀帖，是否继续？")){var o=r.getSafeId(),i=/cztzyx\('(\d+)','(\d+|tpc)'\)/.exec(n.data("onclick"));i&&o&&(n.next(".pd_good_post_msg").remove(),n.data("wait",!0),$.ajax({type:"POST",url:"diy_read_cztz.php",data:"tid="+i[1]+"&pid="+i[2]+"&safeid="+o,timeout:l.default.defAjaxTimeout}).done(function(e){if(/已将本帖操作为优秀帖|该楼层已经是优秀帖/.test(e)){var t=a.find("> table > tbody > tr > td");t.find('.read_fds:contains("本帖为优秀帖")').length||t.find(".readidms, .readidm").after('<fieldset class="read_fds"><legend>↓</legend>本帖为优秀帖</fieldset>')}/已将本楼层提交为优秀帖申请/.test(e)||a.removeClass("pd_good_post_mark"),n.after('<span class="pd_good_post_msg" style="margin-left: 5px; color: #777;">('+e+")</span>")}).always(function(){return n.removeData("wait")}))}}})}},{"./Const":6,"./Info":9,"./Public":18}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.deleteValue=n.setValue=n.getValue=n.clear=n.write=n.read=void 0;var c=a(e("./Info")),u=a(e("./Const")),p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./Util"));function a(e){return e&&e.__esModule?e:{default:e}}var f=u.default.storagePrefix+"tmp_log",o=n.read=function(){var t={},e=p.readData(f+"_"+c.default.uid);if(!e)return t;try{e=JSON.parse(e)}catch(e){return t}if(!e||"object"!==$.type(e))return t;var n=[];for(var a in u.default)a.endsWith("TmpLogName")&&n.push(u.default[a]);var o=!0,i=!1,r=void 0;try{for(var l,d=Object.keys(e)[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;n.includes(s)||delete e[s]}}catch(e){i=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(i)throw r}}return t=e},i=n.write=function(e){return p.writeData(f+"_"+c.default.uid,JSON.stringify(e))};n.clear=function(){return p.deleteData(f+"_"+c.default.uid)},n.getValue=function(e){var t=o();return e in t?t[e]:null},n.setValue=function(e,t){var n=o();n[e]=t,i(n)},n.deleteValue=function(e){var t=o();e in t&&(delete t[e],i(t))}},{"./Const":6,"./Info":9,"./Util":23}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getFloorUserName=n.ajax=n.getThreadSfParam=n.deleteData=n.writeData=n.readData=n.selectInverse=n.selectAll=n.inFollowOrBlockUserList=n.entries=n.getResponseMsg=n.copyText=n.getSelText=n.addCode=n.getStrByteLen=n.removeUnpairedBBCodeContent=n.getFixedNumLocStr=n.getCurrentThreadPage=n.compareSmLevel=n.isEdge=n.isIE=n.isOpera=n.getStatFormatNumber=n.getSortedObjectKeyList=n.getObjectKeyList=n.removeHtmlTag=n.htmlDecode=n.htmlEncode=n.getGBKEncodeString=n.getUrlParam=n.deepEqual=n.getDifferenceSetOfObject=n.getHostNameUrl=n.isBetweenInTimeRange=n.getTimeDiffInfo=n.getTimeString=n.getDateString=n.getDate=n.getMidnightHourDate=n.getTimezoneDateByTime=n.getDateByTime=n.deleteCookie=n.getCookie=n.setCookie=void 0;var c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=a(e("./Info")),u=a(e("./Const"));function a(e){return e&&e.__esModule?e:{default:e}}n.setCookie=function(e,t,n,a){var o=2<arguments.length&&void 0!==n?n:null,i=3<arguments.length&&void 0!==a?a:r.default.uid+"_"+u.default.storagePrefix;document.cookie=""+i+e+"="+encodeURI(t)+(o?";expires="+o.toUTCString():"")+";path=/;"},n.getCookie=function(e,t){var n=1<arguments.length&&void 0!==t?t:r.default.uid+"_"+u.default.storagePrefix,a=new RegExp("(^| )"+n+e+"=([^;]*)(;|$)"),o=document.cookie.match(a);return o?decodeURI(o[2]):null},n.deleteCookie=function(e,t){var n=1<arguments.length&&void 0!==t?t:r.default.uid+"_"+u.default.storagePrefix;document.cookie=""+n+e+"=;expires="+o("-1y").toUTCString()+";path=/;"};var d=n.getDateByTime=function(e){var t=new Date,n=e.split(":"),a=c(n,3),o=a[0],i=a[1],r=a[2];return void 0!==o&&t.setHours(parseInt(o)),void 0!==i&&t.setMinutes(parseInt(i)),void 0!==r&&t.setSeconds(parseInt(r)),t.setMilliseconds(0),t},o=(n.getTimezoneDateByTime=function(e,t){var n=1<arguments.length&&void 0!==t?t:u.default.forumTimezoneOffset,a=new Date,o=e.split(":"),i=c(o,3),r=i[0],l=i[1],d=i[2];void 0!==r&&a.setUTCHours(parseInt(r)+n),void 0!==l&&a.setUTCMinutes(parseInt(l)),void 0!==d&&a.setUTCSeconds(parseInt(d)),a.setUTCMilliseconds(0);var s=new Date;return(s.getDate()>a.getDate()||s.getMonth()>a.getMonth()||s.getFullYear()>a.getFullYear())&&a.setDate(a.getDate()+1),a},n.getMidnightHourDate=function(e){var t=d("00:00:00");return t.setDate(t.getDate()+e),t},n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a=void 0===n[1]?0:"+"===n[1]?1:-1,o=-1==a?-parseInt(n[2]):parseInt(n[2]);switch(n[3]){case"Y":t.setFullYear(o);break;case"y":t.setFullYear(0==a?o:t.getFullYear()+o);break;case"M":t.setMonth(0==a?o:t.getMonth()+o);break;case"d":t.setDate(0==a?o:t.getDate()+o);break;case"h":t.setHours(0==a?o:t.getHours()+o);break;case"m":t.setMinutes(0==a?o:t.getMinutes()+o);break;case"s":t.setSeconds(0==a?o:t.getSeconds()+o);break;case"ms":t.setMilliseconds(0==a?o:t.getMilliseconds()+o);break;default:return null}return t}),i=(n.getDateString=function(e,t){var n=1<arguments.length&&void 0!==t?t:"-",a=((e=e||new Date).getMonth()+1).toString(),o=e.getDate().toString();return e.getFullYear()+n+a.padStart(2,"0")+n+o.padStart(2,"0")},n.getTimeString=function(e,t,n){var a=0<arguments.length&&void 0!==e?e:new Date,o=1<arguments.length&&void 0!==t?t:":",i=!(2<arguments.length&&void 0!==n)||n,r=a.getHours().toString(),l=a.getMinutes().toString(),d=a.getSeconds().toString();return r.padStart(2,"0")+o+l.padStart(2,"0")+(i?o:"")+(i?d.padStart(2,"0"):"")},n.getTimeDiffInfo=function(e){var t=e-$.now();if(0<t){t=Math.floor(t/1e3);var n=Math.floor(t/60/60);if(0<=n){var a=Math.floor((t-60*n*60)/60);a<0&&(a=0);var o=Math.floor(t-60*n*60-60*a);return o<0&&(o=0),{hours:n,minutes:a,seconds:o}}}return{hours:0,minutes:0,seconds:0}},n.isBetweenInTimeRange=function(e,t){var n=t.split("-"),a=c(n,2),o=a[0],i=a[1];if(void 0===i)return null;var r=d(o),l=d(i);return l<r&&(l<e?l.setDate(l.getDate()+1):r.setDate(r.getDate()-1)),r<=e&&e<=l},n.getHostNameUrl=function(){return location.protocol+"//"+location.host+"/"},n.getDifferenceSetOfObject=function(n,e){var a={};return"object"!==$.type(n)||"object"!==$.type(e)||$.each(e,function(e,t){e in n&&(i(n[e],t)||(a[e]=t))}),a},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if(void 0===t[a]||void 0===n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1}),l=n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substring(1).match(t);return n?decodeURI(n[2]):null},s=(n.getGBKEncodeString=function(e){var t=document.createElement("img");t.src="nothing?sp="+e,document.body.appendChild(t);var n=t.src.split("nothing?sp=").pop();return document.body.removeChild(t),n},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.removeHtmlTag=function(e){return e?e.replace(/<br\s*\/?>/g,"\n").replace(/<[^>]+>/g,""):""},n.getObjectKeyList=function(e,t){var n=1<arguments.length&&void 0!==t?t:0,a=[];if("object"!==$.type(e))return a;for(var o in e)a.push(o);return 0!==n&&a.sort(function(e,t){return 0<n?t<e?1:-1:e<t?1:-1}),a});n.getSortedObjectKeyList=function(n,e){var t=s(e);return t.sort(function(e,t){return n.indexOf(e)>n.indexOf(t)?1:-1}),t},n.getStatFormatNumber=function(e){return 0<=e?"<em>+"+e.toLocaleString()+"</em>":"<ins>"+e.toLocaleString()+"</ins>"},n.isOpera=function(){return void 0!==r.default.w.opera},n.isIE=function(){return void 0!==navigator.msMaxTouchPoints},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.includes("Edge")},n.compareSmLevel=function(e,t){var n="MAX"===e.toUpperCase()?Number.MAX_VALUE:parseInt(e),a="MAX"===t.toUpperCase()?Number.MAX_VALUE:parseInt(t);return a<n?1:n<a?-1:0},n.getCurrentThreadPage=function(){var e=/- (\d+) -/.exec($('.pages:first > li > a[href="javascript:;"]').text());return e?parseInt(e[1]):1},n.getFixedNumLocStr=function(e,t){var n=1<arguments.length&&void 0!==t?t:0,a=e.toFixed(n).split("."),o=c(a,2),i=o[0],r=o[1],l="";return void 0!==r&&(l="."+r),parseInt(i).toLocaleString()+l},n.removeUnpairedBBCodeContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var o=e.match(t[a]),i=e.match(n[a]);(o?o.length:0)!==(i?i.length:0)&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getStrByteLen=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n)<0||255<e.charCodeAt(n)?2:1;return t},n.addCode=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:"",o=a?t.indexOf(a):t.indexOf("]")+1;if(void 0!==e.selectionStart){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(e.selectionEnd),e.selectionStart=i+o,e.selectionEnd=i+o+a.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.copyText=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!("execCommand"in document&&e.length))return!1;var a=e.data("copy-text");a&&(e=$('<span class="pd_hide">'+a.replace(/\n/g,"<br>")+"</span>").insertAfter(e)),n&&n.prop("hidden",!0);var o=null;if(e.is("input, textarea"))e.select(),o=document.execCommand("copy");else{var i=window.getSelection();i.selectAllChildren(e.get(0)),o=document.execCommand("copy"),i.removeAllRanges()}return a&&e.remove(),n&&n.removeProp("hidden"),o&&alert(t||"已复制"),o},n.getResponseMsg=function(e){var t=0,n="",a="",o=/<span style=".+?">(.+?)<\/span><br\s*\/?><a href="(.+?)">/i.exec(e);if(o)n=o[t=1],a=o[2];else{var i=/操作提示<br\s*\/?>\r\n(.+?)<br\s*\/?>\r\n<a href="javascript:history\.go\(-1\);">返回上一步操作<\/a>/i.exec(e);i&&(t=-1,n=i[1])}return{type:t,msg:n||"未能获得预期的回应",url:a}},n.entries=regeneratorRuntime.mark(function e(t){var n,a,o,i,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!(n=!0),o=void 0,e.prev=3,i=Object.keys(t)[Symbol.iterator]();case 5:if(n=(r=i.next()).done){e.next=12;break}return l=r.value,e.next=9,[l,t[l]];case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,o=e.t0;case 18:e.prev=18,e.prev=19,!n&&i.return&&i.return();case 21:if(e.prev=21,a)throw o;e.next=24;break;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}),n.inFollowOrBlockUserList=function(t,e){return e.findIndex(function(e){return e.name&&e.name===t})},n.selectAll=function(e){return e.prop("checked",!0),!1},n.selectInverse=function(e){return e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))}),!1},n.readData=function(e,t){var n=1<arguments.length&&void 0!==t?t:r.default.storageType;return"ByUid"===n||"Global"===n?GM_getValue(e):localStorage.getItem(e)},n.writeData=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:r.default.storageType;try{"ByUid"===a||"Global"===a?GM_setValue(e,t):localStorage.setItem(e,t)}catch(e){console.log(e),alert("写入数据失败，可能是浏览器不支持所设定的存储类型或localStorage超出限额")}},n.deleteData=function(e,t){var n=1<arguments.length&&void 0!==t?t:r.default.storageType;"ByUid"===n||"Global"===n?GM_deleteValue(e):localStorage.removeItem(e)},n.getThreadSfParam=function(){var e=/&sf=(\w+)/.exec($(".pages:first > li:first-child > a").attr("href"));return(e?e[1]:l("sf"))||""},n.ajax=function(e){if(e.timeout||(e.timeout=u.default.defAjaxTimeout),e.url.startsWith("kf_fw_ig_index.php")){var t=r.default.ajaxStat["kf_fw_ig_index.php"];if(t=t||0,r.default.ajaxStat["kf_fw_ig_index.php"]=++t,20<t)return r.default.ajaxStat["kf_fw_ig_index.php"]=0,void setTimeout(function(){$.ajax(e)},6e4)}$.ajax(e)},n.getFloorUserName=function(e){if((e=$.trim(e)).includes(" ")){var t=e.split(" ");return 2===t.length?t[1]:e}return e}},{"./Const":6,"./Info":9}]},{},[1]);